{"version":3,"file":"Artalk.js","sources":["../../../src/client/components/Artalk.ts"],"sourcesContent":["import { usePageData, useSiteData } from \"@vuepress/client\";\nimport type Artalk from \"artalk\";\nimport {\n  type VNode,\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  shallowRef,\n  watch,\n} from \"vue\";\nimport { isString } from \"vuepress-shared/client\";\n\nimport { useArtalkOptions } from \"../helpers/index.js\";\n\nimport \"artalk/dist/Artalk.css\";\nimport \"../styles/artalk.scss\";\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Artalk\",\n\n  props: {\n    /**\n     * Whether the component is in darkmode\n     *\n     * 组件是否处于夜间模式\n     */\n    darkmode: Boolean,\n  },\n\n  setup: (props) => {\n    const artalkOptions = useArtalkOptions();\n    const page = usePageData();\n    const site = useSiteData();\n\n    const artalkContainer = shallowRef<HTMLDivElement>();\n\n    let artalk: Artalk.default | null = null;\n\n    const enableArtalk = isString(artalkOptions.server);\n\n    const initArtalk = async (): Promise<void> => {\n      await Promise.all([\n        import(/* webpackChunkName: \"artalk\" */ \"artalk\"),\n        new Promise<void>((resolve) => {\n          setTimeout(() => {\n            void nextTick().then(resolve);\n          }, artalkOptions.delay || 800);\n        }),\n      ]).then(([{ default: _Artalk }]) => {\n        // FIXME: Typescript type issues\n        const Artalk = _Artalk as unknown as typeof _Artalk.default;\n\n        try {\n          artalk = new Artalk({\n            useBackendConf: false,\n            site: site.value.title,\n            pageTitle: page.value.title,\n            ...artalkOptions,\n            el: artalkContainer.value!,\n            pageKey: page.value.path,\n            darkMode: props.darkmode,\n          });\n\n          if (artalkOptions.useBackendConf)\n            artalk.on(\"conf-loaded\", () => {\n              artalk!.setDarkMode(props.darkmode);\n            });\n        } catch (err) {\n          // FIXME: Not sure what the issue is, relevant issue:\n          // https://github.com/vuepress/vuepress-next/issues/1249\n          // https://github.com/ArtalkJS/Artalk/discussions/367\n        }\n      });\n    };\n\n    onMounted(() => {\n      watch(\n        () => page.value.path,\n        async () => {\n          artalk?.destroy();\n          await initArtalk();\n        },\n        { immediate: true }\n      );\n\n      watch(\n        () => props.darkmode,\n        (value) => {\n          artalk?.setDarkMode(value);\n        }\n      );\n    });\n\n    return (): VNode | null =>\n      enableArtalk\n        ? h(\n            \"div\",\n            { class: \"artalk-wrapper\" },\n            h(\"div\", { ref: artalkContainer })\n          )\n        : null;\n  },\n});\n"],"names":["Artalk","defineComponent","props","artalkOptions","useArtalkOptions","page","usePageData","site","useSiteData","artalkContainer","shallowRef","artalk","enableArtalk","isString","initArtalk","resolve","nextTick","_Artalk","onMounted","watch","value","h"],"mappings":"+TAkBA,IAAAA,EAAeC,EAAgB,CAE7B,KAAM,SAEN,MAAO,CAML,SAAU,OACZ,EAEA,MAAQC,GAAU,CAChB,MAAMC,EAAgBC,IAChBC,EAAOC,EAAY,EACnBC,EAAOC,IAEPC,EAAkBC,EAAAA,EAExB,IAAIC,EAAgC,KAEpC,MAAMC,EAAeC,EAASV,EAAc,MAAM,EAE5CW,EAAa,SAA2B,CAC5C,MAAM,QAAQ,IAAI,CAChB,OAAwC,QAAQ,EAChD,IAAI,QAAeC,GAAY,CAC7B,WAAW,IAAM,CACVC,EAAS,EAAE,KAAKD,CAAO,CAC9B,EAAGZ,EAAc,OAAS,GAAG,CAC/B,CAAC,CACH,CAAC,EAAE,KAAK,CAAC,CAAC,CAAE,QAASc,CAAQ,CAAC,IAAM,CAElC,MAAMjB,EAASiB,EAEf,GAAI,CACFN,EAAS,IAAIX,EAAO,CAClB,eAAgB,GAChB,KAAMO,EAAK,MAAM,MACjB,UAAWF,EAAK,MAAM,MACtB,GAAGF,EACH,GAAIM,EAAgB,MACpB,QAASJ,EAAK,MAAM,KACpB,SAAUH,EAAM,QAClB,CAAC,EAEGC,EAAc,gBAChBQ,EAAO,GAAG,cAAe,IAAM,CAC7BA,EAAQ,YAAYT,EAAM,QAAQ,CACpC,CAAC,CACL,MAAA,CAKF,CAAA,CAAC,CACH,EAEA,OAAAgB,EAAU,IAAM,CACdC,EACE,IAAMd,EAAK,MAAM,KACjB,SAAY,CACVM,GAAA,MAAAA,EAAQ,QAAA,EACR,MAAMG,EAAAA,CACR,EACA,CAAE,UAAW,EAAK,CACpB,EAEAK,EACE,IAAMjB,EAAM,SACXkB,GAAU,CACTT,GAAA,MAAAA,EAAQ,YAAYS,CACtB,CAAA,CACF,CACF,CAAC,EAEM,IACLR,EACIS,EACE,MACA,CAAE,MAAO,gBAAiB,EAC1BA,EAAE,MAAO,CAAE,IAAKZ,CAAgB,CAAC,CACnC,EACA,IACR,CACF,CAAC"}