import{_ as c,M as p,p as l,q as i,R as n,t as s,N as a,a1 as e}from"./framework-a97ca956.js";const u="/javaScript/frame.png",r="/javaScript/notification.png",d="/javaScript/animate1.gif",k="/javaScript/perform.png",v={},m=n("h1",{id:"jså¿…ä¼šapis",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#jså¿…ä¼šapis","aria-hidden":"true"},"#"),s(" JSå¿…ä¼šAPIs")],-1),b=n("h2",{id:"_1-intersectionobserverè§†å£äº¤å‰çŠ¶æ€æ£€æµ‹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-intersectionobserverè§†å£äº¤å‰çŠ¶æ€æ£€æµ‹","aria-hidden":"true"},"#"),s(" 1.IntersectionObserverè§†å£äº¤å‰çŠ¶æ€æ£€æµ‹")],-1),g=n("code",null,"IntersectionObserver",-1),h={href:"https://developer.mozilla.org/zh-CN/docs/Glossary/Viewport",target:"_blank",rel:"noopener noreferrer"},f=n("p",null,[s("å½“ä¸€ä¸ª "),n("code",null,"IntersectionObserver"),s(" å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œå…¶è¢«é…ç½®ä¸ºç›‘å¬æ ¹ä¸­ä¸€æ®µç»™å®šæ¯”ä¾‹çš„å¯è§åŒºåŸŸã€‚ä¸€æ—¦ "),n("code",null,"IntersectionObserver"),s(" è¢«åˆ›å»ºï¼Œåˆ™æ— æ³•æ›´æ”¹å…¶é…ç½®ï¼Œæ‰€ä»¥ä¸€ä¸ªç»™å®šçš„è§‚å¯Ÿè€…å¯¹è±¡åªèƒ½ç”¨æ¥ç›‘å¬å¯è§åŒºåŸŸçš„ç‰¹å®šå˜åŒ–å€¼ï¼›ç„¶è€Œï¼Œä½ å¯ä»¥åœ¨åŒä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡ä¸­é…ç½®ç›‘å¬å¤šä¸ªç›®æ ‡å…ƒç´ ã€‚")],-1),_=n("p",null,"å®ä¾‹èº«ä¸Šçš„å±æ€§",-1),y={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Element",target:"_blank",rel:"noopener noreferrer"},w={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Document",target:"_blank",rel:"noopener noreferrer"},q=n("code",null,"root",-1),x=n("code",null,"null",-1),j={href:"https://developer.mozilla.org/en-US/docs/Glossary/Bounding_box",target:"_blank",rel:"noopener noreferrer"},S=n("strong",null,"åƒç´ ",-1),I=n("code",null,"px",-1),P=n("strong",null,"ç™¾åˆ†æ¯”",-1),C=n("code",null,"%",-1),z=n("li",null,"thresholdsï¼šä¸€ä¸ªåŒ…å«é˜ˆå€¼çš„åˆ—è¡¨ï¼ŒæŒ‰å‡åºæ’åˆ—ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªé˜ˆå€¼éƒ½æ˜¯ç›‘å¬å¯¹è±¡çš„äº¤å‰åŒºåŸŸä¸è¾¹ç•ŒåŒºåŸŸçš„æ¯”ç‡ã€‚å½“ç›‘å¬å¯¹è±¡çš„ä»»ä½•é˜ˆå€¼è¢«è¶Šè¿‡æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªé€šçŸ¥ï¼ˆNotificationï¼‰ã€‚å¦‚æœæ„é€ å™¨æœªä¼ å…¥å€¼ï¼Œåˆ™é»˜è®¤å€¼ä¸º 0ã€‚",-1),A=n("p",null,"å®ä¾‹æ–¹æ³•",-1),W={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/disconnect",target:"_blank",rel:"noopener noreferrer"},N=n("code",null,"IntersectionObserver.disconnect()",-1),D=n("code",null,"IntersectionObserver",-1),E={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/observe",target:"_blank",rel:"noopener noreferrer"},O=n("code",null,"IntersectionObserver.observe()",-1),R=n("code",null,"IntersectionObserver",-1),B={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/takeRecords",target:"_blank",rel:"noopener noreferrer"},M=n("code",null,"IntersectionObserver.takeRecords()",-1),T={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserverEntry",target:"_blank",rel:"noopener noreferrer"},L=n("code",null,"IntersectionObserverEntry",-1),U={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/unobserve",target:"_blank",rel:"noopener noreferrer"},F=n("code",null,"IntersectionObserver.unobserve()",-1),H=n("code",null,"IntersectionObserver",-1),K=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Intersection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//thresholdï¼šå±æ€§å†³å®šç›¸äº¤æ¯”ä¾‹ä¸ºå¤šå°‘æ—¶ï¼Œè§¦å‘å›è°ƒå‡½æ•°ã€‚å–å€¼ä¸º 0 ~ 1ï¼Œæˆ–è€… 0 ~ 1çš„æ•°ç»„ã€‚</span>
        <span class="token literal-property property">rootMargin</span><span class="token operator">:</span> <span class="token string">&quot;0px&quot;</span><span class="token punctuation">,</span><span class="token comment">//rootMarginï¼š ç±»ä¼¼äº CSS çš„ margin å±æ€§ã€‚ç”¨æ¥ç¼©å°æˆ–æ‰©å¤§ rootBoundsï¼Œä»è€Œå½±å“ç›¸äº¤çš„è§¦å‘ </span>
        <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">//rootï¼šè®¾ç½®ç›‘è§†å™¨çš„æ ¹èŠ‚ç‚¹ï¼Œä¸ä¼ åˆ™é»˜è®¤ä¸ºè§†å£ã€‚</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*
        entriesçš„å±æ€§
        timeï¼šå‘ç”Ÿç›¸äº¤åˆ°ç›¸åº”çš„æ—¶é—´ï¼Œæ¯«ç§’ã€‚
        rootBoundsï¼šæ ¹å…ƒç´ çŸ©å½¢åŒºåŸŸçš„ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ ¹å…ƒç´ åˆ™è¿”å›nullï¼Œå›¾ä¸­è“è‰²éƒ¨åˆ†åŒºåŸŸã€‚
        boundingClientRectï¼šç›®æ ‡å…ƒç´ çš„çŸ©å½¢åŒºåŸŸçš„ä¿¡æ¯ï¼Œå›¾ä¸­é»‘è‰²è¾¹æ¡†çš„åŒºåŸŸã€‚
        intersectionRectï¼šç›®æ ‡å…ƒç´ ä¸è§†å£ï¼ˆæˆ–æ ¹å…ƒç´ ï¼‰çš„äº¤å‰åŒºåŸŸçš„ä¿¡æ¯ï¼Œå›¾ä¸­è“è‰²æ–¹å—å’Œç²‰çº¢è‰²æ–¹å—ç›¸äº¤çš„åŒºåŸŸã€‚
        isIntersectingï¼šç›®æ ‡å…ƒç´ ä¸æ ¹å…ƒç´ æ˜¯å¦ç›¸äº¤
        intersectionRatioï¼šç›®æ ‡å…ƒç´ ä¸è§†å£ï¼ˆæˆ–æ ¹å…ƒç´ ï¼‰çš„ç›¸äº¤æ¯”ä¾‹ã€‚
        targetï¼šç›®æ ‡å…ƒç´ ã€‚
    */</span>
    <span class="token keyword">const</span> iso <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
        entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                index<span class="token operator">++</span>
                v<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./image/image</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
                iso<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>

    <span class="token comment">// å¼€å¯è§‚å¯Ÿ</span>
    img<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        iso<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-å‰ªè´´æ¿clipboard" tabindex="-1"><a class="header-anchor" href="#_2-å‰ªè´´æ¿clipboard" aria-hidden="true">#</a> 2.å‰ªè´´æ¿Clipboard</h2>`,2),V={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand",target:"_blank",rel:"noopener noreferrer"},J=n("code",null,"document.execCommand()",-1),G=e(`<p>1.<code>document.execCommand()</code>å®ç°</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token comment">// å¤åˆ¶æ–‡æœ¬</span>
<span class="token keyword">function</span> <span class="token function">copyText</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–‡æœ¬è¾“å…¥æ¡†</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ‰§è¡Œå¤åˆ¶å‘½ä»¤</span>
  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;copy&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åˆ é™¤ä¸´æ—¶æ–‡æœ¬è¾“å…¥æ¡†</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç²˜è´´æ–‡æœ¬</span>
<span class="token keyword">function</span> <span class="token function">pasteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–‡æœ¬è¾“å…¥æ¡†</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ‰§è¡Œç²˜è´´å‘½ä»¤</span>
  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;paste&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token comment">// åˆ é™¤ä¸´æ—¶æ–‡æœ¬è¾“å…¥æ¡†</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> text<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.clipboardå®ç°</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>ä½¿ç”¨å‰å¿…é¡»focusèšç„¦åœ¨æ–‡æ¡£å†…ï¼Œå¦åˆ™æŠ¥é”™Uncaught (in promise) DOMException: Document is not focusedã€‚æ§åˆ¶å°è§¦å‘å°±ä¸è¡Œ</p></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>å¤åˆ¶
navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
ç²˜è´´
<span class="token keyword">const</span> clipboardData <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-requestanimationframe" tabindex="-1"><a class="header-anchor" href="#_3-requestanimationframe" aria-hidden="true">#</a> 3.requestAnimationFrame</h2><p><strong><code>window.requestAnimationFrame()</code></strong> å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œ<strong>è¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œã€‚</strong></p><p>window.requestAnimationFrame() å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œã€‚</p><p>ä¸setTimeoutç›¸æ¯”ï¼ŒrequestAnimationFrameæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœºã€‚å…·ä½“ä¸€ç‚¹è®²ï¼Œå¦‚æœå±å¹•åˆ·æ–°ç‡æ˜¯60Hz,é‚£ä¹ˆå›è°ƒå‡½æ•°å°±æ¯16.7msè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœåˆ·æ–°ç‡æ˜¯75Hzï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´é—´éš”å°±å˜æˆäº†1000/75=13.3msï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼ŒrequestAnimationFrameçš„æ­¥ä¼è·Ÿç€ç³»ç»Ÿçš„åˆ·æ–°æ­¥ä¼èµ°ã€‚å®ƒèƒ½ä¿è¯å›è°ƒå‡½æ•°åœ¨å±å¹•æ¯ä¸€æ¬¡çš„åˆ·æ–°é—´éš”ä¸­åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¸ä¼šå¼•èµ·ä¸¢å¸§ç°è±¡ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´åŠ¨ç”»å‡ºç°å¡é¡¿çš„é—®é¢˜ã€‚</p>`,9),X={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelAnimationFrame",target:"_blank",rel:"noopener noreferrer"},Y=n("code",null,"window.cancelAnimationFrame()",-1),$=e(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DOMHighResTimeStamp<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> id<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">{</span>
            <span class="token comment">// å®ƒè¡¨ç¤º requestAnimationFrame() å¼€å§‹æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ—¶åˆ»ã€‚</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>DOMHighResTimeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥APIçš„ä¼˜ç‚¹ï¼š</p><ul><li>CPUèŠ‚èƒ½ï¼šä½¿ç”¨setTimeoutå®ç°çš„åŠ¨ç”»ï¼Œå½“é¡µé¢è¢«éšè—æˆ–æœ€å°åŒ–æ—¶ï¼ŒsetTimeout ä»ç„¶åœ¨åå°æ‰§è¡ŒåŠ¨ç”»ä»»åŠ¡ï¼Œç”±äºæ­¤æ—¶é¡µé¢å¤„äºä¸å¯è§æˆ–ä¸å¯ç”¨çŠ¶æ€ï¼Œåˆ·æ–°åŠ¨ç”»æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå®Œå…¨æ˜¯æµªè´¹CPUèµ„æºã€‚è€ŒrequestAnimationFrameåˆ™å®Œå…¨ä¸åŒï¼Œå½“é¡µé¢å¤„ç†æœªæ¿€æ´»çš„çŠ¶æ€ä¸‹ï¼Œè¯¥é¡µé¢çš„å±å¹•åˆ·æ–°ä»»åŠ¡ä¹Ÿä¼šè¢«ç³»ç»Ÿæš‚åœï¼Œå› æ­¤è·Ÿç€ç³»ç»Ÿæ­¥ä¼èµ°çš„requestAnimationFrameä¹Ÿä¼šåœæ­¢æ¸²æŸ“ï¼Œå½“é¡µé¢è¢«æ¿€æ´»æ—¶ï¼ŒåŠ¨ç”»å°±ä»ä¸Šæ¬¡åœç•™çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼Œæœ‰æ•ˆèŠ‚çœäº†CPUå¼€é”€ã€‚</li><li>å‡½æ•°èŠ‚æµï¼šåœ¨é«˜é¢‘ç‡äº‹ä»¶(resize,scrollç­‰)ä¸­ï¼Œä¸ºäº†é˜²æ­¢åœ¨ä¸€ä¸ªåˆ·æ–°é—´éš”å†…å‘ç”Ÿå¤šæ¬¡å‡½æ•°æ‰§è¡Œï¼Œä½¿ç”¨requestAnimationFrameå¯ä¿è¯æ¯ä¸ªåˆ·æ–°é—´éš”å†…ï¼Œå‡½æ•°åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æµç•…æ€§ï¼Œä¹Ÿèƒ½æ›´å¥½çš„èŠ‚çœå‡½æ•°æ‰§è¡Œçš„å¼€é”€ã€‚ä¸€ä¸ªåˆ·æ–°é—´éš”å†…å‡½æ•°æ‰§è¡Œå¤šæ¬¡æ—¶æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæ˜¾ç¤ºå™¨æ¯16.7msåˆ·æ–°ä¸€æ¬¡ï¼Œå¤šæ¬¡ç»˜åˆ¶å¹¶ä¸ä¼šåœ¨å±å¹•ä¸Šä½“ç°å‡ºæ¥ã€‚</li></ul><h2 id="_4-requestidlecallback" tabindex="-1"><a class="header-anchor" href="#_4-requestidlecallback" aria-hidden="true">#</a> 4.requestIdleCallback</h2><p>ä¸€å¸§çš„ç”Ÿå‘½å‘¨æœŸ</p><p><img src="`+u+'" alt=""></p><p>å‡å¦‚æŸä¸€å¸§é‡Œé¢è¦æ‰§è¡Œçš„ä»»åŠ¡ä¸å¤šï¼Œåœ¨ä¸åˆ°16msï¼ˆ1000/60)çš„æ—¶é—´å†…å°±å®Œæˆäº†ä¸Šè¿°ä»»åŠ¡çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸€å¸§å°±ä¼šæœ‰ä¸€å®šçš„ç©ºé—²æ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å°±æ°å¥½å¯ä»¥ç”¨æ¥æ‰§è¡ŒrequestIdleCallbackçš„å›è°ƒ</p><p>æ–¹æ³•æ’å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨ã€‚è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚å‡½æ•°ä¸€èˆ¬ä¼šæŒ‰å…ˆè¿›å…ˆè°ƒç”¨çš„é¡ºåºæ‰§è¡Œï¼Œç„¶è€Œï¼Œå¦‚æœå›è°ƒå‡½æ•°æŒ‡å®šäº†æ‰§è¡Œè¶…æ—¶æ—¶é—´<code>timeout</code>ï¼Œåˆ™æœ‰å¯èƒ½ä¸ºäº†åœ¨è¶…æ—¶å‰æ‰§è¡Œå‡½æ•°è€Œæ‰“ä¹±æ‰§è¡Œé¡ºåºã€‚</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>å¦‚æœè¯¥å›è°ƒä»»åŠ¡å¿…é¡»æ‰§è¡Œï¼Œéœ€è¦è®¾ç½®timeouté˜²æ­¢è¶…æ—¶ï¼Œå› æ­¤è¯¥å‡½æ•°ä¸€èˆ¬ç”¨äºæ‰§è¡Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡</p></div>',9),Q={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelIdleCallback",target:"_blank",rel:"noopener noreferrer"},Z=n("code",null,"Window.cancelIdleCallback()",-1),nn=e(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>IdleDeadline<span class="token operator">:</span><span class="token punctuation">{</span>didTimeout<span class="token operator">:</span><span class="token builtin">boolean</span><span class="token punctuation">,</span><span class="token function-variable function">timeRemaining</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>IdleDeadline<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            timeout<span class="token operator">:</span> <span class="token number">2000</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å›è°ƒæ¥æ”¶ä¸€ä¸ªIdleDeadlineå‚æ•°å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„timeRemainingè¡¨ç¤ºå‰©ä½™å¤šå°‘é—²ç½®æ—¶é—´ï¼Œå¦‚æœ idle period å·²ç»ç»“æŸï¼Œåˆ™å®ƒçš„å€¼æ˜¯ 0ã€‚ä½ çš„å›è°ƒå‡½æ•° (ä¼ ç»™ requestIdleCallback çš„å‡½æ•°) å¯ä»¥é‡å¤çš„è®¿é—®è¿™ä¸ªå±æ€§ç”¨æ¥åˆ¤æ–­å½“å‰çº¿ç¨‹çš„é—²ç½®æ—¶é—´æ˜¯å¦å¯ä»¥åœ¨ç»“æŸå‰æ‰§è¡Œæ›´å¤šçš„ä»»åŠ¡ã€‚</p><h2 id="_5-web-workers" tabindex="-1"><a class="header-anchor" href="#_5-web-workers" aria-hidden="true">#</a> 5.Web Workers</h2>`,3),sn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest",target:"_blank",rel:"noopener noreferrer"},an=n("code",null,"XMLHttpRequest",-1),tn=n("code",null,"responseXML",-1),en=n("code",null,"channel",-1),pn=n("h3",{id:"è§„åˆ™",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#è§„åˆ™","aria-hidden":"true"},"#"),s(" è§„åˆ™ï¼š")],-1),on={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/Worker",target:"_blank",rel:"noopener noreferrer"},cn=n("code",null,"Worker('xxx.js')",-1),ln={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window",target:"_blank",rel:"noopener noreferrer"},un=n("code",null,"window",-1),rn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Worker",target:"_blank",rel:"noopener noreferrer"},dn=n("code",null,"Worker",-1),kn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window",target:"_blank",rel:"noopener noreferrer"},vn=n("code",null,"window",-1),mn=n("u",null,"æƒ³è¦è®¿é—®å…¨å±€ä¸Šä¸‹æ–‡ç”¨",-1),bn=n("code",null,"self",-1),gn=e("<li><p>workerå†…æ— æ³•ç›´æ¥æ“çºµDOM</p></li><li><p>workerså’Œä¸»çº¿ç¨‹æ•°æ®ä½¿ç”¨postMessageæ–¹æ³•å‘é€æ¶ˆæ¯</p></li><li><p>ç»ˆæ­¢è§„åˆ™ä¸¤ç§æ–¹æ³• 1.<code>workerå®ä¾‹.terminate()</code> 2.workersè°ƒç”¨è‡ªå·±çš„<code>close()</code>å…³é—­</p></li><li><p>ç›‘å¬æ¶ˆæ¯<code>onmessage</code></p></li><li><p><u>åœ¨ä¸»é¡µé¢ä¸ worker ä¹‹é—´ä¼ é€’çš„æ•°æ®æ˜¯é€šè¿‡<strong>æ‹·è´</strong>ï¼Œè€Œä¸æ˜¯å…±äº«æ¥å®Œæˆçš„ã€‚ä¼ é€’ç»™ <code>worker</code> çš„å¯¹è±¡éœ€è¦ç»è¿‡åºåˆ—åŒ–ï¼Œæ¥ä¸‹æ¥åœ¨å¦ä¸€ç«¯è¿˜éœ€è¦ååºåˆ—åŒ–ã€‚é¡µé¢ä¸ <code>worker</code> <strong>ä¸ä¼šå…±äº«åŒä¸€ä¸ªå®ä¾‹</strong>ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯åœ¨æ¯æ¬¡é€šä¿¡ç»“æŸæ—¶ç”Ÿæˆäº†æ•°æ®çš„<strong>ä¸€ä¸ªå‰¯æœ¬</strong>ã€‚</u></p></li><li><p>é”™è¯¯å¤„ç†å½“ worker å‡ºç°è¿è¡Œä¸­é”™è¯¯æ—¶ï¼Œå®ƒçš„ <code>onerror</code> äº‹ä»¶å¤„ç†å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚å®ƒä¼šæ”¶åˆ°ä¸€ä¸ªæ‰©å±•äº† <code>ErrorEvent</code> æ¥å£çš„åä¸º <code>error</code>çš„äº‹ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹é”™è¯¯ä¿¡æ¯æ‰¾åˆ°é”™è¯¯åŸå› ï¼š</p><ol><li><p><code>message</code>å¯è¯»æ€§è‰¯å¥½çš„é”™è¯¯æ¶ˆæ¯ã€‚</p></li><li><p><code>filename</code>å‘ç”Ÿé”™è¯¯çš„è„šæœ¬æ–‡ä»¶åã€‚</p></li><li><p><code>lineno</code>å‘ç”Ÿé”™è¯¯æ—¶æ‰€åœ¨è„šæœ¬æ–‡ä»¶çš„è¡Œå·ã€‚</p></li></ol></li>",6),hn=e(`<h4 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> ä½¿ç”¨åœºæ™¯</h4><ol><li>ã€‚ç”±äº Worker ä¸èƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªè„šæœ¬å¿…é¡»æ¥è‡ªç½‘ç»œã€‚å¦‚æœä¸‹è½½æ²¡æœ‰æˆåŠŸï¼ˆæ¯”å¦‚404é”™è¯¯ï¼‰ï¼ŒWorker å°±ä¼šé»˜é»˜åœ°å¤±è´¥ã€‚</li><li>åŠ å¯†æ•°æ® æœ‰äº›åŠ è§£å¯†çš„ç®—æ³•æ¯”è¾ƒå¤æ‚ï¼Œæˆ–è€…åœ¨åŠ è§£å¯†å¾ˆå¤šæ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¼šéå¸¸è€—è´¹è®¡ç®—èµ„æºï¼Œå¯¼è‡´UIçº¿ç¨‹æ— å“åº”ï¼Œå› æ­¤è¿™æ˜¯ä½¿ç”¨Web Workerçš„å¥½æ—¶æœºï¼Œä½¿ç”¨Workerçº¿ç¨‹å¯ä»¥è®©ç”¨æˆ·æ›´åŠ æ— ç¼çš„æ“ä½œUIã€‚ é¢„å–æ•°æ®</li><li>æœ‰æ—¶å€™ä¸ºäº†æå‡æ•°æ®åŠ è½½é€Ÿåº¦ï¼Œå¯ä»¥æå‰ä½¿ç”¨Workerçº¿ç¨‹è·å–æ•°æ®ï¼Œå› ä¸ºWorkerçº¿ç¨‹æ˜¯å¯ä»¥æ˜¯ç”¨ XMLHttpRequest çš„ã€‚ é¢„æ¸²æŸ“åœ¨æŸäº›æ¸²æŸ“åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚æ¸²æŸ“å¤æ‚çš„canvasçš„æ—¶å€™éœ€è¦è®¡ç®—çš„æ•ˆæœæ¯”å¦‚åå°„ã€æŠ˜å°„ã€å…‰å½±ã€ææ–™ç­‰ï¼Œè¿™äº›è®¡ç®—çš„é€»è¾‘å¯ä»¥ä½¿ç”¨Workerçº¿ç¨‹æ¥æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªWorkerçº¿ç¨‹ã€‚</li><li>å¤æ‚æ•°æ®å¤„ç†åœºæ™¯æŸäº›æ£€ç´¢ã€æ’åºã€è¿‡æ»¤ã€åˆ†æä¼šéå¸¸è€—è´¹æ—¶é—´ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨Web Workeræ¥è¿›è¡Œï¼Œä¸å ç”¨ä¸»çº¿ç¨‹ã€‚</li><li>é¢„åŠ è½½å›¾ç‰‡æœ‰æ—¶å€™ä¸€ä¸ªé¡µé¢æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œæˆ–è€…æœ‰å‡ ä¸ªå¾ˆå¤§çš„å›¾ç‰‡çš„æ—¶å€™ï¼Œå¦‚æœä¸šåŠ¡é™åˆ¶ä¸è€ƒè™‘æ‡’åŠ è½½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Web Workeræ¥åŠ è½½å›¾ç‰‡ã€‚</li></ol><p>::: warning:</p><p>è™½ç„¶ä½¿ç”¨workerçº¿ç¨‹ä¸ä¼šå ç”¨ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯å¯åŠ¨workerä¼šæ¯”è¾ƒè€—è´¹èµ„æºã€‚æ­¤å¤– ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨XMLHttpRequeståœ¨è¯·æ±‚è¿‡ç¨‹ä¸­æµè§ˆå™¨å¦å¼€äº†ä¸€ä¸ªå¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹ï¼Œä½†æ˜¯äº¤äº’è¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æ¶ˆè€—ä¸»çº¿ç¨‹èµ„æº</p><p>:::</p><h4 id="ä»£ç å±•ç¤º" tabindex="-1"><a class="header-anchor" href="#ä»£ç å±•ç¤º" aria-hidden="true">#</a> ä»£ç å±•ç¤º</h4><p><strong>ä¸»è¿›ç¨‹ä»£ç ç¤ºä¾‹</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js&quot;</span><span class="token punctuation">)</span>

worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ä¸»è¿›ç¨‹ç›‘å¬æ¶ˆæ¯&#39;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>

<span class="token punctuation">}</span>

worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">è¿™æ˜¯ä¸€æ¡ä¸»è¿›ç¨‹ç»™workerçš„æ¶ˆæ¯</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>document<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>workersä»£ç ç¤ºä¾‹</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>\\<span class="token operator">*</span> Worker å†…éƒ¨å¦‚æœè¦åŠ è½½å…¶ä»–è„šæœ¬ï¼Œ

\\<span class="token operator">*</span> <span class="token function">æœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•importScripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ã€‚ <span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">&#39;script1.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

\\<span class="token operator">*</span> <span class="token function">è¯¥æ–¹æ³•å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªè„šæœ¬importScripts</span><span class="token punctuation">(</span><span class="token string">&#39;script1.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;script2.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">*</span><span class="token operator">/</span>
<span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">&#39;./other_script.js&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> worker_data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">123</span>
<span class="token punctuation">}</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;workerç›‘å¬æ¶ˆæ¯&#39;</span><span class="token punctuation">,</span> ev<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>worker_data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å…±äº«worker" tabindex="-1"><a class="header-anchor" href="#å…±äº«worker" aria-hidden="true">#</a> å…±äº«worker</h4><p>ä¸€ä¸ªå…±äº« worker å¯ä»¥è¢«å¤šä¸ªè„šæœ¬ä½¿ç”¨â€”â€”å³ä½¿è¿™äº›è„šæœ¬æ­£åœ¨è¢«ä¸åŒçš„ windowã€iframe æˆ–è€… worker è®¿é—®ã€‚</p><div class="custom-container danger"><p class="custom-container-title">DANGER</p><ol><li>å¦‚æœå…±äº« worker å¯ä»¥è¢«å¤šä¸ªæµè§ˆä¸Šä¸‹æ–‡è°ƒç”¨ï¼Œæ‰€æœ‰è¿™äº›æµè§ˆä¸Šä¸‹æ–‡å¿…é¡»å±äºåŒæºï¼ˆç›¸åŒçš„åè®®ï¼Œä¸»æœºå’Œç«¯å£å·ï¼‰ã€‚</li></ol></div><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„å…±äº« worker ä¸ç”Ÿæˆä¸€ä¸ªä¸“ç”¨ worker éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯æ„é€ å™¨çš„åå­—ä¸åŒindex.html å’Œ index2.htmlâ€”â€”ç”Ÿæˆå…±äº« worker çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const shareWorker = new SharedWorker(&#39;worker.js&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><u></u></p><h5 id="è§„åˆ™-1" tabindex="-1"><a class="header-anchor" href="#è§„åˆ™-1" aria-hidden="true">#</a> è§„åˆ™</h5><ol><li>ä¸€ä¸ªéå¸¸å¤§çš„åŒºåˆ«åœ¨äºï¼Œä¸ä¸€ä¸ªå…±äº« worker é€šä¿¡å¿…é¡»é€šè¿‡ç«¯å£å¯¹è±¡â€”â€”ã€‹ä¸€ä¸ªç¡®åˆ‡çš„æ‰“å¼€çš„ç«¯å£ä¾›è„šæœ¬ä¸ worker é€šä¿¡ï¼ˆåœ¨ä¸“ç”¨ worker ä¸­è¿™ä¸€éƒ¨åˆ†æ˜¯éšå¼è¿›è¡Œçš„ï¼‰ã€‚</li><li>åœ¨ä¼ é€’æ¶ˆæ¯ä¹‹å‰ï¼Œç«¯å£è¿æ¥å¿…é¡»è¢«æ˜¾å¼çš„æ‰“å¼€ï¼Œæ‰“å¼€æ–¹å¼æ˜¯ä½¿ç”¨ onmessage äº‹ä»¶å¤„ç†å‡½æ•°æˆ–è€… start() æ–¹æ³•ã€‚start() æ–¹æ³•çš„è°ƒç”¨åªåœ¨ä¸€ç§æƒ…å†µä¸‹éœ€è¦ï¼Œé‚£å°±æ˜¯æ¶ˆæ¯äº‹ä»¶addEventListener() æ–¹æ³•è¢«ä½¿ç”¨ã€‚</li><li>workerè¿›ç¨‹ä¸­ä½¿ç”¨ <code>onconnect</code> äº‹ä»¶å¤„ç†å‡½æ•°æ¥æ‰§è¡Œä»£ç ã€‚</li></ol><h5 id="ä»£ç å±•ç¤º-1" tabindex="-1"><a class="header-anchor" href="#ä»£ç å±•ç¤º-1" aria-hidden="true">#</a> ä»£ç å±•ç¤º</h5><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>index<span class="token punctuation">.</span>html <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token comment">/*
        * Worker å†…éƒ¨å¦‚æœè¦åŠ è½½å…¶ä»–è„šæœ¬ï¼Œ
        * æœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•importScripts()ã€‚ importScripts(&#39;script1.js&#39;);
        * è¯¥æ–¹æ³•å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªè„šæœ¬importScripts(&#39;script1.js&#39;, &#39;script2.js&#39;);
        */</span>

        <span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js&quot;</span><span class="token punctuation">)</span>
        worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ä¸»è¿›ç¨‹1ç›‘å¬æ¶ˆæ¯&#39;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">è¿™æ˜¯ä¸€æ¡ä¸»è¿›ç¨‹1ç»™workerçš„æ¶ˆæ¯</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>index<span class="token punctuation">.</span>html <span class="token operator">-</span> <span class="token number">2</span>

    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token comment">/*
        * Worker å†…éƒ¨å¦‚æœè¦åŠ è½½å…¶ä»–è„šæœ¬ï¼Œ
        * æœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•importScripts()ã€‚ importScripts(&#39;script1.js&#39;);
        * è¯¥æ–¹æ³•å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªè„šæœ¬importScripts(&#39;script1.js&#39;, &#39;script2.js&#39;);
        */</span>

        <span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js&quot;</span><span class="token punctuation">)</span>
        worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ä¸»è¿›ç¨‹2ç›‘å¬æ¶ˆæ¯&#39;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">è¿™æ˜¯ä¸€æ¡ä¸»è¿›ç¨‹2ç»™workerçš„æ¶ˆæ¯</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>worker

<span class="token function-variable function">onconnect</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä½¿ç”¨äº‹ä»¶çš„ ports å±æ€§æ¥è·å–ç«¯å£å¹¶å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚</span>
    <span class="token keyword">var</span> port <span class="token operator">=</span> e<span class="token punctuation">.</span>ports<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> workerResult <span class="token operator">=</span> <span class="token string">&#39;Result: &#39;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>workerResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-pwa-æ¸è¿›å¼-web-åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_6-pwa-æ¸è¿›å¼-web-åº”ç”¨" aria-hidden="true">#</a> 6.PWA-æ¸è¿›å¼ Web åº”ç”¨</h2><p>**ä¼˜ç‚¹ï¼š**PWA æ˜¯å¯è¢«å‘ç°ã€æ˜“å®‰è£…ã€å¯é“¾æ¥ã€ç‹¬ç«‹äºç½‘ç»œã€æ¸è¿›å¼ã€å¯é‡ç”¨ã€å“åº”æ€§å’Œå®‰å…¨çš„ã€‚å…³äºè¿™äº›å«ä¹‰çš„ç»†èŠ‚</p><p>**PWAèƒ½å®ç°å“ªäº›åŠŸèƒ½ï¼Ÿ**1.æ·»åŠ ä¸»å±å¹• 2.æ¨é€æ¶ˆæ¯é€šçŸ¥ 3.ç¦»çº¿ä½¿ç”¨åº”ç”¨ 4.å¯å…±äº«URLåˆ†äº«ç»™ä»–äºº</p><h3 id="pwaçš„æ¶æ„" tabindex="-1"><a class="header-anchor" href="#pwaçš„æ¶æ„" aria-hidden="true">#</a> PWAçš„æ¶æ„</h3><p>æ¸²æŸ“ç½‘ç«™ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³• - åœ¨æœåŠ¡å™¨ä¸Šæˆ–åœ¨å®¢æˆ·ç«¯ä¸Šã€‚å®ƒä»¬éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œä½ å¯ä»¥é€‚å½“åœ°æ··åˆä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•</p><ul><li>æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„æ„æ€æ˜¯åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“ç½‘é¡µï¼Œå› æ­¤é¦–æ¬¡åŠ è½½ä¼šæ›´å¿«ï¼Œä½†æ˜¯åœ¨ä¸åŒé¡µé¢ä¹‹é—´å¯¼èˆªéƒ½éœ€è¦ä¸‹è½½æ–°çš„ HTML å†…å®¹ã€‚å®ƒçš„è·¨æµè§ˆå™¨å…¼å®¹æ€§è‰¯å¥½ï¼Œä½†ä»£ä»·æ˜¯é¡µé—´åŠ è½½æ—¶é—´å»¶é•¿ï¼Œä¹Ÿå°±æ˜¯æ€»ä½“æ„ŸçŸ¥ä¸Šçš„æ€§èƒ½é™ä½ï¼šæ¯åŠ è½½ä¸€ä¸ªé¡µé¢ï¼Œéƒ½éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨è¯·æ±‚å¾€è¿”çš„æ—¶é—´ã€‚</li><li>å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰å…è®¸åœ¨å¯¼èˆªåˆ°ä¸åŒé¡µé¢æ—¶å‡ ä¹ç«‹å³åœ¨æµè§ˆå™¨ä¸­æ›´æ–°ç½‘ç«™ï¼Œä½†åœ¨å¼€å§‹æ—¶éœ€è¦æ›´å¤šçš„åˆå§‹ä¸‹è½½å’Œå®¢æˆ·ç«¯ä¸Šçš„é¢å¤–æ¸²æŸ“ã€‚é¦–æ¬¡è®¿é—®æ—¶ç½‘ç«™é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†åç»­è®¿é—®é€Ÿåº¦è¦å¿«å¾—å¤šã€‚</li></ul>`,28),fn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Streams_API",target:"_blank",rel:"noopener noreferrer"},_n=e(`<h3 id="æ·»åŠ ä¸»å±å¹•" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ ä¸»å±å¹•" aria-hidden="true">#</a> æ·»åŠ ä¸»å±å¹•</h3><p><strong>è§„åˆ™ï¼š</strong></p><ol><li>åº”ç”¨é€šè¿‡ HTTPS æä¾›æœåŠ¡â€”â€”Web æ­£æœç€æ›´åŠ å®‰å…¨çš„æ–¹å‘å‘å±•ï¼ŒåŒ…æ‹¬ A2HS åœ¨å†…çš„è®¸å¤šç°ä»£ Web æŠ€æœ¯éƒ½å°†ä»…å·¥ä½œåœ¨å®‰å…¨çš„ç¯å¢ƒä¸­ã€‚</li><li>ä» HTML å¤´é“¾æ¥å…·æœ‰æ­£ç¡®å­—æ®µçš„ manifest æ–‡ä»¶ã€‚</li><li>æœ‰åˆé€‚çš„å›¾æ ‡å¯æ˜¾ç¤ºåœ¨ä¸»å±å¹•ä¸Šã€‚(uiéœ€è¦å®šåˆ¶å°ºå¯¸)</li><li>Chrome æµè§ˆå™¨è¿˜è¦æ±‚è¯¥åº”ç”¨ç¨‹åºæ³¨å†Œä¸€ä¸ª Service Workerï¼ˆè¿™æ ·åœ¨ç¦»çº¿çŠ¶æ€ä¸‹å°±ä¹Ÿå¯ä»¥è¿è¡Œï¼‰ã€‚</li></ol><div class="custom-container tip"><p class="custom-container-title">TIP</p><h4 id="manifestæ–‡ä»¶é…ç½®" tabindex="-1"><a class="header-anchor" href="#manifestæ–‡ä»¶é…ç½®" aria-hidden="true">#</a> manifestæ–‡ä»¶é…ç½®</h4><p><strong>manifest</strong>:Web manifest ä»¥æ ‡å‡† JSON æ ¼å¼ç¼–å†™ï¼Œåº”æ”¾ç½®åœ¨åº”ç”¨ç¨‹åºç›®å½•ä¸­çš„æŸä¸ªä½ç½®ï¼ˆæœ€å¥½æ˜¯åœ¨æ ¹ç›®å½•ä¸­ï¼‰</p><p>htmlä¸­éœ€è¦å¼•å…¥è¯¥æ–‡ä»¶ğŸ‰</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manifest.webmanifest<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li><code>background_color</code>ï¼šæŒ‡å®šåœ¨æŸäº›åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„èƒŒæ™¯è‰²ã€‚ä¸ A2HS æœ€ç›¸å…³çš„ä¸€ä¸ªæ˜¯åœ¨ç‚¹å‡»ä¸»å±å¹•ä¸Šçš„åº”ç”¨ç¨‹åºå›¾æ ‡å¹¶é¦–æ¬¡å¼€å§‹åŠ è½½æ—¶æ˜¾ç¤ºçš„åˆå§‹å±å¹•ï¼ˆç›®å‰ä»…åœ¨é€šè¿‡ Chrome å°†åº”ç”¨æ·»åŠ åˆ°ä¸»å±å¹•æ—¶æ˜¾ç¤ºï¼‰ã€‚</li><li><code>display</code>ï¼šæŒ‡å®šåº”å¦‚ä½•æ˜¾ç¤ºåº”ç”¨ã€‚ä¸ºäº†ä½¿å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªåº”ç”¨ç¨‹åºè€Œéç½‘é¡µï¼Œè¿™é‡Œåº”è¯¥å¡«å†™åƒæ˜¯ <code>fullscreen</code> ï¼ˆæ ¹æœ¬ä¸æ˜¾ç¤ºä»»ä½• UIï¼‰æˆ– <code>standalone</code>ï¼ˆä¸å‰è€…éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯çŠ¶æ€æ è¿™æ ·çš„ç³»ç»Ÿçº§ UI å…ƒç´ å¯èƒ½æ˜¯å¯è§çš„ï¼‰çš„å€¼ã€‚</li><li><code>icons</code>ï¼šæŒ‡å®šåœ¨ä¸åŒä½ç½®ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä»»åŠ¡åˆ‡æ¢å™¨ä¸Šæˆ–æ›´é‡è¦çš„æ˜¯åœ¨ä¸»å±å¹•ä¸Šï¼‰è¡¨ç¤ºåº”ç”¨ç¨‹åºæ—¶æµè§ˆå™¨ä½¿ç”¨çš„å›¾æ ‡ã€‚æˆ‘ä»¬çš„æ¼”ç¤ºä¸­ä»…åŒ…å«ä¸€ä¸ªã€‚(<u>è¯·æ³¨æ„ï¼Œæ¯ä¸ªå›¾æ ‡å¯¹è±¡ä¸­çš„ <code>type</code> æˆå‘˜éƒ½æŒ‡å®šäº†è¯¥å›¾æ ‡çš„ MIME ç±»å‹ï¼Œå› æ­¤æµè§ˆå™¨å¯ä»¥å¿«é€Ÿè¯»å–è¯¥å›¾æ ‡çš„ç±»å‹ï¼Œå¹¶åœ¨ä¸æ”¯æŒæ­¤ç±»å‹æ—¶å°†å…¶å¿½ç•¥å¹¶é‡‡ç”¨å…¶ä»–å›¾æ ‡ã€‚</u>)</li><li><code>name</code>/<code>short_name</code>ï¼šè¿™äº›å­—æ®µæä¾›äº†åœ¨ä¸åŒä½ç½®è¡¨ç¤ºåº”ç”¨ç¨‹åºæ—¶è¦æ˜¾ç¤ºçš„åº”ç”¨ç¨‹åºåç§°ã€‚<code>name</code> æä¾›å®Œæ•´çš„åº”ç”¨åç§°ã€‚<code>short_name</code> åˆ™æ˜¯å½“æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ˜¾ç¤ºå…¨åæ—¶ï¼Œæä¾›çš„ç¼©å†™åç§°ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºåç§°ç‰¹åˆ«é•¿ï¼Œå»ºè®®æ‚¨åŒæ—¶æä¾›ä¸¤è€…ã€‚</li><li><code>start_url</code>ï¼šæä¾›å¯åŠ¨æ·»åŠ åˆ°ä¸»å±å¹•åº”ç”¨ç¨‹åºæ—¶åº”åŠ è½½çš„èµ„æºçš„è·¯å¾„ã€‚è¯·æ³¨æ„ï¼Œè¿™å¿…é¡»æ˜¯ä¸€ä¸ªç›¸å¯¹ manifest æŒ‡å‘ç½‘ç«™ä¸»é¡µçš„ç›¸å¯¹è·¯å¾„ã€‚å¦è¯·æ³¨æ„ï¼ŒChrome éœ€è¦è¿™æ¡å­—æ®µæ‰èƒ½æ˜¾ç¤ºå®‰è£…æ ‡è¯­ï¼Œè€Œ Firefox å³ä½¿æ²¡æœ‰è¿™æ¡å­—æ®µä¹Ÿä¼šæ˜¾ç¤ºç”¨äºæ·»åŠ åˆ°ä¸»å±çš„å«åŠ å·çš„ä¸»é¡µå›¾æ ‡ã€‚</li></ul><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;js13kGames Progressive Web App&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;js13kPWA&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Progressive Web App that lists games submitted to the A-Frame category in the js13kGames 2017 competition.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-32.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;32x32&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-64.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;64x64&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-96.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;96x96&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-128.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;128x128&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-168.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;168x168&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-192.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192x192&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-256.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;256x256&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-512.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;512x512&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;display&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fullscreen&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#B12A34&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#B12A34&quot;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),yn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"},wn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API",target:"_blank",rel:"noopener noreferrer"},qn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API",target:"_blank",rel:"noopener noreferrer"},xn=e(`<h4 id="jsè§¦å‘æ—¶é—´æ·»åŠ åˆ°ä¸»å±å¹•" tabindex="-1"><a class="header-anchor" href="#jsè§¦å‘æ—¶é—´æ·»åŠ åˆ°ä¸»å±å¹•" aria-hidden="true">#</a> JSè§¦å‘æ—¶é—´æ·»åŠ åˆ°ä¸»å±å¹•</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>æ·»åŠ ä¸»å±å¹•<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;btn&#39;</span><span class="token punctuation">)</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;beforeinstallprompt&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// é˜²æ­¢ Chrome 67 åŠæ›´æ—©ç‰ˆæœ¬è‡ªåŠ¨æ˜¾ç¤ºå®‰è£…æç¤º</span>
            e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç¨åå†è§¦å‘æ­¤äº‹ä»¶ å°†äº‹ä»¶å¯¹è±¡å­˜å‚¨åœ¨ deferredPrompt å˜é‡ä¸­ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥ç”¨äºæ‰§è¡Œå®é™…å®‰è£…ã€‚ä¹‹åä½¿ç”¨ beforeinstallprompt äº‹ä»¶å¯¹è±¡ï¼ˆå­˜å‚¨åœ¨ deferredPrompt ä¸­ï¼‰ä¸Šå¯ç”¨çš„ prompt() æ–¹æ³•è§¦å‘æ˜¾ç¤ºå®‰è£…æç¤ºã€‚</span>
            deferredPrompt <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token comment">// æ›´æ–° UI ä»¥æé†’ç”¨æˆ·å¯ä»¥å°† App å®‰è£…åˆ°æ¡Œé¢</span>
            btn<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;block&#39;</span><span class="token punctuation">;</span>

            btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// éšè—æ˜¾ç¤º A2HS æŒ‰é’®çš„ç•Œé¢</span>
                btn<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span>
                <span class="token comment">// æ˜¾ç¤ºå®‰è£…æç¤º</span>
                deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ç­‰å¾…ç”¨æˆ·åé¦ˆ</span>
                deferredPrompt<span class="token punctuation">.</span>userChoice<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">choiceResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>choiceResult<span class="token punctuation">.</span>outcome <span class="token operator">===</span> <span class="token string">&#39;accepted&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;User accepted the A2HS prompt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;User dismissed the A2HS prompt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                     <span class="token comment">//å°† deferredPrompt è®¾ç½®ä¸º nullï¼Œå› ä¸ºä¸å†éœ€è¦å®ƒã€‚</span>
                    deferredPrompt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-pwaç¦»çº¿å·¥ä½œ-service-worker" tabindex="-1"><a class="header-anchor" href="#_7-pwaç¦»çº¿å·¥ä½œ-service-worker" aria-hidden="true">#</a> 7.PWAç¦»çº¿å·¥ä½œ-Service Worker</h2><p>Service Worker æ˜¯æµè§ˆå™¨å’Œç½‘ç»œä¹‹é—´çš„è™šæ‹Ÿä»£ç†ã€‚å®ƒä»¬ç»ˆäºè§£å†³äº†å‰ç«¯å¼€å‘äººå‘˜å¤šå¹´æ¥ä¸€ç›´åœ¨åŠªåŠ›è§£å†³çš„ä¸€äº›é—®é¢˜ï¼Œå…¶ä¸­æœ€å€¼å¾—å…³æ³¨çš„æ˜¯ï¼Œ<u>è§£å†³äº†å¦‚ä½•æ­£ç¡®ç¼“å­˜ç½‘ç«™èµ„æºå¹¶ä½¿å…¶åœ¨ç¦»çº¿æ—¶å¯ç”¨çš„é—®é¢˜ã€‚</u></p><p>Service workers éå¸¸å¼ºå¤§ï¼Œ<u>å› ä¸ºä»–ä»¬å¯ä»¥æ§åˆ¶ç½‘ç»œè¯·æ±‚ã€ä¿®æ”¹ç½‘ç»œè¯·æ±‚ã€è¿”å›ç¼“å­˜çš„è‡ªå®šä¹‰å“åº”ï¼Œæˆ–è€…åˆæˆå“åº”ã€‚</u></p><h3 id="service-workerç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#service-workerç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> Service Workerç”Ÿå‘½å‘¨æœŸ</h3><p>https://github.com/mdn/pwa-examples/tree/main/js13kpwaç¼“å­˜å±•ç¤º</p><ol><li><p>æ³¨å†Œ:ä¸»è¿›ç¨‹ä¸­æ³¨å†Œï¼Œæ³¨å†Œå®Œæˆåï¼Œsw.js æ–‡ä»¶ä¼šè‡ªåŠ¨ä¸‹è½½ã€å®‰è£…ï¼Œç„¶åæ¿€æ´»ã€‚</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&#39;serviceWorker&#39;</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&#39;/pwa-examples/js13kpwa/sw.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>å®‰è£…:åœ¨ <code>install</code> çš„ç›‘å¬å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–ç¼“å­˜å¹¶æ·»åŠ ç¦»çº¿åº”ç”¨æ—¶æ‰€éœ€çš„æ–‡ä»¶</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;install&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[Service Worker] Install&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ExtendableEvent.waitUntil() æ–¹æ³•å‘Šè¯‰äº‹ä»¶åˆ†å‘å™¨è¯¥äº‹ä»¶ä»åœ¨è¿›è¡Œã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥ç”¨äºæ£€æµ‹è¿›è¡Œçš„ä»»åŠ¡æ˜¯å¦æˆåŠŸã€‚åœ¨æœåŠ¡å·¥ä½œçº¿ç¨‹ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å‘Šè¯‰æµè§ˆå™¨äº‹ä»¶ä¸€ç›´è¿›è¡Œï¼Œç›´è‡³ promise è§£å†³ï¼Œæµè§ˆå™¨ä¸åº”è¯¥åœ¨äº‹ä»¶ä¸­çš„å¼‚æ­¥æ“ä½œå®Œæˆä¹‹å‰ç»ˆæ­¢æœåŠ¡å·¥ä½œçº¿ç¨‹ã€‚è¿™é‡Œå°±æ˜¯åœ¨ç¼“å­˜æ“ä½œå®Œæˆåæ‰èƒ½ç»ˆæ­¢æœåŠ¡å·¥ä½œçº¿ç¨‹åœ¨æ­¤ä¹‹å‰å°†æœåŠ¡å·¥ä½œçº¿ç¨‹ä¿æŒåœ¨ installingé˜¶æ®µ</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
      <span class="token operator">-</span>ã€‹ç¼“å­˜æ“ä½œ
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[Service Worker] Caching all: app shell and content&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contentToCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç¼“å­˜æ“ä½œ-ã€‹é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå­˜å‚¨ç¼“å­˜åå­—çš„å˜é‡ï¼ŒApp Shell æ‰€éœ€çš„æ–‡ä»¶è®°å½•</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> cacheName <span class="token operator">=</span> <span class="token string">&#39;ç¼“å­˜åå­—xxx&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> appShellFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token comment">//éœ€è¦ç¼“å­˜çš„æ–‡ä»¶</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/index.html&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/app.js&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/style.css&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/fonts/graduate.eot&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/fonts/graduate.ttf&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/fonts/graduate.woff&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/favicon.ico&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/img/js13kgames.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/img/bg.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-32.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-64.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-96.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-128.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-168.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-192.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-256.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-512.png&#39;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>æ¿€æ´»ï¼š<code>activate</code> äº‹ä»¶ï¼Œå®ƒçš„ç”¨æ³•è·Ÿ <code>install</code> äº‹ä»¶ç›¸åŒã€‚è¿™ä¸ªäº‹ä»¶é€šå¸¸ç”¨æ¥åˆ é™¤é‚£äº›æˆ‘ä»¬å·²ç»ä¸éœ€è¦çš„æ–‡ä»¶æˆ–è€…åšä¸€äº›æ¸…ç†å·¥ä½œã€‚</p><ol><li><p>æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;activate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">keyList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keyList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>å“åº”è¯·æ±‚ï¼š<code>fetch</code> äº‹ä»¶å¯¹æˆ‘ä»¬å¾ˆæœ‰ç”¨ï¼Œå®ƒåœ¨æ¯æ¬¡åº”ç”¨å‘èµ· HTTP è¯·æ±‚çš„æ—¶å€™è¢«è§¦å‘ã€‚è¿™ä¸ªäº‹ä»¶å¯¹æˆ‘ä»¬æ¥è¯´éå¸¸æœ‰ç”¨ï¼Œå®ƒå…è®¸æˆ‘ä»¬æ‹¦æˆªè¯·æ±‚å¹¶å¯¹è¯·æ±‚ä½œå‡ºè‡ªå®šä¹‰çš„å“åº”ã€‚</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;service worker è¯·æ±‚çš„url-ã€‹&#39;</span><span class="token operator">+</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å®é™…ä½¿ç”¨â€”â€”ã€‹å½“ç¼“å­˜å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¼“å­˜æ¥æä¾›æœåŠ¡ï¼Œè€Œä¸é‡æ–°è¯·æ±‚æ•°æ®ã€‚ä¸ç®¡å½“å‰åº”ç”¨æ˜¯åœ¨çº¿è¿˜æ˜¯ç¦»çº¿ï¼Œæˆ‘ä»¬éƒ½è¿™ä¹ˆåšã€‚å½“è¯·æ±‚çš„æ–‡ä»¶ä¸åœ¨ç¼“å­˜ä¸­æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨å“åº”ä¹‹å‰å°†æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//e.respondWith æ–¹æ³•å°†ä¼šæ¥ç®¡å“åº”æ§åˆ¶ï¼Œå®ƒä¼šä½œä¸ºæœåŠ¡å™¨å’Œåº”ç”¨ä¹‹é—´çš„ä»£ç†æœåŠ¡ã€‚å®ƒå…è®¸æˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªè¯·æ±‚ä½œå‡ºæˆ‘ä»¬æƒ³è¦çš„ä»»ä½•å“åº”ï¼šService Worker ä¼šå¤„ç†è¿™ä¸€åˆ‡ï¼Œä»ç¼“å­˜ä¸­è·å–è¿™äº›æ•°æ®ï¼Œå¹¶åœ¨éœ€è¦çš„æƒ…å†µä¸‹å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹ã€‚</span>
  e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
      <span class="token comment">//æ£€æŸ¥ç»™å®šçš„ Request æ˜¯å¦æ˜¯ CacheStorage å¯¹è±¡è·Ÿè¸ªçš„ä»»ä½• Cache å¯¹è±¡çš„é”®ï¼Œå¹¶è¿”å›ä¸€ä¸ª resolve ä¸ºè¯¥åŒ¹é…çš„ Promise .</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[Service Worker] Fetching resource: &#39;</span><span class="token operator">+</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å°±å‘è¯·æ±‚ç„¶åç¼“å­˜</span>
      <span class="token keyword">return</span> r <span class="token operator">||</span> <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li></ol><h4 id="cacheså¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#cacheså¯¹è±¡" aria-hidden="true">#</a> cacheså¯¹è±¡</h4>`,9),jn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API",target:"_blank",rel:"noopener noreferrer"},Sn=n("strong",null,[n("code",null,"caches")],-1),In={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage",target:"_blank",rel:"noopener noreferrer"},Pn=n("code",null,"CacheStorage",-1),Cn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/open",target:"_blank",rel:"noopener noreferrer"},zn=n("code",null,"CacheStorage.open()",-1),An={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},Wn=n("code",null,"Promise",-1),Nn=n("code",null,"cacheName",-1),Dn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},En=n("code",null,"Cache",-1),On={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/delete",target:"_blank",rel:"noopener noreferrer"},Rn=n("code",null,"CacheStorage.delete()",-1),Bn=n("code",null,"cacheName",-1),Mn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},Tn=n("code",null,"Cache",-1),Ln={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},Un=n("code",null,"Cache",-1),Fn={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},Hn=n("code",null,"Promise",-1),Kn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},Vn=n("code",null,"Cache",-1),Jn=n("code",null,"false",-1),Gn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/keys",target:"_blank",rel:"noopener noreferrer"},Xn=n("code",null,"CacheStorage.keys()",-1),Yn={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},$n=n("code",null,"Promise",-1),Qn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage",target:"_blank",rel:"noopener noreferrer"},Zn=n("code",null,"CacheStorage",-1),ns={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},ss=n("code",null,"Cache",-1),as={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},ts=n("code",null,"Cache",-1),es={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/match",target:"_blank",rel:"noopener noreferrer"},ps=n("code",null,"CacheStorage.match()",-1),os={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request",target:"_blank",rel:"noopener noreferrer"},cs=n("code",null,"Request",-1),ls={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage",target:"_blank",rel:"noopener noreferrer"},is=n("code",null,"CacheStorage",-1),us={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},rs=n("code",null,"Cache",-1),ds={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},ks=n("code",null,"Promise",-1),vs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/has",target:"_blank",rel:"noopener noreferrer"},ms=n("code",null,"CacheStorage.has()",-1),bs=n("code",null,"cacheName",-1),gs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},hs=n("code",null,"Cache",-1),fs={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},_s=n("code",null,"Promise",-1),ys=e(`<h4 id="æ›´æ–°service-worker" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°service-worker" aria-hidden="true">#</a> æ›´æ–°service worker</h4><p>æˆ‘ä»¬å­˜æ”¾åœ¨ç¼“å­˜åç§°ä¸­çš„ç‰ˆæœ¬å·æ˜¯è¿™ä¸ªé—®é¢˜çš„å…³é”®</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> cacheName <span class="token operator">=</span> <span class="token string">&#39;js13kPWA-v1&#39;</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬æŠŠç‰ˆæœ¬å·æ›´æ–°åˆ° v2ï¼ŒService Worker ä¼šå°†æˆ‘ä»¬æ‰€æœ‰çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬é‚£äº›æ–°çš„æ–‡ä»¶ï¼‰æ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„ç¼“å­˜ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>contentToCache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-32.png&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;install&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;js13kPWA-v2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contentToCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ—¶å€™ä¸€ä¸ªæ–°çš„ Service Worker ä¼šåœ¨åå°è¢«å®‰è£…ï¼Œè€Œæ—§çš„ Service Worker ä»ç„¶ä¼šæ­£å¸¸è¿è¡Œï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•é¡µé¢ä½¿ç”¨åˆ°å®ƒä¸ºæ­¢ï¼Œè¿™æ—¶å€™æ–°çš„ Service Worker å°†ä¼šè¢«æ¿€æ´»ï¼Œç„¶åæ¥ç®¡æ‰€æœ‰çš„é¡µé¢ã€‚</p><h2 id="_8-pwa-æ¶ˆæ¯æ¨é€å’Œé€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#_8-pwa-æ¶ˆæ¯æ¨é€å’Œé€šçŸ¥" aria-hidden="true">#</a> 8.PWA-æ¶ˆæ¯æ¨é€å’Œé€šçŸ¥</h2><p>https://developer.mozilla.org/zh-CN/docs/Web/API/Push_APIæ¨é€API</p><p>https://developer.mozilla.org/zh-CN/docs/Web/API/Notifications_APIé€šçŸ¥API</p><h3 id="_1-è¯·æ±‚æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_1-è¯·æ±‚æˆæƒ" aria-hidden="true">#</a> 1.è¯·æ±‚æˆæƒ</h3><p>æœ€å¥½é€šè¿‡ä¸€äº›å¼•å¯¼ç”¨æˆ·çš„äº‹ä»¶å»è§¦å‘</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">&#39;granted&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">randomNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨æˆ·çš„æˆæƒçš„ç»“æœæœ‰ä¸‰ç§ï¼Œdefaultï¼ˆé»˜è®¤ï¼‰ã€grantedï¼ˆå…è®¸ï¼‰æˆ–è€… deniedï¼ˆæ‹’ç»ï¼‰ï¼Œå½“ç”¨æˆ·æ²¡æœ‰åšå‡ºé€‰æ‹©çš„æ—¶å€™ï¼Œæˆæƒç»“æœä¼šè¿”å› defaultï¼Œ å¦å¤–ä¸¤ç§ç»“æœåˆ†åˆ«åœ¨ç”¨æˆ·é€‰æ‹©äº†å…è®¸æˆ–è€…æ‹’ç»çš„æ—¶å€™è¿”å›ã€‚ä¸€æ—¦ç”¨æˆ·é€‰æ‹©æˆæƒï¼Œè¿™ä¸ªæˆæƒç»“æœå¯¹é€šçŸ¥ API å’Œæ¨é€ API ä¸¤è€…éƒ½æœ‰æ•ˆã€‚</p><h3 id="_2-åˆ›å»ºé€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#_2-åˆ›å»ºé€šçŸ¥" aria-hidden="true">#</a> 2.åˆ›å»ºé€šçŸ¥</h3><p>åœ¨æˆæƒä¹‹åå¯ä»¥åˆ›å»ºé€šçŸ¥æ¶ˆæ¯</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token keyword">function</span> <span class="token function">noti</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">&#39;granted&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">randomNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">&#39;denied&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">noti</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">noti</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">function</span> <span class="token function">randomNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> notifTitle <span class="token operator">=</span> <span class="token string">&#39;è¿™æ˜¯é€šçŸ¥æ ‡é¢˜&#39;</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> notifBody <span class="token operator">=</span> <span class="token string">&#39;é€šçŸ¥å†…å®¹&#39;</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> notifImg <span class="token operator">=</span> <span class="token string">&#39;./bgc.png&#39;</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">body</span><span class="token operator">:</span> notifBody<span class="token punctuation">,</span>
                <span class="token literal-property property">icon</span><span class="token operator">:</span> notifImg
            <span class="token punctuation">}</span>
            <span class="token keyword">var</span> notif <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span>notifTitle<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span>randomNotification<span class="token punctuation">,</span> <span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+r+`" alt="image-20230508185124595"></p><h3 id="_3-æ¶ˆæ¯æ¨é€" tabindex="-1"><a class="header-anchor" href="#_3-æ¶ˆæ¯æ¨é€" aria-hidden="true">#</a> 3.æ¶ˆæ¯æ¨é€</h3><p>åœ¨ Service Worker å†…éƒ¨ï¼Œå­˜åœ¨ä¸€ä¸ªæ¶ˆæ¯æ¨é€æœåŠ¡è®¢é˜…æœºåˆ¶ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>registration<span class="token punctuation">.</span>pushManager<span class="token punctuation">.</span><span class="token function">getSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token comment">/* ... */</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,20),ws={href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/push_event",target:"_blank",rel:"noopener noreferrer"},qs=n("code",null,"push",-1),xs=e(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>self.addEventListener(&#39;push&#39;, function(e) { /* ... */ });
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>demo:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Register a Service Worker.</span>
navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&#39;service-worker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>ready
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">registration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç”¨PushManagerè·å–ç”¨æˆ·å¯¹æœåŠ¡ç«¯æ¨é€æœåŠ¡çš„è®¢é˜… </span>
  <span class="token keyword">return</span> registration<span class="token punctuation">.</span>pushManager<span class="token punctuation">.</span><span class="token function">getSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">subscription</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//å¦‚æœç”¨æˆ·å·²ç»å®Œæˆè®¢é˜…ï¼Œæˆ‘ä»¬ç›´æ¥è¿”å› subscription å¯¹è±¡å¹¶ä¸”è·³è½¬åˆ°è®¢é˜…éƒ¨åˆ†ã€‚å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ subscription å¯¹è±¡ï¼š</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subscription<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> subscription<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">//App ä¼šä»æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªå…¬é’¥å¹¶ä¸”æŠŠå“åº”ç»“æœè½¬åŒ–æˆæ–‡æœ¬ï¼Œæœ€åå®ƒè¿˜éœ€è¦è½¬åŒ–æˆä¸€ä¸ª Uint8Arrayï¼ˆä¸ºäº†å…¼å®¹ Chromeï¼‰ã€‚</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;./vapidPublicKey&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vapidPublicKey <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> convertedVapidKey <span class="token operator">=</span> <span class="token function">urlBase64ToUint8Array</span><span class="token punctuation">(</span>vapidPublicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//App ç°åœ¨å¯ä»¥ä½¿ç”¨ PushManager æ¥è®¢é˜…æ–°ç”¨æˆ·ã€‚è¿™ä¸ªæ–¹æ³•æ”¯æŒä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ userVisibleOnly: trueï¼Œæ„æ€æ˜¯å‘é€ç»™ç”¨æˆ·çš„æ‰€æœ‰é€šçŸ¥å¯¹ä»–ä»¬éƒ½æ˜¯å¯è§çš„ï¼Œç¬¬äºŒä¸ªæ˜¯ applicationServerKeyï¼Œè¿™ä¸ªå‚æ•°åŒ…å«æˆ‘ä»¬ä¹‹å‰ä»æœåŠ¡ç«¯å–å¾—å¹¶è½¬åŒ–çš„ VAPID keyã€‚</span>
    <span class="token keyword">return</span> registration<span class="token punctuation">.</span>pushManager<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">userVisibleOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">applicationServerKey</span><span class="token operator">:</span> convertedVapidKey
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">subscription</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// é¦–å…ˆä½¿ç”¨ fetch å°† subscription ä»¥ JSON çš„æ–¹å¼å‘é€ç»™æœåŠ¡å™¨ã€‚</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;./register&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;Content-type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">subscription</span><span class="token operator">:</span> subscription
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;doIt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> payload <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;notification-payload&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">const</span> delay <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;notification-delay&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ttl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;notification-ttl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>

<span class="token comment">//å½“æŒ‰é’®è¢«ç‚¹å‡»çš„æ—¶å€™ï¼Œfetch ä¼šè¯·æ±‚æœåŠ¡å™¨æ ¹æ®ç»™å®šçš„å‚æ•°å‘é€é€šçŸ¥ï¼Œpayload å‚æ•°åŒ…å«é€šçŸ¥é‡Œé¢è¦æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œdelay å‚æ•°å®šä¹‰äº†é€šçŸ¥å°†ä¼šå»¶è¿Ÿå±•ç¤ºçš„ç§’æ•°ï¼Œttl æ˜¯ time-to-live çš„ç¼©å†™ï¼Œç”¨æ¥è®¾ç½®é€šçŸ¥åœ¨æœåŠ¡å™¨ä¸Šçš„å­˜æ´»æ—¶é—´ï¼Œä¾ç„¶æ˜¯ä»¥ç§’ä¸ºå•ä½ã€‚</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;./sendNotification&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#39;Content-type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">subscription</span><span class="token operator">:</span> subscription<span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> payload<span class="token punctuation">,</span>
        <span class="token literal-property property">delay</span><span class="token operator">:</span> delay<span class="token punctuation">,</span>
        <span class="token literal-property property">ttl</span><span class="token operator">:</span> ttl<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœåŠ¡ç«¯</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Use the web-push library to hide the implementation details of the communication</span>
<span class="token comment">// between the application server and the push service.</span>
<span class="token comment">// For details, see https://tools.ietf.org/html/draft-ietf-webpush-protocol and</span>
<span class="token comment">// https://tools.ietf.org/html/draft-ietf-webpush-encryption.</span>
<span class="token keyword">const</span> webPush <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;web-push&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//web-push æ¨¡å—è¢«ç”¨æ¥é…ç½® VAPID å¯†é’¥ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œè¿˜å¯ä»¥ç”Ÿæˆä¸€ä¸ªã€‚</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PUBLIC_KEY</span> <span class="token operator">||</span> <span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PRIVATE_KEY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token string">&quot;You must set the VAPID_PUBLIC_KEY and VAPID_PRIVATE_KEY &quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;environment variables. You can use the following ones:&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>webPush<span class="token punctuation">.</span><span class="token function">generateVAPIDKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Set the keys used for encrypting the push messages.</span>
webPush<span class="token punctuation">.</span><span class="token function">setVapidDetails</span><span class="token punctuation">(</span>
  <span class="token string">&quot;https://example.com/&quot;</span><span class="token punctuation">,</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PUBLIC_KEY</span><span class="token punctuation">,</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PRIVATE_KEY</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¸€ä¸ªæ¨¡å—å®šä¹‰å¹¶å¯¼å‡ºäº†æ‰€æœ‰åº”ç”¨éœ€è¦å¤„ç†çš„è·¯ç”±ï¼šè·å– VAPID å…¬é’¥ã€æ³¨å†Œã€å‘é€é€šçŸ¥ç­‰ç­‰ã€‚ä½ å¯ä»¥çœ‹åˆ°æ¥è‡ª index.js çš„ payload, delay å’Œttl å˜é‡åœ¨è¿™é‡Œè¢«ç”¨åˆ°äº†ã€‚</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>route <span class="token operator">+</span> <span class="token string">&quot;vapidPublicKey&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PUBLIC_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>route <span class="token operator">+</span> <span class="token string">&quot;register&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// A real world application would store the subscription info.</span>
    res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>route <span class="token operator">+</span> <span class="token string">&quot;sendNotification&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subscription <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>subscription<span class="token punctuation">;</span>
    <span class="token keyword">const</span> payload <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token constant">TTL</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>ttl<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      webPush
        <span class="token punctuation">.</span><span class="token function">sendNotification</span><span class="token punctuation">(</span>subscription<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>delay <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>serviceâ€”â€”worker</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//å®ƒåšçš„å°±åªæ˜¯ç›‘å¬ push (en-US) äº‹ä»¶ï¼Œåˆ›å»º payload å˜é‡ï¼Œè¿™ä¸ªå˜é‡åŒ…å«äº†æ¥è‡ª event.data çš„æ–‡æœ¬ï¼ˆå¦‚æœ data æ˜¯ç©ºçš„ï¼Œå°±è®¾ç½®æˆ &quot;no payload&quot; å­—ç¬¦ä¸²ï¼‰ï¼Œç„¶åä¸€ç›´ç­‰åˆ°é€šçŸ¥æ¨é€ç»™ç”¨æˆ·ä¸ºæ­¢ã€‚</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;push&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Retrieve the textual payload from event.data (a PushMessageData object).</span>
  <span class="token comment">// æ”¯æŒArrayBuffer, Blob, JSON è¿™äº›æ•°æ®</span>
  <span class="token keyword">const</span> payload <span class="token operator">=</span> event<span class="token punctuation">.</span>data <span class="token operator">?</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;no data&#39;</span><span class="token punctuation">;</span>
  <span class="token comment">// ä¿æŒæ¨é€çŠ¶æ€ç›´åˆ°æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„æ¨é€</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    <span class="token comment">// Show a notification with title &#39;ServiceWorker Cookbook&#39; and use the payload</span>
    <span class="token comment">// as the body.</span>
    self<span class="token punctuation">.</span>registration<span class="token punctuation">.</span><span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">&#39;ServiceWorker Cookbook&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> payload<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-mutationoberver" tabindex="-1"><a class="header-anchor" href="#_9-mutationoberver" aria-hidden="true">#</a> 9.MutationOberver</h2>`,8),js={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver",target:"_blank",rel:"noopener noreferrer"},Ss=n("code",null,"MutationObserver",-1),Is=n("p",null,"è¯­æ³•ï¼š",-1),Ps=e(`<li><p>è¯¥æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> mo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li>`,1),Cs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationRecord",target:"_blank",rel:"noopener noreferrer"},zs=n("code",null,"MutationRecord",-1),As=n("code",null,"MutationObserver",-1),Ws=n("p",null,"è¯¥å®ä¾‹èº«ä¸Šæœ‰ä¸‰ä¸ªæ–¹æ³•",-1),Ns={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/disconnect",target:"_blank",rel:"noopener noreferrer"},Ds=n("code",null,"disconnect()",-1),Es=n("code",null,"MutationObserver",-1),Os={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/observe",target:"_blank",rel:"noopener noreferrer"},Rs=n("code",null,"observe()",-1),Bs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/observe",target:"_blank",rel:"noopener noreferrer"},Ms=n("code",null,"observe()",-1),Ts=n("code",null,"MutationObserver",-1),Ls={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/takeRecords",target:"_blank",rel:"noopener noreferrer"},Us=n("code",null,"takeRecords()",-1),Fs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationRecord",target:"_blank",rel:"noopener noreferrer"},Hs=n("code",null,"MutationRecord",-1),Ks={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array",target:"_blank",rel:"noopener noreferrer"},Vs=n("code",null,"Array",-1),Js=e(`<li><p>observeå¿…é¡»è¦æŒ‡å®šé…ç½®è§‚å¯Ÿä»€ä¹ˆå˜åŠ¨ï¼Œæ¯å½“è§‚å¯Ÿå¸¦çš„é…ç½®å˜åŠ¨å°±ä¼šè§¦å‘å›è°ƒçš„æ‰§è¡Œ</p><ol><li><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// è§‚å¯Ÿå™¨çš„é…ç½®ï¼ˆéœ€è¦è§‚å¯Ÿä»€ä¹ˆå˜åŠ¨ï¼‰</span>
<span class="token keyword">interface</span> <span class="token class-name">IObserverConfig</span> <span class="token punctuation">{</span>
    subtree<span class="token operator">:</span> <span class="token builtin">boolean</span>  <span class="token comment">//ç›‘å¬ä»¥targetä¸ºæ ¹èŠ‚ç‚¹çš„æ•´ä¸ªå­æ ‘åŠå…¶å­æ ‘çš„å±æ€§ï¼Œ</span>
    childList<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">//ç›‘å¬targetèŠ‚ç‚¹å‘ç”Ÿçš„èŠ‚ç‚¹æ–°å¢æˆ–åˆ é™¤ï¼ˆå¦‚æœsubtreeä¸ºtrueæ•´ä¸ªå­æ ‘éƒ½ç”Ÿæ•ˆï¼‰</span>
    attributes<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">//ç›‘å¬èŠ‚ç‚¹å±æ€§å€¼çš„å˜åŒ–  é»˜è®¤ä¸ºtrue ä½†ä¸€æ—¦å£°æ˜characterDataOldValue|attributeFilteré»˜è®¤å€¼å°±å˜ä¸ºfalse</span>
    attributeFilter<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token comment">// å£°æ˜ä¸€ä¸ªå±æ€§åæ•°ç»„ç”¨äºç›‘å¬ã€‚ä¸è¿‡ä¸å£°æ˜é»˜è®¤ä»»ä½•å±æ€§å˜åŒ–éƒ½è§¦å‘å›è°ƒ</span>
    attributeOldValue<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// è®°å½•ä¸Šä¸€æ¬¡è¢«ç›‘å¬èŠ‚ç‚¹çš„å±æ€§å˜åŒ–</span>
    characterData<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// ç›‘å¬targetèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å­—ç¬¦å˜åŒ– é»˜è®¤å€¼true  å¦‚æœå£°æ˜äº†characterDataOldValueé»˜è®¤å€¼false</span>
    characterDataOldValue<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// è®°å½•ä¸Šä¸€ä¸ªè¢«ç›‘å¬èŠ‚ç‚¹ä¸­å‘ç”Ÿçš„æ–‡æœ¬å˜åŒ– é»˜è®¤false</span>
<span class="token punctuation">}</span>
MutationObserver <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span>

MutationObserver
disconnect

Æ’ <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
observe

Æ’ <span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
takeRecords

Æ’ <span class="token function">takeRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>ä»£ç å±•ç¤º</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ul id<span class="token operator">=</span><span class="token string">&quot;ul&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">4</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>aaa<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>

        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;btn&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;ul&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">MutationRecord<span class="token punctuation">,</span> MutationObserver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            MutationRecord<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutation<span class="token punctuation">,</span> MutationObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> mo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        <span class="token keyword">const</span> observeConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        mo<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>ul<span class="token punctuation">,</span> observeConfig<span class="token punctuation">)</span>
        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> iterator <span class="token keyword">of</span> ul<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            ul<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">?</span> ul<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token operator">...</span>ul<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token operator">:</span> ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token operator">...</span>children<span class="token punctuation">)</span>
            Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> mo<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li>`,2),Gs=n("h2",{id:"_10-å­˜å‚¨ç›¸å…³indexeddb",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_10-å­˜å‚¨ç›¸å…³indexeddb","aria-hidden":"true"},"#"),s(" 10.å­˜å‚¨ç›¸å…³IndexedDB")],-1),Xs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API",target:"_blank",rel:"noopener noreferrer"},Ys=e('<p>ä»€ä¹ˆæ˜¯IndexedDBï¼Ÿ<strong>IndexedDB æ˜¯ä¸€ä¸ªåŸºäº JavaScript çš„é¢å‘å¯¹è±¡æ•°æ®åº“ã€‚</strong></p><p>æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ<strong>æ¥å£æ˜¯å¼‚æ­¥çš„ä¸”æ”¯æŒäº‹åŠ¡ï¼ˆè¦ä¹ˆå…¨éƒ¨æˆåŠŸ è¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼‰</strong></p><p>ä½¿ç”¨IndexedDBæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›å‰ç½®çŸ¥è¯†ï¼š</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>1.å­˜å‚¨é™åˆ¶</p></div><p>æµè§ˆå™¨çš„æœ€å¤§å­˜å‚¨ç©ºé—´æ˜¯åŠ¨æ€çš„â€”â€”å®ƒå–å†³äºæ‚¨çš„ç¡¬ç›˜å¤§å°ã€‚</p><p><strong>å…¨å±€é™åˆ¶</strong>ä¸ºå¯ç”¨ç£ç›˜ç©ºé—´çš„ 50ï¼…ã€‚åœ¨ Firefox ä¸­ï¼Œä¸€ä¸ªåä¸º Quota Manager çš„å†…éƒ¨æµè§ˆå™¨å·¥å…·ä¼šè·Ÿè¸ªæ¯ä¸ªæºç”¨å°½çš„ç£ç›˜ç©ºé—´ï¼Œå¹¶åœ¨å¿…è¦æ—¶åˆ é™¤æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœæ‚¨çš„ç¡¬ç›˜é©±åŠ¨å™¨æ˜¯ 500GBï¼Œé‚£ä¹ˆæµè§ˆå™¨çš„æ€»å­˜å‚¨å®¹é‡ä¸º 250GBã€‚å¦‚æœè¶…è¿‡æ­¤èŒƒå›´ï¼Œåˆ™ä¼šå‘èµ·ç§°ä¸º<strong>æºå›æ”¶</strong>çš„è¿‡ç¨‹ï¼Œåˆ é™¤æ•´ä¸ªæºçš„æ•°æ®ï¼Œç›´åˆ°å­˜å‚¨é‡å†æ¬¡ä½äºé™åˆ¶ã€‚åˆ é™¤æºæ•°æ®æ²¡æœ‰åªåˆ ä¸€éƒ¨åˆ†çš„è¯´æ³•â€”â€”å› ä¸ºè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>è¿˜æœ‰å¦ä¸€ä¸ªé™åˆ¶ç§°ä¸º<strong>ç»„é™åˆ¶</strong>â€”â€”è¿™è¢«å®šä¹‰ä¸ºå…¨å±€é™åˆ¶çš„ 20ï¼…ï¼Œä½†å®ƒè‡³å°‘æœ‰ 10 MBï¼Œæœ€å¤§ä¸º 2GBã€‚æ¯ä¸ªæºéƒ½æ˜¯ä¸€ç»„ï¼ˆæºç»„ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚æ¯ä¸ª eTLD+1 åŸŸéƒ½æœ‰ä¸€ä¸ªç»„ã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>mozilla.org</code>â€”â€”ç»„ 1ï¼Œæº 1</li><li><code>www.mozilla.org</code>â€”â€”ç»„ 1ï¼Œæº 2</li><li><code>joe.blogs.mozilla.org</code>â€”â€”ç»„ 1ï¼Œæº 3</li><li><code>firefox.com</code> â€”â€”ç»„ 2ï¼Œæº 4</li></ul><p>åœ¨è¿™ä¸ªç»„ä¸­ï¼Œ<code>mozilla.org</code>ã€<code>www.mozilla.org</code>å’Œ<code>joe.blogs.mozilla.org</code>å¯ä»¥èšåˆä½¿ç”¨æœ€å¤š 20ï¼…çš„å…¨å±€é™åˆ¶ã€‚firefox.com å•ç‹¬æœ€å¤šä½¿ç”¨ 20ï¼…ã€‚</p><p><strong>è§£é‡Šä»¥ä¸‹ç»„é™åˆ¶</strong>ï¼šç»„é™åˆ¶å®é™…ä¸Šæ˜¯å¯¹åŒä¸€ä¸ªåŸŸåä¸‹çš„å¤šä¸ªæºçš„å­˜å‚¨ç©ºé—´è¿›è¡Œé™åˆ¶ï¼Œä»¥é¿å…å…¶ä¸­ä¸€ä¸ªæºå ç”¨è¿‡å¤šçš„å­˜å‚¨ç©ºé—´å½±å“å…¶ä»–æºçš„æ­£å¸¸ä½¿ç”¨ã€‚è€Œæºé™åˆ¶åˆ™æ˜¯å¯¹æ¯ä¸ªå•ç‹¬çš„æºçš„å­˜å‚¨ç©ºé—´è¿›è¡Œé™åˆ¶ï¼Œä»¥é¿å…è¯¥æºå ç”¨è¿‡å¤šçš„å­˜å‚¨ç©ºé—´å½±å“è‡ªèº«çš„ä½¿ç”¨å’Œå…¶ä»–æºçš„ä½¿ç”¨ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨" aria-hidden="true">#</a> å¦‚ä½•ä½¿ç”¨</h3>',12),$s=e(`<li><p>å…¼å®¹æ€§åˆ¤æ–­</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Your browser doesn&#39;t support a stable version of IndexedDB. Such and such feature will not be available.&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>`,1),Qs=n("code",null,"onupgradeneeded",-1),Zs={href:"https://developer.mozilla.org/en-US/docs/Web/API/IDBVersionChangeEvent",target:"_blank",rel:"noopener noreferrer"},na=n("code",null,"db ",-1),sa=n("code",null,"onversionchange",-1),aa=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//è¯¥ open æ–¹æ³•æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±æ˜¯æ•°æ®åº“çš„ç‰ˆæœ¬å·ã€‚æ•°æ®åº“çš„ç‰ˆæœ¬å†³å®šäº†æ•°æ®åº“æ¶æ„ï¼Œå³æ•°æ®åº“çš„å¯¹è±¡ä»“åº“ï¼ˆobject storeï¼‰å’Œä»–çš„ç»“æ„ã€‚å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œopen æ“ä½œä¼šåˆ›å»ºè¯¥æ•°æ®åº“ï¼Œç„¶å onupgradeneeded äº‹ä»¶è¢«è§¦å‘ï¼Œä½ éœ€è¦åœ¨è¯¥äº‹ä»¶çš„å¤„ç†å‡½æ•°ä¸­åˆ›å»ºæ•°æ®åº“æ¨¡å¼ã€‚å¦‚æœæ•°æ®åº“å·²ç»å­˜åœ¨ï¼Œä½†ä½ æŒ‡å®šäº†ä¸€ä¸ªæ›´é«˜çš„æ•°æ®åº“ç‰ˆæœ¬ï¼Œä¼šç›´æ¥è§¦å‘ onupgradeneeded äº‹ä»¶ï¼Œå…è®¸ä½ åœ¨å¤„ç†å‡½æ•°ä¸­æ›´æ–°æ•°æ®åº“æ¨¡å¼ã€‚</span>
<span class="token comment">// æ‰“å¼€æˆ‘ä»¬çš„æ•°æ®åº“open å‡½æ•°çš„ç»“æœæ˜¯ä¸€ä¸ª IDBDatabase å¯¹è±¡çš„å®ä¾‹ ã€‚</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;MyTestDatabase&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//open è¯·æ±‚ä¸ä¼šç«‹å³æ‰“å¼€æ•°æ®åº“æˆ–è€…å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ã€‚å¯¹ open() å‡½æ•°çš„è°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥ä½œä¸ºäº‹ä»¶æ¥å¤„ç†çš„åŒ…å« resultï¼ˆæˆåŠŸçš„è¯ï¼‰æˆ–è€…é”™è¯¯å€¼çš„ IDBOpenDBRequest  å¯¹è±¡ã€‚åœ¨ IndexedDB ä¸­çš„å¤§éƒ¨åˆ†å¼‚æ­¥æ–¹æ³•åšçš„éƒ½æ˜¯åŒæ ·çš„äº‹æƒ… - è¿”å›ä¸€ä¸ªåŒ…å« result æˆ–é”™è¯¯çš„ IDBRequest (en-US) å¯¹è±¡ã€‚</span>


<span class="token comment">// è¯¥äº‹ä»¶ä»…åœ¨è¾ƒæ–°çš„æµè§ˆå™¨ä¸­å®ç°äº†</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¿å­˜ IDBDataBase æ¥å£</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>

  <span class="token comment">// ä¸ºè¯¥æ•°æ®åº“åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä»“åº“</span>
  <span class="token keyword">const</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">keyPath</span><span class="token operator">:</span> <span class="token string">&quot;myKey&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°è¯•åˆ›å»ºä¸€ä¸ªä¸å·²å­˜åœ¨çš„å¯¹è±¡ä»“åº“é‡åï¼ˆæˆ–åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„å¯¹è±¡ä»“åº“ï¼‰ä¼šæŠ›å‡ºé”™è¯¯ã€‚å¦‚æœ <code>onupgradeneeded</code>äº‹ä»¶æˆåŠŸæ‰§è¡Œå®Œæˆï¼Œæ‰“å¼€æ•°æ®åº“è¯·æ±‚çš„ <code>onsuccess</code> å¤„ç†å‡½æ•°ä¼šè¢«è§¦å‘ã€‚</p>`,2),ta=e(`<li><p>æ·»åŠ æˆåŠŸå’Œå¤±è´¥å¤„ç†å‡½æ•°</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with request.errorCode!</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶å‘é€ä¸€ä¸ªè¯·æ±‚æ¥æ‰§è¡Œä¸€äº›æ•°æ®åº“æ“ä½œï¼Œåƒå¢åŠ æˆ–æå–æ•°æ®ç­‰ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">keyPath</span><span class="token operator">:</span> <span class="token string">&quot;custom_info&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>`,2),ea=e(`<p>ç®€å•çš„ä¾‹å­</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>        <span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">&quot;my_test_db&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token keyword">null</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// é”™è¯¯å¤„ç†</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token comment">// å»ºç«‹ä¸€ä¸ªå¯¹è±¡ä»“åº“æ¥å­˜å‚¨æˆ‘ä»¬å®¢æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬é€‰æ‹© custom_info ä½œä¸ºé”®è·¯å¾„ï¼ˆkey pathï¼‰</span>
            <span class="token comment">// å› ä¸º ssn å¯ä»¥ä¿è¯æ˜¯ä¸é‡å¤çš„</span>
            <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">keyPath</span><span class="token operator">:</span> <span class="token string">&quot;custom_info&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// å»ºç«‹ä¸€ä¸ªç´¢å¼•æ¥é€šè¿‡å§“åæ¥æœç´¢å®¢æˆ·ã€‚åå­—å¯èƒ½ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ unique ç´¢å¼•</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// ä½¿ç”¨é‚®ç®±å»ºç«‹ç´¢å¼•ï¼Œæˆ‘ä»¬å‘ç¡®ä¿å®¢æˆ·çš„é‚®ç®±ä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ unique ç´¢å¼•</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// ä½¿ç”¨äº‹åŠ¡çš„ oncomplete äº‹ä»¶ç¡®ä¿åœ¨æ’å…¥æ•°æ®å‰å¯¹è±¡ä»“åº“å·²ç»åˆ›å»ºå®Œæ¯•</span>
            objectStore<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å°†æ•°æ®ä¿å­˜åˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ä»“åº“</span>
                <span class="token keyword">const</span> customerObjectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                customerData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    customerObjectStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>onupgradeneeded</code> æ˜¯æˆ‘ä»¬å”¯ä¸€å¯ä»¥ä¿®æ”¹æ•°æ®åº“ç»“æ„çš„åœ°æ–¹ã€‚åœ¨è¿™é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå’Œåˆ é™¤å¯¹è±¡å­˜å‚¨ç©ºé—´ä»¥åŠæ„å»ºå’Œåˆ é™¤ç´¢å¼•ã€‚ä½†æ˜¯è¯¥æ–¹æ³•åªæœ‰åˆ›å»ºæ–°çš„æ•°æ®åº“å’Œæ›´æ–°ç‰ˆæœ¬æ—¶æ‰ä¼šè°ƒç”¨ã€‚å¦‚æœæˆ‘ä»¬æ“ä½œå·²å­˜åœ¨çš„æ•°æ®åº“éœ€è¦åœ¨<code>onsuccess</code>äº‹ä»¶ä¸­å–<code>e.target.result</code></p></div><h3 id="å®ä¾‹æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹æ–¹æ³•" aria-hidden="true">#</a> å®ä¾‹æ–¹æ³•</h3><h4 id="createobjectstore" tabindex="-1"><a class="header-anchor" href="#createobjectstore" aria-hidden="true">#</a> createObjectStore</h4><p>è¯¥æ–¹æ³•ç›¸å½“äºåˆ›å»ºäº†ä¸€å¼ è¡¨ã€‚è¯¥æ–¹æ³•åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ObjectStore</p><blockquote><h6 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°" aria-hidden="true">#</a> å‚æ•°</h6></blockquote><ol><li><p>name</p><p>è¢«åˆ›å»ºçš„ object store çš„åç§°ã€‚nameå¯ä»¥æ˜¯ç©ºã€‚è¿™ä¸ªnameå¯ä»¥ç†è§£ä¸ºè¡¨å</p></li><li><p>optionalParametersï¼ˆå¯é€‰ï¼‰</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>optionalParameters <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//æŒ‡å®šå¯¹è±¡ä»“åº“ä¸­æ¯ä¸ªå¯¹è±¡çš„ä¸»é”®ï¼ˆprimary keyï¼‰çš„åç§°æˆ–è·¯å¾„ï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ä½¿ç”¨è‡ªå¢é•¿çš„æ•´æ•°ä½œä¸ºä¸»é”®ã€‚ã€‚</span>
    keyPath<span class="token operator">:</span><span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">//æŒ‡å®šæ˜¯å¦ä½¿ç”¨è‡ªå¢é•¿çš„æ•´æ•°ä½œä¸ºä¸»é”®ã€‚å¦‚æœä¸º trueï¼Œåˆ™è¡¨ç¤ºä½¿ç”¨è‡ªå¢é•¿çš„æ•´æ•°ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸º falseï¼Œåˆ™è¡¨ç¤ºä¸ä½¿ç”¨è‡ªå¢é•¿çš„æ•´æ•°ä½œä¸ºä¸»é”®ã€‚é»˜è®¤ä¸º falseã€‚</span>
    autoIncrement<span class="token operator">:</span><span class="token builtin">boolean</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è¿”å›å€¼</p><p>æ–°åˆ›å»ºçš„ object store å¯¹è±¡ã€‚è¡¨å®ä¾‹å¯¹è±¡</p></li></ol><h4 id="deleteobjectstore" tabindex="-1"><a class="header-anchor" href="#deleteobjectstore" aria-hidden="true">#</a> deleteObjectStore</h4>`,9),pa=n("strong",null,[n("code",null,"eleteObjectStore()")],-1),oa={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IDBDatabase",target:"_blank",rel:"noopener noreferrer"},ca=n("code",null,"IDBDatabase",-1),la=e(`<p>å‚æ•° name</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> dbName <span class="token operator">=</span> <span class="token string">&quot;sampleDB&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dbVersion <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> dbVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>oldVersion <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;store1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>oldVersion <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;store1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;store2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="transaction" tabindex="-1"><a class="header-anchor" href="#transaction" aria-hidden="true">#</a> transaction</h4><p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªäº‹åŠ¡å¯¹è±¡ï¼Œé€šè¿‡è¯¥å¯¹è±¡æˆ‘ä»¬å¯ä»¥è¿›è¡Œå¢åˆ æ”¹æŸ¥,äº‹åŠ¡æä¾›äº†ä¸‰ç§æ¨¡å¼ï¼š<code>readonly</code>ã€<code>readwrite</code> å’Œ <code>versionchange</code>ã€‚</p><blockquote><h6 id="å‚æ•°-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-1" aria-hidden="true">#</a> å‚æ•°</h6><p>1.<code>storeNamesï¼šstring | string[]</code></p><p>2.<code>mode?:&#39;readonly&#39;|&#39;readwrite&#39;|&#39;readwriteflush&#39;</code> é»˜è®¤åªè¯»</p><p>3.<code>durability?:&#39;default&#39;|&#39;strict&#39;|&#39;relaxed&#39;</code>é»˜è®¤default</p><p>durability æå€¡ç”¨relaxedå¯¹äºä¸´æ—¶æ•°æ® strictæ›´é‡è§†æ•°æ®å®‰å…¨çš„æƒ…å†µä¸‹ä½¿ç”¨</p></blockquote><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>
        <span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">&quot;my_test_db&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token keyword">null</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// é”™è¯¯å¤„ç†</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token comment">// å»ºç«‹ä¸€ä¸ªå¯¹è±¡ä»“åº“æ¥å­˜å‚¨æˆ‘ä»¬å®¢æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬é€‰æ‹© custom_info ä½œä¸ºé”®è·¯å¾„ï¼ˆkey pathï¼‰</span>
            <span class="token comment">// å› ä¸º ssn å¯ä»¥ä¿è¯æ˜¯ä¸é‡å¤çš„</span>
            <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">&quot;custom_info&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// å»ºç«‹ä¸€ä¸ªç´¢å¼•æ¥é€šè¿‡å§“åæ¥æœç´¢å®¢æˆ·ã€‚åå­—å¯èƒ½ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ unique ç´¢å¼•</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&#39;customers&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> transactions <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">)</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span>

        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¢-åˆ -æ”¹-æŸ¥" tabindex="-1"><a class="header-anchor" href="#å¢-åˆ -æ”¹-æŸ¥" aria-hidden="true">#</a> å¢ åˆ  æ”¹ æŸ¥</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">&quot;my_test_db&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token keyword">null</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// é”™è¯¯å¤„ç†</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
            <span class="token comment">// å¯¹è±¡ä»“åº“  </span>
            <span class="token keyword">const</span> customers_store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&#39;customers&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;readwrite&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æŸ¥æ•°æ®</span>
            <span class="token keyword">const</span> get_res <span class="token operator">=</span> customers_store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
            get_res<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// é”™è¯¯å¤„ç†ï¼</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å‡ºé”™äº†&#39;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            get_res<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¯¹ request.result åšäº›æ“ä½œï¼</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>get_res<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// // æ’å…¥æ•°æ®</span>
            <span class="token comment">// const add_res = customers_store.add({ email: &#39;xxxx@qq.com&#39;, age: 26, name: &#39;fancy&#39; });</span>

            <span class="token comment">// add_res.onerror = function (event) {</span>
            <span class="token comment">//     // é”™è¯¯å¤„ç†ï¼</span>
            <span class="token comment">//     console.log(&#39;å‡ºé”™äº†&#39;, event)</span>
            <span class="token comment">// };</span>
            <span class="token comment">// add_res.onsuccess = function (event) {</span>
            <span class="token comment">//     // å¯¹ request.result åšäº›æ“ä½œï¼</span>
            <span class="token comment">//     console.log(add_res.result);</span>
            <span class="token comment">// };</span>

            <span class="token comment">// ä¿®æ”¹æ•°æ®</span>
            <span class="token comment">// const put_res = customers_store.put({</span>
            <span class="token comment">//     user_id: 1,</span>
            <span class="token comment">//     email: &#39;1074121761.163.com&#39;</span>
            <span class="token comment">// })</span>
            <span class="token comment">// put_res.onerror = function (event) {</span>
            <span class="token comment">//     // é”™è¯¯å¤„ç†ï¼</span>
            <span class="token comment">//     console.log(&#39;å‡ºé”™äº†&#39;)</span>
            <span class="token comment">// };</span>
            <span class="token comment">// put_res.onsuccess = function (event) {</span>
            <span class="token comment">//     // å¯¹ request.result åšäº›æ“ä½œï¼</span>
            <span class="token comment">//     console.log(put_res.result);</span>
            <span class="token comment">// };</span>
            <span class="token comment">// åˆ é™¤æ•°æ®</span>
            <span class="token comment">// const delete_res = customers_store.delete(1)</span>
            <span class="token comment">// delete_res.onerror = function (event) {</span>
            <span class="token comment">//     // é”™è¯¯å¤„ç†ï¼</span>
            <span class="token comment">//     console.log(&#39;å‡ºé”™äº†&#39;)</span>
            <span class="token comment">// };</span>
            <span class="token comment">// delete_res.onsuccess = function (event) {</span>
            <span class="token comment">//     // å¯¹ request.result åšäº›æ“ä½œï¼</span>
            <span class="token comment">//     console.log(delete_res.result);</span>
            <span class="token comment">// };</span>

            <span class="token comment">// åœ¨æ‰€æœ‰æ•°æ®æ·»åŠ å®Œæ¯•åçš„å¤„ç†</span>
            customers_store<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// alert(&quot;All done!&quot;);</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            customers_store<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ä¸è¦å¿˜è®°é”™è¯¯å¤„ç†ï¼</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;äº‹åŠ¡é”™è¯¯&#39;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="add" tabindex="-1"><a class="header-anchor" href="#add" aria-hidden="true">#</a> add</h4><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>add() æ–¹æ³•çš„è°ƒç”¨æ—¶ï¼Œå¯¹è±¡ä»“åº“ä¸­ä¸èƒ½å­˜åœ¨ç›¸åŒé”®çš„å¯¹è±¡ã€‚å¦‚æœä½ æƒ³ä¿®æ”¹ä¸€ä¸ªå·²å­˜åœ¨çš„æ¡ç›®ï¼Œæˆ–è€…ä½ ä¸å…³å¿ƒè¯¥æ•°æ®æ˜¯å¦å·²å­˜åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ put() æ–¹æ³•</p></div><h4 id="put" tabindex="-1"><a class="header-anchor" href="#put" aria-hidden="true">#</a> put</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// é”™è¯¯å¤„ç†</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–æˆ‘ä»¬æƒ³è¦æ›´æ–°çš„æ•°æ®</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>

  <span class="token comment">// æ›´æ–°ä½ æƒ³ä¿®æ”¹çš„æ•°æ®</span>
  data<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

  <span class="token comment">// æŠŠæ›´æ–°è¿‡çš„å¯¹è±¡æ”¾å›æ•°æ®åº“</span>
  <span class="token keyword">var</span> requestUpdate <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
   requestUpdate<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// é”™è¯¯å¤„ç†</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   requestUpdate<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// å®Œæˆï¼Œæ•°æ®å·²æ›´æ–°ï¼</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="delete" tabindex="-1"><a class="header-anchor" href="#delete" aria-hidden="true">#</a> delete</h4><h4 id="get" tabindex="-1"><a class="header-anchor" href="#get" aria-hidden="true">#</a> get</h4><p>è¿™é‡Œåªç”¨åˆ°ä¸€ä¸ªå¯¹è±¡ä»“åº“ï¼Œä½ å¯ä»¥åªä¼ è¯¥å¯¹è±¡ä»“åº“çš„åå­—ä½œä¸ºå‚æ•°ï¼Œè€Œä¸å¿…ä¼ ä¸€ä¸ªåˆ—è¡¨ã€‚å¹¶ä¸”ï¼Œä½ åªéœ€è¯»å–æ•°æ®ï¼Œæ‰€ä»¥ä¸éœ€è¦ <code>readwrite</code> äº‹åŠ¡ã€‚ä¸æŒ‡å®šäº‹åŠ¡æ¨¡å¼æ¥è°ƒç”¨ <code>transaction</code> ä½ ä¼šå¾—åˆ°ä¸€ä¸ª <code>readonly</code> äº‹åŠ¡ã€‚å¦å¤–ä¸€ä¸ªå¾®å¦™çš„åœ°æ–¹åœ¨äºä½ å¹¶æ²¡æœ‰ä¿å­˜è¯·æ±‚å¯¹è±¡åˆ°å˜é‡ä¸­ã€‚å› ä¸º DOM äº‹ä»¶æŠŠè¯·æ±‚ä½œä¸ºä»–çš„ç›®æ ‡ï¼ˆtargetï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨è¯¥äº‹ä»¶æ¥è·å– <code>result</code> å±æ€§ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ä½™ç‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Name for SSN 444-44-4444 is &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="getall" tabindex="-1"><a class="header-anchor" href="#getall" aria-hidden="true">#</a> getAll</h4><p>è¿™ä¸ªgetALLæ–¹å¼å’Œä¸Šé¢çš„æ¸¸æ ‡æŸ¥è¯¢ç»“æœç›¸åŒã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Got all customers: &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="getallkeys" tabindex="-1"><a class="header-anchor" href="#getallkeys" aria-hidden="true">#</a> getAllKeys</h4><p>æ£€ç´¢å¯¹è±¡å­˜å‚¨ä¸­ä¸æŒ‡å®šå‚æ•°åŒ¹é…çš„æ‰€æœ‰å¯¹è±¡çš„è®°å½•é”®ã€‚å¦‚æœæ²¡ç»™å‚æ•°åˆ™ç»™å‡ºæ‰€æœ‰å¯¹è±¡çš„è®°å½•é”®ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">getAllKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">getAllKeys</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
<span class="token function">getAllKeys</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> count<span class="token punctuation">)</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">åç§°</th><th style="text-align:left;">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left;">query</td><td style="text-align:left;">è¦æŸ¥è¯¢çš„é”®æˆ–IDBKeyRangeã€‚å¦‚æœä¸ä¼ é€’ä»»ä½•ä¿¡æ¯ï¼Œåˆ™é»˜è®¤ä¸ºé€‰æ‹©æ­¤å¯¹è±¡å­˜å‚¨ä¸­çš„æ‰€æœ‰è®°å½•çš„é”®èŒƒå›´ã€‚</td></tr><tr><td style="text-align:left;">count</td><td style="text-align:left;">æŒ‡å®šå¦‚æœæ‰¾åˆ°å¤šä¸ªå€¼è¦è¿”å›çš„å€¼çš„æ•°é‡ã€‚å¦‚æœå®ƒå°äº0æˆ–å¤§äº2^32 - 1ï¼Œåˆ™ä¼šæŠ›å‡ºTypeErrorå¼‚å¸¸ã€‚</td></tr></tbody></table><h4 id="ä½¿ç”¨ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç´¢å¼•" aria-hidden="true">#</a> ä½¿ç”¨ç´¢å¼•</h4><p>å¦‚æœä½ æƒ³è¦é€šè¿‡å§“åæ¥æŸ¥æ‰¾ä¸€ä¸ªå®¢æˆ·ï¼Œé‚£ä¹ˆï¼Œä½ å°†éœ€è¦åœ¨æ•°æ®åº“ä¸­è¿­ä»£æ‰€æœ‰çš„ä¸»é”® ç›´åˆ°ä½ æ‰¾åˆ°æ­£ç¡®çš„é‚£ä¸ªã€‚ä»¥è¿™ç§æ–¹å¼æ¥æŸ¥æ‰¾å°†ä¼šéå¸¸çš„æ…¢ï¼Œç›¸åä½ å¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// é¦–å…ˆï¼Œç¡®å®šä½ å·²ç»åœ¨ request.onupgradeneeded ä¸­åˆ›å»ºäº†ç´¢å¼•ï¼š</span>
<span class="token comment">// objectStore.createIndex(&quot;name&quot;, &quot;name&quot;);</span>
<span class="token comment">// å¦åˆ™ä½ å°†å¾—åˆ° DOMExceptionã€‚</span>
<span class="token keyword">var</span> index <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

index<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;Donna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Donna&#39;s SSN is &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">.</span>ssn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä½¿ç”¨æ¸¸æ ‡" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ¸¸æ ‡" aria-hidden="true">#</a> ä½¿ç”¨æ¸¸æ ‡</h4><p>ä½¿ç”¨ <code>get()</code> è¦æ±‚ä½ çŸ¥é“ä½ æƒ³è¦æ£€ç´¢å“ªä¸€ä¸ªé”®ã€‚å¦‚æœä½ æƒ³è¦éå†å¯¹è±¡å­˜å‚¨ç©ºé—´ä¸­çš„æ‰€æœ‰å€¼ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨æ¸¸æ ‡ã€‚çœ‹èµ·æ¥ä¼šåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

objectStore<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Name for SSN &quot;</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>key <span class="token operator">+</span> <span class="token string">&quot; is &quot;</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;éå†å®Œæ¯•&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>openCursor()</code> å‡½æ•°éœ€è¦å‡ ä¸ªå‚æ•°ã€‚é¦–å…ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª key range å¯¹è±¡æ¥é™åˆ¶è¢«æ£€ç´¢çš„é¡¹ç›®çš„èŒƒå›´ã€‚ç¬¬äºŒï¼Œä½ å¯ä»¥æŒ‡å®šä½ å¸Œæœ›è¿›è¡Œè¿­ä»£çš„æ–¹å‘ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ä»¥å‡åºè¿­ä»£æ‰€æœ‰çš„å¯¹è±¡ã€‚æ¸¸æ ‡æˆåŠŸçš„å›è°ƒæœ‰ç‚¹ç‰¹åˆ«ã€‚æ¸¸æ ‡å¯¹è±¡æœ¬èº«æ˜¯è¯·æ±‚çš„ <code>result</code> ï¼ˆä¸Šé¢æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç®€å†™å½¢å¼ï¼Œæ‰€ä»¥æ˜¯ <code>event.target.result</code>ï¼‰ã€‚ç„¶åå®é™…çš„ key å’Œ value å¯ä»¥æ ¹æ®æ¸¸æ ‡å¯¹è±¡çš„ <code>key</code> å’Œ <code>value</code> å±æ€§è¢«æ‰¾åˆ°ã€‚å¦‚æœä½ æƒ³è¦ä¿æŒç»§ç»­å‰è¡Œï¼Œé‚£ä¹ˆä½ å¿…é¡»è°ƒç”¨æ¸¸æ ‡ä¸Šçš„ <code>continue()</code> ã€‚å½“ä½ å·²ç»åˆ°è¾¾æ•°æ®çš„æœ«å°¾æ—¶ï¼ˆæˆ–è€…æ²¡æœ‰åŒ¹é… <code>openCursor()</code> è¯·æ±‚çš„æ¡ç›®ï¼‰ä½ ä»ç„¶ä¼šå¾—åˆ°ä¸€ä¸ªæˆåŠŸå›è°ƒï¼Œä½†æ˜¯ <code>result</code> å±æ€§æ˜¯ <code>undefined</code>ã€‚</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>æŸ¥çœ‹æ¸¸æ ‡çš„ <code>value</code> å±æ€§ä¼šå¸¦æ¥æ€§èƒ½æ¶ˆè€—ï¼Œå› ä¸ºå¯¹è±¡æ˜¯è¢«æ‡’ç”Ÿæˆçš„ã€‚</p></div><p>å¦‚æœä½ éœ€è¦è®¿é—®å¸¦æœ‰ç»™å®š <code>name</code> çš„æ‰€æœ‰çš„è®°å½•ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¸¸æ ‡ã€‚ä½ å¯ä»¥åœ¨ç´¢å¼•ä¸Šæ‰“å¼€ä¸¤ä¸ªä¸åŒç±»å‹çš„æ¸¸æ ‡ã€‚ä¸€ä¸ªå¸¸è§„æ¸¸æ ‡æ˜ å°„ç´¢å¼•å±æ€§åˆ°å¯¹è±¡å­˜å‚¨ç©ºé—´ä¸­çš„å¯¹è±¡ã€‚ä¸€ä¸ªé”®ç´¢å¼•æ˜ å°„ç´¢å¼•å±æ€§åˆ°ç”¨æ¥å­˜å‚¨å¯¹è±¡å­˜å‚¨ç©ºé—´ä¸­çš„å¯¹è±¡çš„é”®ã€‚ä¸åŒä¹‹å¤„è¢«å±•ç¤ºå¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>index<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// cursor.key æ˜¯ä¸€ä¸ª nameï¼Œå°±åƒ &quot;Bill&quot;, ç„¶å cursor.value æ˜¯æ•´ä¸ªå¯¹è±¡ã€‚</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Name: &quot;</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>key <span class="token operator">+</span> <span class="token string">&quot;, SSN: &quot;</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>ssn <span class="token operator">+</span> <span class="token string">&quot;, email: &quot;</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

index<span class="token punctuation">.</span><span class="token function">openKeyCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// cursor.key æ˜¯ä¸€ä¸ª nameï¼Œå°±åƒ &quot;Bill&quot;, ç„¶å cursor.value æ˜¯é‚£ä¸ª SSNã€‚</span>
    <span class="token comment">// æ²¡æœ‰åŠæ³•å¯ä»¥å¾—åˆ°å­˜å‚¨å¯¹è±¡çš„å…¶ä½™éƒ¨åˆ†ã€‚</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Name: &quot;</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>key <span class="token operator">+</span> <span class="token string">&quot;, SSN: &quot;</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŒ‡å®šæ¸¸æ ‡çš„èŒƒå›´å’Œæ–¹å‘ï¼š</p><p>å¦‚æœä½ æƒ³è¦é™å®šä½ åœ¨æ¸¸æ ‡ä¸­çœ‹åˆ°çš„å€¼çš„èŒƒå›´ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª key range å¯¹è±¡ç„¶åæŠŠå®ƒä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ ç»™ <code>openCursor()</code> æˆ–æ˜¯ <code>openKeyCursor()</code>ã€‚ä½ å¯ä»¥æ„é€ ä¸€ä¸ªåªå…è®¸ä¸€ä¸ªå•ä¸€ key çš„ key rangeï¼Œæˆ–è€…ä¸€ä¸ªå…·æœ‰ä¸‹é™æˆ–ä¸Šé™ï¼Œæˆ–è€…ä¸€ä¸ªæ—¢æœ‰ä¸Šé™ä¹Ÿæœ‰ä¸‹é™ã€‚è¾¹ç•Œå¯ä»¥æ˜¯â€œé—­åˆçš„â€ï¼ˆä¹Ÿå°±æ˜¯è¯´ key range åŒ…å«ç»™å®šçš„å€¼ï¼‰æˆ–è€…æ˜¯â€œå¼€æ”¾çš„â€ï¼ˆä¹Ÿå°±æ˜¯è¯´ key range ä¸åŒ…æ‹¬ç»™å®šçš„å€¼ï¼‰ã€‚è¿™é‡Œæ˜¯å®ƒå¦‚ä½•å·¥ä½œçš„ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ä»…åŒ¹é… &quot;Donna&quot;</span>
<span class="token keyword">var</span> singleKeyRange <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token string">&quot;Donna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åŒ¹é…æ‰€æœ‰è¶…è¿‡â€œBillâ€çš„ï¼ŒåŒ…æ‹¬â€œBillâ€</span>
<span class="token keyword">var</span> lowerBoundKeyRange <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span><span class="token string">&quot;Bill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åŒ¹é…æ‰€æœ‰è¶…è¿‡â€œBillâ€çš„ï¼Œä½†ä¸åŒ…æ‹¬â€œBillâ€</span>
<span class="token keyword">var</span> lowerBoundOpenKeyRange <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span><span class="token string">&quot;Bill&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åŒ¹é…æ‰€æœ‰ä¸è¶…è¿‡â€œDonnaâ€çš„ï¼Œä½†ä¸åŒ…æ‹¬â€œDonnaâ€</span>
<span class="token keyword">var</span> upperBoundOpenKeyRange <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span><span class="token string">&quot;Donna&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åŒ¹é…æ‰€æœ‰åœ¨â€œBillâ€å’Œâ€œDonnaâ€ä¹‹é—´çš„ï¼Œä½†ä¸åŒ…æ‹¬â€œDonnaâ€</span>
<span class="token keyword">var</span> boundKeyRange <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">&quot;Bill&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Donna&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªé”®èŒƒå›´ï¼ŒæŠŠå®ƒä½œä¸º openCursor()/openKeyCursor çš„ç¬¬ä¸€ä¸ªå‚æ•°</span>
<span class="token comment">//åˆ‡æ¢æ–¹å‘æ˜¯é€šè¿‡ä¼ é€’ prev åˆ° openCursor(boundKeyRange,&#39;prev&#39;) æ–¹æ³•æ¥å®ç°çš„ï¼šå¦‚æœä½ åªæ˜¯æƒ³æ”¹å˜éå†çš„æ–¹å‘ï¼Œè€Œä¸æƒ³å¯¹ç»“æœè¿›è¡Œç­›é€‰ï¼Œä½ åªéœ€è¦ç»™ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ nullã€‚</span>
index<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>boundKeyRange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å½“åŒ¹é…æ—¶è¿›è¡Œä¸€äº›æ“ä½œ</span>
    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å»é‡</strong>å¦‚æœä½ æƒ³è¦åœ¨æ¸¸æ ‡åœ¨ç´¢å¼•è¿­ä»£è¿‡ç¨‹ä¸­è¿‡æ»¤å‡ºé‡å¤çš„ï¼Œä½ å¯ä»¥ä¼ é€’ <code>nextunique</code> ï¼ˆæˆ– <code>prevunique</code> å¦‚æœä½ æ­£åœ¨å‘åå¯»æ‰¾ï¼‰ä½œä¸ºæ–¹å‘å‚æ•°ã€‚å½“ <code>nextunique</code> æˆ–æ˜¯ <code>prevunique</code> è¢«ä½¿ç”¨æ—¶ï¼Œè¢«è¿”å›çš„é‚£ä¸ªæ€»æ˜¯é”®æœ€å°çš„è®°å½•ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>index<span class="token punctuation">.</span><span class="token function">openKeyCursor</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> IDBCursor<span class="token punctuation">.</span>nextunique<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something with the entries.</span>
    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="â€”å…ƒç´ -æ ·å¼ç›¸å…³apisâ€”" tabindex="-1"><a class="header-anchor" href="#â€”å…ƒç´ -æ ·å¼ç›¸å…³apisâ€”" aria-hidden="true">#</a> â€”å…ƒç´ /æ ·å¼ç›¸å…³APIsâ€”</h2><h3 id="_1-getcomputedstyle" tabindex="-1"><a class="header-anchor" href="#_1-getcomputedstyle" aria-hidden="true">#</a> 1.getComputedStyle</h3><p><code>Window.getComputedStyle()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨åº”ç”¨æ´»åŠ¨æ ·å¼è¡¨å¹¶è§£æè¿™äº›å€¼å¯èƒ½åŒ…å«çš„ä»»ä½•åŸºæœ¬è®¡ç®—åæŠ¥å‘Šå…ƒç´ çš„æ‰€æœ‰ CSS å±æ€§çš„å€¼ã€‚ç§æœ‰çš„ CSS å±æ€§å€¼å¯ä»¥é€šè¿‡å¯¹è±¡æä¾›çš„ API æˆ–é€šè¿‡ç®€å•åœ°ä½¿ç”¨ CSS å±æ€§åç§°è¿›è¡Œç´¢å¼•æ¥è®¿é—®ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>element
ç”¨äºè·å–è®¡ç®—æ ·å¼çš„Elementã€‚

pseudoElt å¯é€‰
æŒ‡å®šä¸€ä¸ªè¦åŒ¹é…çš„ä¼ªå…ƒç´ çš„å­—ç¬¦ä¸²ã€‚å¿…é¡»å¯¹æ™®é€šå…ƒç´ çœç•¥ï¼ˆæˆ–<span class="token keyword">null</span>ï¼‰ã€‚
<span class="token keyword">let</span> style <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">[</span>pseudoElt<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
è¿”å›çš„styleæ˜¯ä¸€ä¸ªå®æ—¶çš„ CSSStyleDeclaration å¯¹è±¡ï¼Œå½“å…ƒç´ çš„æ ·å¼æ›´æ”¹æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ›´æ–°æœ¬èº«ã€‚

 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>h3<span class="token punctuation">,</span> <span class="token string">&#39;::after&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,42),ia={class:"custom-container tip"},ua=n("p",{class:"custom-container-title"},"TIP",-1),ra={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/style",target:"_blank",rel:"noopener noreferrer"},da=n("code",null,"style",-1),ka=n("code",null,"getComputedStyle",-1),va=n("code",null,"<style>",-1),ma=n("code",null,"elt.style",-1),ba=n("h3",{id:"_2-animate",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-animate","aria-hidden":"true"},"#"),s(" 2.animate")],-1),ga=n("code",null,"Element",-1),ha=n("strong",null,[n("code",null,"animate()")],-1),fa={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Animation",target:"_blank",rel:"noopener noreferrer"},_a=n("code",null,"Animation",-1),ya={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Animation",target:"_blank",rel:"noopener noreferrer"},wa=n("code",null,"Animation",-1),qa=e(`<p><strong>â‘ ä½¿ç”¨æ–¹å¼</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>æŸå…ƒç´ <span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>keyframes<span class="token punctuation">,</span>options<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>â‘¡å‚æ•°</strong></p>`,3),xa=n("code",null,"1.keyframes",-1),ja=n("code",null,"æ•°ç»„",-1),Sa={href:"https://developer.mozilla.org/en-US/docs/Web/API/KeyframeEffect/getKeyframes",target:"_blank",rel:"noopener noreferrer"},Ia=n("code",null,"getKeyframes()",-1),Pa=e(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>keyframes<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> object
element<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token comment">// from</span>
    opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token comment">// to</span>
    opacity<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> <span class="token string">&quot;#000&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
element<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> offset<span class="token operator">:</span> <span class="token number">0.7</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//offset çš„å€¼å¿…é¡»æ˜¯åœ¨ [0.0, 1.0] è¿™ä¸ªåŒºé—´å†…ï¼Œä¸”é¡»å‡åºæ’åˆ—ã€‚</span>
 <span class="token comment">//å¹¶éæ‰€æœ‰çš„å…³é”®å¸§éƒ½éœ€è¦è®¾ç½® offsetã€‚æ²¡æœ‰æŒ‡å®š offset çš„å…³é”®å¸§å°†ä¸ç›¸é‚»çš„å…³é”®å¸§å‡åŒ€é—´éš”ã€‚ å¯ä»¥é€šè¿‡æä¾›easingè¿‡æ¸¡æ¥ç»™æŒ‡å®šå…³é”®å¸§ä¹‹é—´åº”ç”¨è¿‡æ¸¡æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤º</span>
element<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> easing<span class="token operator">:</span> <span class="token string">&#39;ease-out&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> easing<span class="token operator">:</span> <span class="token string">&#39;ease-in&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹è±¡æ ¼å¼å…³é”®å¸§</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>element<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// [ from, to ]</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span>   <span class="token punctuation">[</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;#000&quot;</span> <span class="token punctuation">]</span> <span class="token comment">// [ from, to ]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
element<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.8</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// [ 0, 0.8, 1 ] çš„ç®€å†™</span>
  <span class="token literal-property property">easing</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;ease-in&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ease-out&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),Ca=n("code",null,"2.options",-1),za=n("strong",null,"ä»£è¡¨åŠ¨ç”»æŒç»­æ—¶é—´çš„æ•´æ•°",-1),Aa={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/KeyframeEffect/KeyframeEffect#%E5%8F%82%E6%95%B0",target:"_blank",rel:"noopener noreferrer"},Wa=n("code",null,"KeyframeEffect()",-1),Na=e(`<p><code>3.id</code> å¯é€‰åœ¨ <code>animate()</code> é‡Œå¯ä½œä¸ºå”¯ä¸€æ ‡è¯†çš„å±æ€§ï¼šä¸€ä¸ªç”¨æ¥å¼•ç”¨åŠ¨ç”»çš„å­—ç¬¦ä¸²ã€‚</p><p>ç¤ºä¾‹</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  test<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">&#39;rotate(0) scale(1)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">&#39;rotate(360deg) scale(0)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">easing</span><span class="token operator">:</span> <span class="token string">&#39;steps(7, end)&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">direction</span><span class="token operator">:</span> <span class="token string">&quot;reverse&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">playbackRate</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">iterations</span><span class="token operator">:</span> <span class="token number">Infinity</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+d+`" alt=""></p><h2 id="äº‹ä»¶api" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶api" aria-hidden="true">#</a> äº‹ä»¶Api</h2><h3 id="event" tabindex="-1"><a class="header-anchor" href="#event" aria-hidden="true">#</a> Event</h3><p>æ¥å£è¡¨ç¤ºåœ¨ DOM ä¸­å‡ºç°çš„äº‹ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Event</code>åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª <code>Event</code> å¯¹è±¡ã€‚</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">IEventinit</span><span class="token punctuation">{</span>
    bubbles<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">boolean</span>  é»˜è®¤<span class="token boolean">false</span>è¡¨ç¤ºè¯¥äº‹ä»¶æ˜¯å¦å†’æ³¡ã€‚
    cancelable<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">boolean</span> é»˜è®¤å€¼ä¸º <span class="token boolean">false</span>ï¼Œè¡¨ç¤ºè¯¥äº‹ä»¶èƒ½å¦è¢«å–æ¶ˆã€‚
    composed<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">boolean</span> é»˜è®¤å€¼ä¸º <span class="token boolean">false</span>ï¼ŒæŒ‡ç¤ºäº‹ä»¶æ˜¯å¦ä¼šåœ¨å½±å­ <span class="token constant">DOM</span> æ ¹èŠ‚ç‚¹ä¹‹å¤–è§¦å‘ä¾¦å¬å™¨ã€‚
<span class="token punctuation">}</span>

<span class="token keyword">const</span> my_event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span>typeArg<span class="token operator">:</span><span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span>eventinit<span class="token operator">:</span>IEventinit<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>â‘ åˆ›å»ºä¸€ä¸ªäº‹ä»¶</strong></p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> ev <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">&#39;my_event&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// äº‹ä»¶å¯ä»¥åœ¨ä»»ä½•å…ƒç´ è§¦å‘</span>
document<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®ä¾‹å±æ€§" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹å±æ€§" aria-hidden="true">#</a> å®ä¾‹å±æ€§</h4><p><code>1.bubbles</code> è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨æ˜å½“å‰äº‹ä»¶æ˜¯å¦ä¼šå‘ DOM æ ‘ä¸Šå±‚å…ƒç´ å†’æ³¡ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> bool <span class="token operator">=</span> event<span class="token punctuation">.</span>bubbles<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>2.cancelable</code>è¡¨æ˜è¯¥äº‹ä»¶æ˜¯å¦å¯ä»¥è¢«å–æ¶ˆï¼Œå³äº‹ä»¶æ˜¯å¦å¯ä»¥åƒä»æœªå‘ç”Ÿä¸€æ ·è¢«é˜»æ­¢</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>event<span class="token punctuation">.</span>cancelbale 
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> event<span class="token punctuation">.</span>cancelable <span class="token operator">!==</span> <span class="token string">&#39;boolean&#39;</span> <span class="token operator">||</span> event<span class="token punctuation">.</span>cancelable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,15),Da=n("code",null,"3.composed",-1),Ea={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean",target:"_blank",rel:"noopener noreferrer"},Oa=n("code",null,"Boolean",-1),Ra=n("code",null,"true",-1),Ba={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Event/bubbles",target:"_blank",rel:"noopener noreferrer"},Ma=n("code",null,"bubbles",-1),Ta=n("code",null,"true",-1),La={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Event/composedPath",target:"_blank",rel:"noopener noreferrer"},Ua=n("code",null,"composedPath()",-1),Fa=n("code",null,"4.currentTarget",-1),Ha=n("strong",null,[n("code",null,"currentTarget")],-1),Ka={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Event/target",target:"_blank",rel:"noopener noreferrer"},Va=n("code",null,"Event.target",-1),Ja=n("code",null,"5.defaultPrevented",-1),Ga={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Event/preventDefault",target:"_blank",rel:"noopener noreferrer"},Xa=n("code",null,"event.preventDefault()",-1),Ya=n("code",null,"6.isTrusted",-1),$a={href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean",target:"_blank",rel:"noopener noreferrer"},Qa=n("code",null,"Boolean",-1),Za=n("code",null,"true",-1),nt={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/dispatchEvent",target:"_blank",rel:"noopener noreferrer"},st=n("code",null,"EventTarget.dispatchEvent()",-1),at=n("code",null,"false",-1),tt=n("code",null,"7.eventPhase",-1),et={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Event/eventPhase#%E4%BA%8B%E4%BB%B6%E9%98%B6%E6%AE%B5%E5%B8%B8%E9%87%8F",target:"_blank",rel:"noopener noreferrer"},pt=n("h2",{id:"ç½‘ç»œç›‘æ§api",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ç½‘ç»œç›‘æ§api","aria-hidden":"true"},"#"),s(" ç½‘ç»œç›‘æ§API")],-1),ot=n("h3",{id:"_1-navigator-connection",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-navigator-connection","aria-hidden":"true"},"#"),s(" 1.navigator.connection")],-1),ct=n("strong",null,[n("code",null,"Navigator.connection")],-1),lt={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/NetworkInformation",target:"_blank",rel:"noopener noreferrer"},it=n("code",null,"NetworkInformation",-1),ut=e(`<p>è¿”å›è®¾å¤‡æ­£åœ¨ä¸ç½‘ç»œè¿›è¡Œé€šä¿¡çš„è¿æ¥ç±»å‹ã€‚å®ƒå°†æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// rttå»¶è¿Ÿ     donwnlinkå¸¦å®½</span>
navigator<span class="token punctuation">.</span>connection
NetworkInformation <span class="token punctuation">{</span><span class="token literal-property property">onchange</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">effectiveType</span><span class="token operator">:</span> <span class="token string">&#39;4g&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">rtt</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token literal-property property">downlink</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">saveData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.navigator.online</strong></p><p>åˆ¤æ–­æ˜¯å¦åœ¨çº¿ï¼Œbooleanç±»å‹</p><p><strong>3.äº‹ä»¶</strong></p><p><strong>online</strong> å’Œ <strong>offline</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//åœ¨çº¿-ã€‹ç¦»çº¿ä¼šè§¦å‘</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;offline&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//ç¦»çº¿-ã€‹åœ¨çº¿ä¼šè§¦å‘</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;online&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//ç½‘ç»œç±»å‹çš„æ”¹å˜</span>
navigator<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;change&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¦‚ä½•åˆ¤æ–­å¼ºç½‘å’Œå¼±ç½‘ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åˆ¤æ–­å¼ºç½‘å’Œå¼±ç½‘ç¯å¢ƒ" aria-hidden="true">#</a> å¦‚ä½•åˆ¤æ–­å¼ºç½‘å’Œå¼±ç½‘ç¯å¢ƒï¼Ÿ</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span>connection
<span class="token comment">//ç»“æœ</span>
NetworkInformation <span class="token punctuation">{</span><span class="token literal-property property">onchange</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">effectiveType</span><span class="token operator">:</span> <span class="token string">&#39;4g&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">rtt</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">downlink</span><span class="token operator">:</span> <span class="token number">3.35</span><span class="token punctuation">,</span> <span class="token literal-property property">saveData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
<span class="token literal-property property">downlink</span><span class="token operator">:</span> <span class="token number">3.35</span> 
<span class="token literal-property property">effectiveType</span><span class="token operator">:</span> <span class="token string">&quot;4g&quot;</span>
<span class="token literal-property property">onchange</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token literal-property property">rtt</span><span class="token operator">:</span> <span class="token number">100</span>
<span class="token literal-property property">saveData</span><span class="token operator">:</span> <span class="token boolean">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>downlink</code> å½“å‰ç½‘ç»œè¿æ¥çš„ä¼°è®¡ä¸‹è¡Œé€Ÿåº¦ ï¼ˆå•ä½Mbpsï¼‰</li><li><code>effectiveType</code> é€Ÿåº¦ç±»å‹ä¸è®¾å¤‡æ— å…³ï¼ˆslow-2gï¼Œ2gï¼Œ3gï¼Œ4gï¼‰</li><li><code>rtt</code> å½“å‰ç½‘ç»œçš„ä¼°è®¡å¾€è¿”æ—¶é—´</li><li><code>saveData</code> æ˜¯å¦å¤„äºæ•°æ®èŠ‚çœæ¨¡å¼</li></ul><h2 id="æ€§èƒ½ç›‘æ§api" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½ç›‘æ§api" aria-hidden="true">#</a> æ€§èƒ½ç›‘æ§API</h2><p>Performance API æä¾›äº†é‡è¦çš„å†…ç½®æŒ‡æ ‡ï¼Œå¹¶èƒ½å¤Ÿå°†ä½ è‡ªå·±çš„æµ‹é‡ç»“æœæ·»åŠ åˆ°æµè§ˆå™¨çš„æ€§èƒ½æ—¶é—´çº¿ï¼ˆperformance timelineï¼‰ä¸­ã€‚æ€§èƒ½æ—¶é—´çº¿ä½¿ç”¨é«˜ç²¾åº¦çš„æ—¶é—´æˆ³ï¼Œä¸”å¯ä»¥åœ¨å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºã€‚</p>`,12),rt={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Performance",target:"_blank",rel:"noopener noreferrer"},dt=e('<p>å¯¹äºå‰ç«¯ç›‘æ§æ¥è¯´éœ€è¦é‡‡é›†çš„æŒ‡æ ‡æœ‰</p><p><strong>RUM</strong> <strong>(Real User Monitoring) æŒ‡æ ‡</strong>ï¼ŒåŒ…æ‹¬ FP, TTI, FCP, FMP, FID, MPFIDã€‚</p><p><strong>Navigation Timing</strong>ï¼ŒåŒ…æ‹¬ DNS, TCP, DOM è§£æç­‰é˜¶æ®µçš„æŒ‡æ ‡ã€‚</p><p><strong>JS Error</strong>ï¼Œè§£æåå¯ä»¥ç»†åˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ã€ä»¥åŠé™æ€èµ„æºå¼‚å¸¸ã€‚</p><p><strong>è¯·æ±‚çŠ¶æ€ç </strong>ï¼Œé‡‡é›†ä¸ŠæŠ¥åï¼Œå¯ä»¥åˆ†æè¯·æ±‚å¼‚å¸¸ç­‰ä¿¡æ¯ã€‚</p><p>Level2çš„æŒ‡æ ‡</p><p><img src="'+k+`" alt=""></p><p>å¯¹äº<code>performance.timing</code>æŒ‡æ ‡ç”±äºç²¾åº¦ä¸å¤Ÿå°†æ¥ä¼šåºŸå¼ƒï¼Œ</p><h3 id="rumæŒ‡æ ‡é‡‡é›†" tabindex="-1"><a class="header-anchor" href="#rumæŒ‡æ ‡é‡‡é›†" aria-hidden="true">#</a> RUMæŒ‡æ ‡é‡‡é›†</h3><p><strong>çœŸå®ç”¨æˆ·æ€§èƒ½æŒ‡æ ‡</strong>ä¹Ÿå°±æ˜¯ä¸Šæ–‡æœ‰æ‰€æåŠçš„ RUM ä»¥åŠå¹³å°è‡ªå·±æ‰©å±•çš„ä¸€äº›é¢å¤–çš„æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æŒ‡æ ‡ï¼š</p><ul><li><p><strong>é¦–æ¬¡ç»˜åˆ¶æ—¶é—´ï¼ˆ</strong> <strong>FP</strong> <strong>ï¼‰</strong> ï¼šå³ First Paintï¼Œä¸ºé¦–æ¬¡æ¸²æŸ“çš„æ—¶é—´ç‚¹ã€‚</p></li><li><p><strong>é¦–æ¬¡å†…å®¹ç»˜åˆ¶æ—¶é—´ï¼ˆ</strong> <strong>FCP</strong> <strong>ï¼‰</strong> ï¼šå³ First Contentful Paintï¼Œä¸ºé¦–æ¬¡æœ‰å†…å®¹æ¸²æŸ“çš„æ—¶é—´ç‚¹ã€‚</p></li><li><p><strong>é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶æ—¶é—´ï¼ˆ</strong> <strong>FMP</strong> <strong>ï¼‰</strong> ï¼šç”¨æˆ·å¯åŠ¨é¡µé¢åŠ è½½ä¸é¡µé¢å‘ˆç°é¦–å±ä¹‹é—´çš„æ—¶é—´ã€‚</p></li><li><p><strong>é¦–æ¬¡äº¤äº’æ—¶é—´ï¼ˆ</strong> <strong>FID</strong> <strong>ï¼‰</strong> ï¼šå³ First Input Delayï¼Œè®°å½•é¡µé¢åŠ è½½é˜¶æ®µï¼Œç”¨æˆ·é¦–æ¬¡äº¤äº’æ“ä½œçš„å»¶æ—¶æ—¶é—´ã€‚FID æŒ‡æ ‡å½±å“ç”¨æˆ·å¯¹é¡µé¢äº¤äº’æ€§å’Œå“åº”æ€§çš„ç¬¬ä¸€å°è±¡ã€‚</p></li><li><p><strong>äº¤äº’ä¸­æœ€å¤§å»¶æ—¶ï¼ˆ</strong> <strong>MPFID</strong> <strong>ï¼‰</strong> ï¼šé¡µé¢åŠ è½½é˜¶æ®µï¼Œç”¨æˆ·äº¤äº’æ“ä½œå¯èƒ½é‡åˆ°çš„æœ€å¤§å»¶æ—¶æ—¶é—´ã€‚</p></li><li><p><strong>å®Œå…¨å¯äº¤äº’æ—¶é—´ï¼ˆTTI</strong>ï¼‰ï¼šå³ Time to interactiveï¼Œè®°å½•ä»é¡µé¢åŠ è½½å¼€å§‹ï¼Œåˆ°é¡µé¢å¤„äºå®Œå…¨å¯äº¤äº’çŠ¶æ€æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p></li><li><p><strong>é¦–æ¬¡åŠ è½½</strong> <strong>è·³å‡ºç‡</strong>ï¼šç¬¬ä¸€ä¸ªé¡µé¢å®Œå…¨åŠ è½½å‰ç”¨æˆ·è·³å‡ºç‡ã€‚</p></li><li><p><strong>æ…¢å¼€æ¯”</strong>ï¼šå®Œå…¨åŠ è½½è€—æ—¶è¶…è¿‡ 5s çš„ PV å æ¯”ã€‚</p></li></ul><h3 id="timing" tabindex="-1"><a class="header-anchor" href="#timing" aria-hidden="true">#</a> timing</h3><p>æµ‹é‡TCPæ¡æ‰‹æ—¶é—´(connectEnd - connectStart)</p><p>æµ‹é‡DNSæŸ¥æ‰¾æ—¶é—´(domainLookupEnd - domainLookupStart)</p><p>æµ‹é‡é‡å®šå‘æ—¶é—´(redirectEnd - redirectStart)</p><p>æµ‹é‡è¯·æ±‚æ—¶é—´(responseStart - requestStart)</p><p>æµ‹é‡TLSåå•†æ—¶é—´(requestStart - secureConnectionStart)</p><p>æµ‹é‡è·å–æ—¶é—´(æ²¡æœ‰é‡å®šå‘)(responseEnd - fetchStart)</p><p>æµ‹é‡ServiceWorkerå¤„ç†æ—¶é—´(fetchStart - workerStart)</p><p>æ£€æŸ¥å†…å®¹æ˜¯å¦è¢«å‹ç¼©(decodedBodySizeä¸åº”è¯¥æ˜¯encodedBodySize)</p><p>æ£€æŸ¥æœ¬åœ°ç¼“å­˜æ˜¯å¦è¢«å‘½ä¸­(transferSizeåº”è¯¥æ˜¯0)</p><p>æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†ç°ä»£å’Œå¿«é€Ÿçš„åè®®(nextHopProtocolåº”è¯¥æ˜¯HTTP/2æˆ–HTTP/3)</p><p>æ£€æŸ¥æ­£ç¡®çš„èµ„æºæ˜¯å¦è¢«æ¸²æŸ“é˜»å¡(renderBlockingStatus)</p><h2 id="ç½‘ç»œè¯·æ±‚api" tabindex="-1"><a class="header-anchor" href="#ç½‘ç»œè¯·æ±‚api" aria-hidden="true">#</a> ç½‘ç»œè¯·æ±‚API</h2><h3 id="_1ã€xmlhttprequests" tabindex="-1"><a class="header-anchor" href="#_1ã€xmlhttprequests" aria-hidden="true">#</a> 1ã€XMLHttpRequests</h3><p>è¯­æ³•-ã€‹<code>new XMLHttpRequest();</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span>objParameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
objParameters
æœ‰ä¸¤ä¸ªå±æ€§å¯ä»¥è®¾ç½®ï¼š
mozAnon
å¸ƒå°”å€¼ï¼šå°†æ­¤å±æ€§è®¾ç½®ä¸º <span class="token boolean">true</span> å°†ä½¿æµè§ˆå™¨åœ¨è·å–èµ„æºæ—¶ä¸æš´éœ²è‡ªèº«æ¥æºå’Œç”¨æˆ·å‡­æ®ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œè¿™æ„å‘³ç€åªæœ‰æ˜ç¡®æ·»åŠ ä½¿ç”¨ setRequestHeader æ‰ä¼šå‘é€ Cookiesã€‚
mozSystem
å¸ƒå°”å€¼ï¼šå°†æ­¤å±æ€§è®¾ç½®ä¸º <span class="token boolean">true</span> å…è®¸å»ºç«‹è·¨ç«™ç‚¹çš„è¿æ¥ï¼Œè€Œæ— éœ€æœåŠ¡å™¨é€‰æ‹©ä½¿ç”¨ï¼ˆCross<span class="token operator">-</span>Origin Resource Sharing è·¨åŸŸèµ„æºå…±äº«ï¼‰<span class="token operator">*</span>ã€‚å¿…é¡»åŒæ—¶å°†å‚æ•° mozAnon è®¾ç½®ä¸º <span class="token boolean">true</span>ï¼Œå³ä¸èƒ½ä¸ Cookie æˆ–å…¶ä»–ç”¨æˆ·å‡­æ®åŒæ—¶å‘é€ã€‚ä»…é™äºåœ¨ <span class="token function">privileged</span> <span class="token punctuation">(</span>reviewed<span class="token punctuation">)</span> apps èµ·æ•ˆï¼ˆè¯‘è€…æ³¨ï¼šæ­¤å¥åŸæ–‡ This only works <span class="token keyword">in</span> <span class="token function">privileged</span> <span class="token punctuation">(</span>reviewed<span class="token punctuation">)</span> apps<span class="token punctuation">;</span>ï¼‰ï¼›åœ¨ Firefox ä¸Šä»»ä½•ç½‘é¡µåŠ è½½åä¸èµ·ä½œç”¨ï¼ˆè¯‘è€…æ³¨ï¼šæ­¤å¥åŸæ–‡ it does not work on arbitrary webpages loaded <span class="token keyword">in</span> Firefox<span class="token punctuation">.</span>ï¼‰ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®ä¾‹å±æ€§-1" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹å±æ€§-1" aria-hidden="true">#</a> å®ä¾‹å±æ€§</h4><p>1.<code>readyState</code></p><table><thead><tr><th style="text-align:left;">å€¼</th><th style="text-align:left;">çŠ¶æ€</th><th style="text-align:left;">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left;"><code>0</code></td><td style="text-align:left;"><code>UNSENT</code></td><td style="text-align:left;">ä»£ç†è¢«åˆ›å»ºï¼Œä½†å°šæœªè°ƒç”¨ open() æ–¹æ³•ã€‚</td></tr><tr><td style="text-align:left;"><code>1</code></td><td style="text-align:left;"><code>OPENED</code></td><td style="text-align:left;"><code>open()</code> æ–¹æ³•å·²ç»è¢«è°ƒç”¨ã€‚</td></tr><tr><td style="text-align:left;"><code>2</code></td><td style="text-align:left;"><code>HEADERS_RECEIVED</code></td><td style="text-align:left;"><code>send()</code> æ–¹æ³•å·²ç»è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å¤´éƒ¨å’ŒçŠ¶æ€å·²ç»å¯è·å¾—ã€‚</td></tr><tr><td style="text-align:left;"><code>3</code></td><td style="text-align:left;"><code>LOADING</code></td><td style="text-align:left;">ä¸‹è½½ä¸­ï¼›<code>responseText</code> å±æ€§å·²ç»åŒ…å«éƒ¨åˆ†æ•°æ®ã€‚</td></tr><tr><td style="text-align:left;"><code>4</code></td><td style="text-align:left;"><code>DONE</code></td><td style="text-align:left;">ä¸‹è½½æ“ä½œå·²å®Œæˆã€‚</td></tr></tbody></table><p>2.status</p><p>æµè§ˆå™¨çŠ¶æ€ç ï¼Œä¸€èˆ¬ç”±æœåŠ¡å™¨æŒ‡å®šã€‚</p><p>3.response</p><p>å¦‚æœè¯·æ±‚å°šæœªå®Œæˆæˆ–æœªæˆåŠŸï¼Œåˆ™å–å€¼æ˜¯ <code>null</code>ã€‚å› æ­¤åªèƒ½åœ¨raadyStateå€¼ä¸º4æ—¶æ‰èƒ½è·å–åˆ°ç±»å‹</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">&#39;somePage.html&#39;</span><span class="token punctuation">;</span> <span class="token comment">// ä¸€ä¸ªæœ¬åœ°é¡µé¢</span>

<span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.statusText</p>`,36),kt={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/readyState",target:"_blank",rel:"noopener noreferrer"},vt=n("code",null,"readyState",-1),mt=n("code",null,"statusText",-1),bt=e(`<p>5.timeout</p><p>ä»£è¡¨ç€ä¸€ä¸ªè¯·æ±‚åœ¨è¢«è‡ªåŠ¨ç»ˆæ­¢å‰æ‰€æ¶ˆè€—çš„æ¯«ç§’æ•°ã€‚é»˜è®¤å€¼ä¸º 0ï¼Œæ„å‘³ç€æ²¡æœ‰è¶…æ—¶ã€‚</p><p>6.upload</p><p>è¿”å›ä¸€ä¸ªxhrUploadå¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºä¸Šä¼ è¿›åº¦ã€‚</p><p>å¯ä»¥è¢«ç»‘å®šåœ¨ upload å¯¹è±¡ä¸Šçš„äº‹ä»¶ç›‘å¬å™¨å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left;">äº‹ä»¶</th><th style="text-align:left;">ç›¸åº”å±æ€§çš„ä¿¡æ¯ç±»å‹</th></tr></thead><tbody><tr><td style="text-align:left;"><code>onloadstart</code></td><td style="text-align:left;">è·å–å¼€å§‹</td></tr><tr><td style="text-align:left;"><code>onprogress</code></td><td style="text-align:left;">æ•°æ®ä¼ è¾“è¿›è¡Œä¸­</td></tr><tr><td style="text-align:left;"><code>onabort</code></td><td style="text-align:left;">è·å–æ“ä½œç»ˆæ­¢</td></tr><tr><td style="text-align:left;"><code>onerror</code></td><td style="text-align:left;">è·å–å¤±è´¥</td></tr><tr><td style="text-align:left;"><code>onload</code></td><td style="text-align:left;">è·å–æˆåŠŸ</td></tr><tr><td style="text-align:left;"><code>ontimeout</code></td><td style="text-align:left;">è·å–æ“ä½œåœ¨ç”¨æˆ·è§„å®šçš„æ—¶é—´å†…æœªå®Œæˆ</td></tr><tr><td style="text-align:left;"><code>onloadend</code></td><td style="text-align:left;">è·å–å®Œæˆï¼ˆä¸è®ºæˆåŠŸä¸å¦ï¼‰</td></tr></tbody></table><h4 id="å®ä¾‹æ–¹æ³•-1" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹æ–¹æ³•-1" aria-hidden="true">#</a> å®ä¾‹æ–¹æ³•</h4><ul><li><p><code>abort</code>å–æ¶ˆè¯·æ±‚</p></li><li><p><code>getAllResponseHeaders()</code>è¿”å›è¯·æ±‚å¤´</p></li><li><p><code>open</code>åˆå§‹åŒ–ä¸€ä¸ªæ–°åˆ›å»ºçš„è¯·æ±‚ï¼Œæˆ–é‡æ–°åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚ã€‚</p><ul><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>xhrReq<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhrReq<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhrReq<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhrReq<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async<span class="token punctuation">,</span> user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>asyncä¸€ä¸ªå¯é€‰çš„å¸ƒå°”å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¼‚æ­¥æ‰§è¡Œæ“ä½œï¼Œé»˜è®¤ä¸º trueã€‚å¦‚æœå€¼ä¸º falseï¼Œsend() æ–¹æ³•ç›´åˆ°æ”¶åˆ°ç­”å¤å‰ä¸ä¼šè¿”å›ã€‚å¦‚æœ trueï¼Œå·²å®Œæˆäº‹åŠ¡çš„é€šçŸ¥å¯ä¾›äº‹ä»¶ç›‘å¬å™¨ä½¿ç”¨ã€‚å¦‚æœ multipart å±æ€§ä¸º true åˆ™è¿™ä¸ªå¿…é¡»ä¸º trueï¼Œå¦åˆ™å°†å¼•å‘å¼‚å¸¸ã€‚</p></li><li><p>userå¯é€‰çš„ç”¨æˆ·åç”¨äºè®¤è¯ç”¨é€”ï¼›é»˜è®¤ä¸º <code>null</code></p></li><li><p>passwordå¯é€‰çš„å¯†ç ç”¨äºè®¤è¯ç”¨é€”ï¼Œé»˜è®¤ä¸º <code>null</code>ã€‚</p></li></ul></li><li><p><code>send</code>ç”¨äºå‘é€ HTTP è¯·æ±‚ã€‚å¦‚æœæ˜¯å¼‚æ­¥è¯·æ±‚ï¼ˆé»˜è®¤ä¸ºå¼‚æ­¥è¯·æ±‚ï¼‰ï¼Œåˆ™æ­¤æ–¹æ³•ä¼šåœ¨è¯·æ±‚å‘é€åç«‹å³è¿”å›ï¼›å¦‚æœæ˜¯åŒæ­¥è¯·æ±‚ï¼Œåˆ™æ­¤æ–¹æ³•ç›´åˆ°å“åº”åˆ°è¾¾åæ‰ä¼šè¿”å›ã€‚</p><ul><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>XMLHttpRequest<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li></ul><h4 id="äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶" aria-hidden="true">#</a> äº‹ä»¶</h4>`,9),gt=n("code",null,"loadstart",-1),ht={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest",target:"_blank",rel:"noopener noreferrer"},ft=n("code",null,"XMLHttpRequest",-1),_t=e("<li><code>load</code>è¯·æ±‚å®Œæˆçš„æ—¶å€™ä¼šè§¦å‘<code>load</code> äº‹ä»¶</li><li><code>loadend</code>åœ¨ä¸€ä¸ªèµ„æºçš„åŠ è½½è¿›åº¦åœæ­¢ä¹‹åè¢«è§¦å‘ (ä¾‹å¦‚ï¼Œåœ¨å·²ç»è§¦å‘â€œerrorâ€ï¼Œâ€œabortâ€æˆ–â€œloadâ€äº‹ä»¶ä¹‹å)</li><li><code>process</code>è¯·æ±‚æ¥æ”¶åˆ°æ•°æ®çš„æ—¶å€™è¢«å‘¨æœŸæ€§è§¦å‘ã€‚</li><li><code>readystatechange</code>è¿™ä¸ªæ–¹æ³•ä¸è¯¥ç”¨äºåŒæ­¥çš„ requests å¯¹è±¡<strong>å½“ä¸€ä¸ª <code>XMLHttpRequest</code> è¯·æ±‚è¢« abort() æ–¹æ³•å–æ¶ˆæ—¶ï¼Œå…¶å¯¹åº”çš„ <code>readystatechange</code> äº‹ä»¶ä¸ä¼šè¢«è§¦å‘ã€‚</strong></li><li><code>timeout</code>è¶…æ—¶è§¦å‘</li>",5),yt=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;loadstart&#39;</span><span class="token punctuation">,</span> handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;loadend&#39;</span><span class="token punctuation">,</span> handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;progress&#39;</span><span class="token punctuation">,</span> handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;abort&#39;</span><span class="token punctuation">,</span> handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;readystatechange&#39;</span><span class="token punctuation">,</span> handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;timeout&#39;</span><span class="token punctuation">,</span> handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€fetch" tabindex="-1"><a class="header-anchor" href="#_2ã€fetch" aria-hidden="true">#</a> 2ã€Fetch</h3><h4 id="fetch" tabindex="-1"><a class="header-anchor" href="#fetch" aria-hidden="true">#</a> fetchï¼ˆï¼‰</h4>`,3),wt={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response",target:"_blank",rel:"noopener noreferrer"},qt=n("code",null,"Response",-1),xt=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>input<span class="token punctuation">[</span><span class="token punctuation">,</span> init<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),jt={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String",target:"_blank",rel:"noopener noreferrer"},St=n("code",null,"USVString",-1),It=n("code",null,"blob:",-1),Pt=n("code",null,"data:",-1),Ct={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request",target:"_blank",rel:"noopener noreferrer"},zt=n("code",null,"Request",-1),At=n("p",null,[n("em",null,"init"),s(" å¯é€‰ï¼Œä¸€ä¸ªé…ç½®é¡¹å¯¹è±¡ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¯¹è¯·æ±‚çš„è®¾ç½®ã€‚å¯é€‰çš„å‚æ•°æœ‰ï¼š")],-1),Wt=n("li",null,[n("code",null,"method"),s(": è¯·æ±‚ä½¿ç”¨çš„æ–¹æ³•ï¼Œå¦‚ "),n("code",null,"GET"),s("ã€"),n("code",null,"POST"),s("ã€‚")],-1),Nt=n("code",null,"headers",-1),Dt={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Headers",target:"_blank",rel:"noopener noreferrer"},Et=n("code",null,"Headers",-1),Ot={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String",target:"_blank",rel:"noopener noreferrer"},Rt=n("code",null,"ByteString",-1),Bt=n("code",null,"body",-1),Mt={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Blob",target:"_blank",rel:"noopener noreferrer"},Tt=n("code",null,"Blob",-1),Lt=n("code",null,"BufferSource",-1),Ut={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData",target:"_blank",rel:"noopener noreferrer"},Ft=n("code",null,"FormData",-1),Ht={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams",target:"_blank",rel:"noopener noreferrer"},Kt=n("code",null,"URLSearchParams",-1),Vt={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String",target:"_blank",rel:"noopener noreferrer"},Jt=n("code",null,"USVString",-1),Gt=e("<li><code>mode</code>: è¯·æ±‚çš„æ¨¡å¼ï¼Œå¦‚ <code>cors</code>ã€<code>no-cors</code> æˆ–è€… <code>same-origin</code>ã€‚</li><li><code>credentials</code>: è¯·æ±‚çš„ credentialsï¼Œå¦‚ <code>omit</code>ã€<code>same-origin</code> æˆ–è€… <code>include</code>ã€‚ä¸ºäº†åœ¨å½“å‰åŸŸåå†…è‡ªåŠ¨å‘é€ cookieï¼Œå¿…é¡»æä¾›è¿™ä¸ªé€‰é¡¹ï¼Œä» Chrome 50 å¼€å§‹ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿå¯ä»¥æ¥å— <code>FederatedCredential </code>å®ä¾‹æˆ–æ˜¯ä¸€ä¸ª <code>PasswordCredential</code>å®ä¾‹ã€‚</li><li><code>cache</code>: è¯·æ±‚çš„ cache æ¨¡å¼ï¼š<code>default</code>ã€ <code>no-store</code>ã€ <code>reload</code> ã€ <code>no-cache</code>ã€ <code>force-cache</code> æˆ–è€… <code>only-if-cached</code>ã€‚</li><li><code>redirect</code>: å¯ç”¨çš„ redirect æ¨¡å¼ï¼š<code>follow</code> (è‡ªåŠ¨é‡å®šå‘), <code>error</code> (å¦‚æœäº§ç”Ÿé‡å®šå‘å°†è‡ªåŠ¨ç»ˆæ­¢å¹¶ä¸”æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼‰ï¼Œæˆ–è€… <code>manual</code> (æ‰‹åŠ¨å¤„ç†é‡å®šå‘)ã€‚åœ¨ Chrome ä¸­é»˜è®¤ä½¿ç”¨ <code>follow</code>ï¼ˆChrome 47 ä¹‹å‰çš„é»˜è®¤å€¼æ˜¯ <code>manual</code>ï¼‰ã€‚</li>",4),Xt=n("code",null,"referrer",-1),Yt={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String",target:"_blank",rel:"noopener noreferrer"},$t=n("code",null,"USVString",-1),Qt=n("code",null,"no-referrer",-1),Zt=n("code",null,"client",-1),ne=n("code",null,"client",-1),se=n("li",null,[n("code",null,"referrerPolicy"),s(": æŒ‡å®šäº† HTTP å¤´éƒ¨ referer å­—æ®µçš„å€¼ã€‚å¯èƒ½ä¸ºä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š"),n("code",null,"no-referrer"),s("ã€ "),n("code",null,"no-referrer-when-downgrade"),s("ã€"),n("code",null,"origin"),s("ã€"),n("code",null,"origin-when-cross-origin"),s("ã€ "),n("code",null,"unsafe-url"),s("ã€‚")],-1),ae=e(`<h4 id="headers" tabindex="-1"><a class="header-anchor" href="#headers" aria-hidden="true">#</a> Headers</h4><p><strong>Headers</strong> æ¥å£å…è®¸å¯¹ HTTP è¯·æ±‚å’Œå“åº”å¤´æ‰§è¡Œå„ç§æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span><span class="token string">&#39;uname=lisi&amp;pwd=123&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span><span class="token string">&#39;application/x-www-form=urlencoded&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€navigator-sendbeacon" tabindex="-1"><a class="header-anchor" href="#_3ã€navigator-sendbeacon" aria-hidden="true">#</a> 3ã€navigator.sendBeacon</h3><p><code>navigator.sendBeacon</code>æ˜¯ä¸ºäº†è§£å†³å½“å‰é¡µé¢å¸è½½æœŸé—´æ— æ³•ä¿è¯æ•°æ®å‘é€åˆ°æœåŠ¡ç«¯ã€‚</p><p>åœ¨æ²¡æœ‰<code>sendBeacon</code>ä¹‹å‰é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³é¡µé¢å¸è½½è¿˜èƒ½ä¼ è¾“æ•°æ®ã€‚</p><ul><li><p>é¡µé¢å¸è½½æ—¶åŒæ­¥ä½¿ç”¨ajxaå‘é€è¯·æ±‚ï¼Œç­‰æœåŠ¡ç«¯è¿”å›æ•°æ®å†å¸è½½é¡µé¢ï¼Œç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œé˜»ç¢é¡µé¢å¸è½½ã€‚</p></li><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;beforeunload&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/log&#39;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šä¸º falseï¼Œè¡¨ç¤ºä½¿ç”¨åŒæ­¥è¯·æ±‚</span>
  xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">userId</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
    <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&#39;pageView&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">pageUrl</span><span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ›å»ºImageå¯¹è±¡ï¼Œå°†è¦ä¼ è¾“çš„æ•°æ®ä½œä¸ºæŸ¥è¯¢å‚æ•°ä¼ é€’åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ªç©ºç™½å›¾ç‰‡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨é¡µé¢å¸è½½æ—¶å¼‚æ­¥ä¼ è¾“æ•°æ®ã€‚<strong>è¿™ç§æ–¹å¼ä¸ä¼šé˜»å¡é¡µé¢å¸è½½è¿‡ç¨‹ï¼Œä½†åªæ”¯æŒ GET è¯·æ±‚ï¼Œä¸”åªèƒ½ä¼ è¾“è¾ƒå°çš„æ•°æ®ã€‚</strong></p></li><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sendAnalyticsData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;/analytics?&#39;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;beforeunload&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">userId</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
    <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&#39;pageView&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">pageUrl</span><span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">sendAnalyticsData</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>LocalStorageï¼šå°†è¦ä¼ è¾“çš„æ•°æ®å­˜å‚¨åœ¨ LocalStorage ä¸­ï¼Œç„¶ååœ¨ä¸‹ä¸€ä¸ªé¡µé¢åŠ è½½æ—¶è¯»å–æ•°æ®å¹¶å‘é€åˆ°æœåŠ¡å™¨ã€‚è¿™ç§æ–¹å¼å¯ä»¥åœ¨é¡µé¢å¸è½½æ—¶å¼‚æ­¥ä¼ è¾“æ•°æ®ï¼Œä½†éœ€è¦é¢å¤–çš„ä»£ç ç»´æŠ¤ï¼Œä¸”åªèƒ½ä¼ è¾“è¾ƒå°çš„æ•°æ®ï¼Œä¸”å¯èƒ½ä¼šå—åˆ° LocalStorage å®¹é‡é™åˆ¶ã€‚</p></li><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sendFormData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;formData&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;formSubmitTime&#39;</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;beforeunload&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;John Doe&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">&#39;john.doe@example.com&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;HelloWorld!&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">sendFormData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åœ¨ä¸‹ä¸€ä¸ªé¡µé¢åŠ è½½æ—¶å‘é€æ•°æ®</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> formData <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;formData&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> formSubmitTime <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;formSubmitTime&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>formData <span class="token operator">&amp;&amp;</span> formSubmitTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>submitTime <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>formSubmitTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sendDataToServer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&#39;formData&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&#39;formSubmitTime&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sendDataToServer</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å‘é€æ•°æ®åˆ°æœåŠ¡å™¨çš„ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>è¾“åˆ°æœåŠ¡å™¨ï¼Œé¿å…åœ¨å¸è½½é¡µé¢æ—¶ä¸¢å¤±æ•°æ®ã€‚å®ƒæ˜¯åŸºäºæµè§ˆå™¨æä¾›çš„ navigator.sendBeacon() æ–¹æ³•å®ç°çš„ï¼Œæ”¯æŒå‘é€ä¸€äº›ç®€å•çš„æ•°æ®ï¼Œå¦‚æ—¥å¿—æ•°æ®ã€ç»Ÿè®¡æ•°æ®ç­‰ã€‚</p><p>ä½¿ç”¨ sendBeacon çš„ä¼˜ç‚¹æ˜¯<strong>å®ƒå¯ä»¥åœ¨é¡µé¢å¸è½½æ—¶å¼‚æ­¥ä¼ è¾“æ•°æ®ï¼Œè€Œä¸”ä¸ä¼šé˜»å¡é¡µé¢å¸è½½è¿‡ç¨‹</strong>ï¼Œå› æ­¤å¯ä»¥é¿å…åœ¨å¸è½½é¡µé¢æ—¶å› ä¸ºæ•°æ®ä¼ è¾“è€Œå»¶è¿Ÿå¸è½½ï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚æ­¤å¤–ï¼ŒsendBeacon è¿˜å¯ä»¥åœ¨ç½‘ç»œè¿æ¥ä¸ç¨³å®šçš„æƒ…å†µä¸‹ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ã€‚</p>`,9),te=n("code",null,"data",-1),ee={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer",target:"_blank",rel:"noopener noreferrer"},pe=n("code",null,"ArrayBuffer",-1),oe={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray",target:"_blank",rel:"noopener noreferrer"},ce=n("code",null,"ArrayBufferView",-1),le={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Blob",target:"_blank",rel:"noopener noreferrer"},ie=n("code",null,"Blob",-1),ue={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String",target:"_blank",rel:"noopener noreferrer"},re=n("code",null,"DOMString",-1),de={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData",target:"_blank",rel:"noopener noreferrer"},ke=n("code",null,"FormData",-1),ve={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams",target:"_blank",rel:"noopener noreferrer"},me=n("code",null,"URLSearchParams",-1),be=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">&quot;/log&quot;</span><span class="token punctuation">,</span> blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>sendBeacon æ–¹æ³•ä»…æ”¯æŒ POST è¯·æ±‚</p></div><h3 id="ajaxå’ŒfetchåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#ajaxå’ŒfetchåŒºåˆ«" aria-hidden="true">#</a> ajaxå’ŒfetchåŒºåˆ«</h3><p><code>fetch()</code>ä½¿ç”¨ Promiseï¼Œä¸ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œå› æ­¤å¤§å¤§ç®€åŒ–äº†å†™æ³•ï¼Œå†™èµ·æ¥æ›´ç®€æ´ã€‚</p><p><code>fetch()</code>é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒAPI åˆ†æ•£åœ¨å¤šä¸ªå¯¹è±¡ä¸Šï¼ˆResponse å¯¹è±¡ã€Request å¯¹è±¡ã€Headers å¯¹è±¡ï¼‰ï¼Œæ›´åˆç†ä¸€äº›ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼ŒXMLHttpRequest çš„ API è®¾è®¡å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œè¾“å…¥ã€è¾“å‡ºã€çŠ¶æ€éƒ½åœ¨åŒä¸€ä¸ªæ¥å£ç®¡ç†ï¼Œå®¹æ˜“å†™å‡ºéå¸¸æ··ä¹±çš„ä»£ç ã€‚</p><p><code>fetch()</code>é€šè¿‡æ•°æ®æµï¼ˆStream å¯¹è±¡ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥åˆ†å—è¯»å–ï¼Œæœ‰åˆ©äºæé«˜ç½‘ç«™æ€§èƒ½è¡¨ç°ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œå¯¹äºè¯·æ±‚å¤§æ–‡ä»¶æˆ–è€…ç½‘é€Ÿæ…¢çš„åœºæ™¯ç›¸å½“æœ‰ç”¨ã€‚XMLHTTPRequest å¯¹è±¡ä¸æ”¯æŒæ•°æ®æµï¼Œæ‰€æœ‰çš„æ•°æ®å¿…é¡»æ”¾åœ¨ç¼“å­˜é‡Œï¼Œä¸æ”¯æŒåˆ†å—è¯»å–ï¼Œå¿…é¡»ç­‰å¾…å…¨éƒ¨æ‹¿åˆ°åï¼Œå†ä¸€æ¬¡æ€§åå‡ºæ¥ã€‚</p><h3 id="sseé•¿è¿æ¥" tabindex="-1"><a class="header-anchor" href="#sseé•¿è¿æ¥" aria-hidden="true">#</a> SSEé•¿è¿æ¥</h3><p>SSEåˆ©ç”¨é•¿è¿æ¥ç‰¹æ€§ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€æ¡æŒä¹…åŒ–é“¾æ¥ï¼Œå¹¶é€šè¿‡è¿™æ¡è¿æ¥å®ç°æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å®æ—¶æ•°æ®æ¨é€</p><p>ç‰¹ç‚¹ï¼šå®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘é€è¯·æ±‚åç»­ç”±æœåŠ¡ç«¯æ¨é€æ¶ˆæ¯ï¼Œ</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*configuration å¯é€‰
ä¸ºé…ç½®æ–°è¿æ¥æä¾›é€‰é¡¹ã€‚å¯é€‰é¡¹æ˜¯ï¼š
withCredentialsï¼Œé»˜è®¤ä¸º falseï¼ŒæŒ‡ç¤º CORS æ˜¯å¦åº”åŒ…å«å‡­æ® ( credentials )ã€‚
*/</span>
<span class="token keyword">const</span> sse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>configuration<span class="token punctuation">)</span>
sse<span class="token punctuation">.</span><span class="token function">addEvenlistener</span><span class="token punctuation">(</span><span class="token string">&#39;äº‹ä»¶åç§°é»˜è®¤message,æœåŠ¡ç«¯å¯ä»¥è®¾ç½®&#39;</span><span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ WebSocket ä¸åŒçš„æ˜¯ï¼ŒæœåŠ¡å™¨å‘é€äº‹ä»¶æ˜¯å•å‘çš„ã€‚æ•°æ®ä¿¡æ¯åªèƒ½ä»æœåŠ¡ç«¯åˆ°å‘é€åˆ°å®¢æˆ·ç«¯ï¼ˆå¦‚ç”¨æˆ·çš„æµè§ˆå™¨ï¼‰ã€‚å½“ä¸éœ€è¦ä»¥æ¶ˆæ¯å½¢å¼å°†æ•°æ®ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œè¿™ä½¿å®ƒä»¬æˆä¸ºç»ä½³çš„é€‰æ‹©ã€‚</p><p>å®ä¾‹èº«ä¸Šé»˜è®¤æœ‰ä¸‰ä¸ªç›‘å¬äº‹ä»¶ <code>error message open</code> ï¼Œæœ‰ä¸€ä¸ª<code>close</code>æ–¹æ³•ï¼Œæœ‰ä¸€ä¸ª**<code>readyState</code>** å±æ€§</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> evtSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">&quot;sse.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
0 â€” connecting
1 â€” open
2 â€” closed
*/</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evtSource<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13);function ge(he,fe){const t=p("ExternalLinkIcon"),o=p("CommentService");return l(),i("div",null,[m,b,n("p",null,[g,s("æä¾›äº†ä¸€ç§å¼‚æ­¥è§‚å¯Ÿç›®æ ‡å…ƒç´ ä¸å…¶ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£"),n("a",h,[s("è§†å£"),a(t)]),s("ï¼ˆviewportï¼‰äº¤å‰çŠ¶æ€çš„æ–¹æ³•ã€‚å…¶ç¥–å…ˆå…ƒç´ æˆ–è§†å£è¢«ç§°ä¸ºæ ¹ï¼ˆrootï¼‰ã€‚")]),f,n("ol",null,[n("li",null,[_,n("ol",null,[n("li",null,[s("rootï¼šæµ‹è¯•äº¤å‰æ—¶ï¼Œç”¨ä½œè¾¹ç•Œç›’çš„"),n("a",y,[s("å…ƒç´ "),a(t)]),s("æˆ–"),n("a",w,[s("æ–‡æ¡£"),a(t)]),s("ã€‚å¦‚æœæ„é€ å‡½æ•°æœªä¼ å…¥ "),q,s(" æˆ–å…¶å€¼ä¸º"),x,s("ï¼Œåˆ™é»˜è®¤ä½¿ç”¨é¡¶çº§æ–‡æ¡£çš„è§†å£ã€‚")]),n("li",null,[s("rootMarginï¼šè®¡ç®—äº¤å‰æ—¶æ·»åŠ åˆ°æ ¹"),n("a",j,[s("è¾¹ç•Œç›’ (en-US)"),a(t)]),s("çš„çŸ©å½¢åç§»é‡ï¼Œå¯ä»¥æœ‰æ•ˆçš„ç¼©å°æˆ–æ‰©å¤§æ ¹çš„åˆ¤å®šèŒƒå›´ä»è€Œæ»¡è¶³è®¡ç®—éœ€è¦ã€‚æ­¤å±æ€§è¿”å›çš„å€¼å¯èƒ½ä¸è°ƒç”¨æ„é€ å‡½æ•°æ—¶æŒ‡å®šçš„å€¼ä¸åŒï¼Œå› æ­¤å¯èƒ½éœ€è¦æ›´æ”¹è¯¥å€¼ï¼Œä»¥åŒ¹é…å†…éƒ¨è¦æ±‚ã€‚æ‰€æœ‰çš„åç§»é‡å‡å¯ç”¨"),S,s("ï¼ˆ"),I,s("ï¼‰æˆ–"),P,s("ï¼ˆ"),C,s("ï¼‰æ¥è¡¨è¾¾ï¼Œé»˜è®¤å€¼ä¸º â€œ0px 0px 0px 0pxâ€ã€‚")]),z])]),n("li",null,[A,n("ol",null,[n("li",null,[n("p",null,[n("a",W,[N,a(t)]),s("ä½¿ "),D,s(" å¯¹è±¡åœæ­¢ç›‘å¬ç›®æ ‡ã€‚")])]),n("li",null,[n("p",null,[n("a",E,[O,a(t)]),s("ä½¿ "),R,s(" å¼€å§‹ç›‘å¬ä¸€ä¸ªç›®æ ‡å…ƒç´ ã€‚")])]),n("li",null,[n("p",null,[n("a",B,[M,a(t)]),s("è¿”å›æ‰€æœ‰è§‚å¯Ÿç›®æ ‡çš„ "),n("a",T,[L,a(t)]),s(" å¯¹è±¡æ•°ç»„ã€‚")])]),n("li",null,[n("p",null,[n("a",U,[F,a(t)]),s("ä½¿ "),H,s(" åœæ­¢ç›‘å¬ç‰¹å®šç›®æ ‡å…ƒç´ ã€‚")])])])])]),K,n("p",null,[s("è¯¥ API è¢«è®¾è®¡ç”¨æ¥å–ä»£ä½¿ç”¨ "),n("a",V,[J,a(t)]),s(" çš„å‰ªè´´æ¿è®¿é—®æ–¹å¼ã€‚")]),G,n("p",null,[s("è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªidå¯ä»¥ç”¨äº"),n("a",X,[Y,a(t)]),s("å–æ¶ˆ")]),$,n("p",null,[s("è¯¥å‡½æ•°è¿”å›ä¸€ä¸ª IDï¼Œå¯ä»¥æŠŠå®ƒä¼ å…¥ "),n("a",Q,[Z,a(t)]),s(" æ–¹æ³•æ¥ç»“æŸå›è°ƒã€‚")]),nn,n("p",null,[s("Web Worker ä¸º Web å†…å®¹åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œè„šæœ¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ã€‚çº¿ç¨‹å¯ä»¥æ‰§è¡Œä»»åŠ¡è€Œä¸å¹²æ‰°ç”¨æˆ·ç•Œé¢ã€‚æ­¤å¤–ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨"),n("a",sn,[an,a(t)]),s("æ‰§è¡Œ I/O (å°½ç®¡"),tn,s("å’Œ"),en,s("å±æ€§æ€»æ˜¯ä¸ºç©º)ã€‚ä¸€æ—¦åˆ›å»ºï¼Œä¸€ä¸ª worker å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°åˆ›å»ºå®ƒçš„ JavaScript ä»£ç ï¼Œé€šè¿‡å°†æ¶ˆæ¯å‘å¸ƒåˆ°è¯¥ä»£ç æŒ‡å®šçš„äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚æœ¬æ–‡æä¾›äº†æœ‰å…³ä½¿ç”¨ Web Worker çš„è¯¦ç»†ä»‹ç»ã€‚")]),pn,n("ol",null,[n("li",null,[n("p",null,[s("ä¸€ä¸ª worker æ˜¯ä½¿ç”¨ä¸€ä¸ªæ„é€ å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ (e.g. "),n("a",on,[cn,a(t)]),s(") è¿è¡Œä¸€ä¸ªå‘½åçš„ JavaScript æ–‡ä»¶ - è¿™ä¸ªæ–‡ä»¶åŒ…å«å°†åœ¨å·¥ä½œçº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç ; workers è¿è¡Œåœ¨å¦ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸åŒäºå½“å‰çš„"),n("a",ln,[un,a(t)]),s(". å› æ­¤ï¼Œåœ¨ "),n("a",rn,[dn,a(t)]),s(" å†…é€šè¿‡ "),n("a",kn,[vn,a(t)]),s("è·å–å…¨å±€ä½œç”¨åŸŸ å°†è¿”å›é”™è¯¯ã€‚"),mn,bn,s("å…³é”®å­—")])]),gn]),hn,n("p",null,[s("æœ€æµè¡Œçš„æ˜¯â€œApp Shellâ€æ¦‚å¿µï¼Œå®ƒå®Œå…¨æŒ‰ç…§ä¸Šè¿°æ–¹å¼æ··ç”¨ SSR å’Œ CSRï¼›æ­¤å¤–è¿˜éµå¾ªâ€œç¦»çº¿ä¼˜å…ˆâ€æ–¹æ³•ï¼Œè¿™ä¸ªæˆ‘ä»¬å°†åœ¨åç»­æ–‡ç« ä¸­è¯¦ç»†è§£é‡Šï¼Œä¹Ÿä¼šåœ¨ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬è¿˜ä¼šç®€è¦æåŠå¦ä¸€ç§æ¶‰åŠ"),n("a",fn,[s("Streams API"),a(t)]),s("çš„æ–°æ–¹æ³•")]),_n,n("p",null,[s("ä¸ºäº†ä½¿åº”ç”¨ç¦»çº¿è¿è¡Œï¼Œä½ å¿…é¡»ä½¿ç”¨ "),n("a",yn,[s("Service Worker API"),a(t)]),s(" æ¥ç¦»çº¿å­˜å‚¨èµ„æºï¼Œå¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ "),n("a",wn,[s("Web Storage"),a(t)]),s(" æˆ– "),n("a",qn,[s("IndexedDB"),a(t)]),s(" æ¥å­˜å‚¨å…¶æ•°æ®ã€‚")]),xn,n("p",null,[n("u",null,[s("åœ¨ Service Worker ä¸­ä½¿ç”¨ "),n("a",jn,[s("Web Storage"),a(t)]),s(" å°†ä¸ä¼šæœ‰æ•ˆæœï¼Œæ‰€ä»¥ä½¿ç”¨ Cache API ä½œä¸ºæ›¿ä»£ã€‚")])]),n("p",null,[s("å…¨å±€çš„ "),Sn,s(" åªè¯»å±æ€§è¿”å›ä¸å½“å‰ä¸Šä¸‹æ–‡ç´§å¯†ç›¸å…³çš„ "),n("a",In,[Pn,a(t)]),s(" å¯¹è±¡ã€‚æ­¤å¯¹è±¡æ¿€æ´»äº†è¯¸å¦‚å­˜å‚¨ç”¨äºç¦»çº¿ä½¿ç”¨çš„èµ„æºï¼Œå¹¶ç”Ÿæˆå¯¹è¯·æ±‚çš„è‡ªå®šä¹‰å“åº”ç­‰åŠŸèƒ½ã€‚")]),n("p",null,[n("a",Cn,[zn,a(t)])]),n("p",null,[s("è¿”å›ä¸€ä¸ª "),n("a",An,[Wn,a(t)]),s(" ï¼Œresolve ä¸ºåŒ¹é… "),Nn,s(" ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ cacheï¼‰çš„ "),n("a",Dn,[En,a(t)]),s(" å¯¹è±¡")]),n("p",null,[n("a",On,[Rn,a(t)])]),n("p",null,[s("æŸ¥æ‰¾åŒ¹é… "),Bn,s(" çš„ "),n("a",Mn,[Tn,a(t)]),s(" å¯¹è±¡ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™åˆ é™¤ "),n("a",Ln,[Un,a(t)]),s(" å¯¹è±¡å¹¶è¿”å›ä¸€ä¸ª resolve ä¸º true çš„ "),n("a",Fn,[Hn,a(t)]),s(" ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ° "),n("a",Kn,[Vn,a(t)]),s(" å¯¹è±¡ï¼Œåˆ™è¿”å› "),Jn,s(".")]),n("p",null,[n("a",Gn,[Xn,a(t)])]),n("p",null,[s("è¿”å›ä¸€ä¸ª "),n("a",Yn,[$n,a(t)]),s(" ï¼Œå®ƒå°†ä½¿ç”¨ä¸€ä¸ªåŒ…å«ä¸ "),n("a",Qn,[Zn,a(t)]),s(" è¿½è¸ªçš„æ‰€æœ‰å‘½å "),n("a",ns,[ss,a(t)]),s(" å¯¹è±¡å¯¹åº”å­—ç¬¦ä¸²çš„æ•°ç»„æ¥ resolve. ä½¿ç”¨è¯¥æ–¹æ³•è¿­ä»£æ‰€æœ‰ "),n("a",as,[ts,a(t)]),s(" å¯¹è±¡çš„åˆ—è¡¨ã€‚")]),n("p",null,[n("a",es,[ps,a(t)])]),n("p",null,[s("æ£€æŸ¥ç»™å®šçš„ "),n("a",os,[cs,a(t)]),s(" æ˜¯å¦æ˜¯ "),n("a",ls,[is,a(t)]),s(" å¯¹è±¡è·Ÿè¸ªçš„ä»»ä½• "),n("a",us,[rs,a(t)]),s(" å¯¹è±¡çš„é”®ï¼Œå¹¶è¿”å›ä¸€ä¸ª resolve ä¸ºè¯¥åŒ¹é…çš„ "),n("a",ds,[ks,a(t)]),s(" .")]),n("p",null,[n("a",vs,[ms,a(t)])]),n("p",null,[s("å¦‚æœå­˜åœ¨ä¸ "),bs,s(" åŒ¹é…çš„ "),n("a",gs,[hs,a(t)]),s(" å¯¹è±¡ï¼Œåˆ™è¿”å›ä¸€ä¸ª resolve ä¸º true çš„ "),n("a",fs,[_s,a(t)]),s(" .")]),ys,n("p",null,[s("ä¸ºäº†èƒ½å¤Ÿæ¥æ”¶åˆ°æ¨é€çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Service Worker æ–‡ä»¶é‡Œé¢ç›‘å¬ "),n("a",ws,[qs,s(" (en-US)"),a(t)]),s(" äº‹ä»¶ï¼šè¿™äº›æ•°æ®è¢«æ¥æ”¶åï¼Œå°†ä¼šä»¥é€šçŸ¥çš„æ–¹å¼ç«‹åˆ»å±•ç°ç»™ç”¨æˆ·ï¼Œä¾‹å¦‚æé†’ç”¨æˆ·ä¸€äº›å¾…åŠäº‹é¡¹ï¼Œæˆ–è€…è®©ç”¨æˆ·çŸ¥é“ App æœ‰äº†æ–°å†…å®¹ã€‚")]),xs,n("p",null,[n("a",js,[Ss,a(t)]),s(" æ¥å£æä¾›äº†ç›‘è§†å¯¹ DOM æ ‘æ‰€åšæ›´æ”¹çš„èƒ½åŠ›ã€‚å®ƒè¢«è®¾è®¡ä¸ºæ—§çš„ Mutation Events åŠŸèƒ½çš„æ›¿ä»£å“ï¼Œè¯¥åŠŸèƒ½æ˜¯ DOM3 Events è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚")]),Is,n("ol",null,[Ps,n("li",null,[n("p",null,[s("å›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯æè¿°æ‰€æœ‰è¢«è§¦å‘æ”¹åŠ¨çš„ "),n("a",Cs,[zs,a(t)]),s(" å¯¹è±¡æ•°ç»„ï¼Œå¦ä¸€ä¸ªæ˜¯è°ƒç”¨è¯¥å‡½æ•°çš„ "),As,s(" å¯¹è±¡ã€‚")])]),n("li",null,[Ws,n("ol",null,[n("li",null,[n("a",Ns,[Ds,a(t)]),s("é˜»æ­¢ "),Es,s(" å®ä¾‹ç»§ç»­æ¥æ”¶çš„é€šçŸ¥ï¼Œç›´åˆ°å†æ¬¡è°ƒç”¨å…¶ "),n("a",Os,[Rs,a(t)]),s(" æ–¹æ³•ï¼Œè¯¥è§‚å¯Ÿè€…å¯¹è±¡åŒ…å«çš„å›è°ƒå‡½æ•°éƒ½ä¸ä¼šå†è¢«è°ƒç”¨ã€‚")]),n("li",null,[n("a",Bs,[Ms,a(t)]),s("é…ç½® "),Ts,s(" åœ¨ DOM æ›´æ”¹åŒ¹é…ç»™å®šé€‰é¡¹æ—¶ï¼Œé€šè¿‡å…¶å›è°ƒå‡½æ•°å¼€å§‹æ¥æ”¶é€šçŸ¥ã€‚")]),n("li",null,[n("a",Ls,[Us,a(t)]),s("ä» MutationObserver çš„é€šçŸ¥é˜Ÿåˆ—ä¸­åˆ é™¤æ‰€æœ‰å¾…å¤„ç†çš„é€šçŸ¥ï¼Œå¹¶å°†å®ƒä»¬è¿”å›åˆ° "),n("a",Fs,[Hs,a(t)]),s(" å¯¹è±¡çš„æ–° "),n("a",Ks,[Vs,a(t)]),s(" ä¸­ã€‚")])])]),Js]),Gs,n("p",null,[s("indexedDBæœ‰ä»€ä¹ˆç”¨ï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"),n("strong",null,[s("è™½ç„¶ "),n("a",Xs,[s("Web Storage"),a(t)]),s(" åœ¨å­˜å‚¨è¾ƒå°‘é‡çš„æ•°æ®å¾ˆæœ‰ç”¨ï¼Œä½†å¯¹äºå­˜å‚¨æ›´å¤§é‡çš„ç»“æ„åŒ–æ•°æ®æ¥è¯´åŠ›ä¸ä»å¿ƒã€‚IndexedDB çš„ä¸»è¦è®¾è®¡ç›®æ ‡ä¹‹ä¸€å°±æ˜¯å…è®¸å¤§é‡æ•°æ®å¯ä»¥è¢«å­˜å‚¨ä»¥ä¾›ç¦»çº¿ä½¿ç”¨ã€‚å¯ä»¥åœ¨å®¢æˆ·ç«¯å­˜å‚¨å¤§é‡çš„ç»“æ„åŒ–æ•°æ®ï¼ˆä¹ŸåŒ…æ‹¬æ–‡ä»¶/äºŒè¿›åˆ¶å¤§å‹å¯¹è±¡ï¼ˆblobsï¼‰ï¼‰ã€‚è¯¥ API ä½¿ç”¨ç´¢å¼•å®ç°å¯¹æ•°æ®çš„é«˜æ€§èƒ½æœç´¢ã€‚")])]),Ys,n("ol",null,[$s,n("li",null,[n("p",null,[s("æ‰“å¼€æ•°æ®åº“,å¹¶åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä»“åº“ã€‚ï¼ˆå½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“æˆ–è€…å¢åŠ å·²å­˜åœ¨çš„æ•°æ®åº“çš„ç‰ˆæœ¬å·ï¼Œ "),Qs,s(" äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œ"),n("a",Zs,[s("IDBVersionChangeEvent "),a(t)]),s(" å¯¹è±¡ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™ç»‘å®šåœ¨ "),na,s("ä¸Šçš„"),sa,s(" äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä½ åº”è¯¥åœ¨æ­¤åˆ›å»ºè¯¥ç‰ˆæœ¬éœ€è¦çš„å¯¹è±¡ä»“åº“ï¼‰")]),aa]),ta]),ea,n("p",null,[pa,s(" æ–¹æ³•ä» "),n("a",oa,[ca,a(t)]),s(" ä¸­é”€æ¯æŒ‡å®šåç§°çš„å¯¹è±¡å­˜å‚¨ï¼ŒåŠè¿™ä¸ªå¯¹è±¡å­˜å‚¨æ‰€åŒ…å«çš„ä»»ä½•ç´¢å¼•ã€‚")]),la,n("div",ia,[ua,n("p",null,[n("strong",null,[s("è¿”å›çš„å¯¹è±¡ä¸ä»å…ƒç´ çš„ "),n("a",ra,[da,a(t)]),s(" å±æ€§è¿”å›çš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„ç±»å‹;ç„¶è€Œï¼Œä¸¤ä¸ªå¯¹è±¡å…·æœ‰ä¸åŒçš„ç›®çš„ã€‚ä»"),ka,s("è¿”å›çš„å¯¹è±¡æ˜¯åªè¯»çš„ï¼Œå¯ä»¥ç”¨äºæ£€æŸ¥å…ƒç´ çš„æ ·å¼ï¼ˆåŒ…æ‹¬ç”±ä¸€ä¸ª"),va,s("å…ƒç´ æˆ–ä¸€ä¸ªå¤–éƒ¨æ ·å¼è¡¨è®¾ç½®çš„é‚£äº›æ ·å¼ï¼‰ã€‚"),ma,s("å¯¹è±¡åº”ç”¨äºåœ¨ç‰¹å®šå…ƒç´ ä¸Šè®¾ç½®æ ·å¼ã€‚")])])]),ba,n("p",null,[ga,s("æ¥å£çš„ "),ha,s(" æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ "),n("a",fa,[_a,a(t)]),s(" çš„ä¾¿æ·æ–¹æ³•ï¼Œå°†å®ƒåº”ç”¨äºå…ƒç´ ï¼Œç„¶åè¿è¡ŒåŠ¨ç”»ã€‚å®ƒå°†è¿”å›ä¸€ä¸ªæ–°å»ºçš„ "),n("a",ya,[wa,a(t)]),s(" å¯¹è±¡å®ä¾‹")]),qa,n("p",null,[xa,s("ä¸€ä¸ªç”±å¤šä¸ªå…³é”®å¸§çš„å±æ€§å’Œå€¼ç»„æˆçš„å¯¹è±¡æ‰€æ„æˆçš„"),ja,s("ã€‚è¿™æ˜¯"),n("a",Sa,[Ia,s(" (en-US)"),a(t)]),s("æ–¹æ³•è¿”å›çš„è§„èŒƒæ ¼å¼ã€‚")]),Pa,n("p",null,[Ca,za,s("ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ—¶é—´å±æ€§ï¼ˆåœ¨ "),n("a",Aa,[Wa,s(" options å‚æ•°"),a(t)]),s("å’Œä¸‹æ–¹åˆ—å‡ºï¼‰çš„å¯¹è±¡ï¼š.")]),Na,n("p",null,[Da,s("ç”¨æ¥æŒ‡ç¤ºè¯¥äº‹ä»¶æ˜¯å¦å¯ä»¥ä» Shadow DOM ä¼ é€’åˆ°ä¸€èˆ¬çš„ DOMã€‚å¦‚æœè¿”å›çš„ "),n("a",Ea,[Oa,a(t)]),s(" å€¼ä¸º "),Ra,s("ï¼Œè¡¨æ˜å½“äº‹ä»¶åˆ°è¾¾ shadow DOM çš„æ ¹èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯ shadow DOM ä¸­äº‹ä»¶å¼€å§‹ä¼ æ’­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼‰æ—¶ï¼Œäº‹ä»¶å¯ä»¥ä» shadow DOM ä¼ é€’åˆ°ä¸€èˆ¬ DOMã€‚å½“ç„¶ï¼Œäº‹ä»¶è¦å…·æœ‰å¯ä¼ æ’­æ€§ï¼Œå³è¯¥äº‹ä»¶çš„ "),n("a",Ba,[Ma,a(t)]),s(" å±æ€§å¿…é¡»ä¸º "),Ta,s("ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ "),n("a",La,[Ua,a(t)]),s(" æ¥æŸ¥çœ‹äº‹ä»¶ä» shadow DOM ä¼ æ’­åˆ°æ™®é€š DOM çš„è·¯å¾„ã€‚")]),n("p",null,[Fa,s("åªè¯»å±æ€§ "),Ha,s(" è¡¨ç¤ºçš„ï¼Œæ ‡è¯†æ˜¯å½“äº‹ä»¶æ²¿ç€ DOM è§¦å‘æ—¶äº‹ä»¶çš„å½“å‰ç›®æ ‡ã€‚å®ƒæ€»æ˜¯æŒ‡å‘äº‹ä»¶ç»‘å®šçš„å…ƒç´ ï¼Œè€Œ "),n("a",Ka,[Va,a(t)]),s(" åˆ™æ˜¯äº‹ä»¶è§¦å‘çš„å…ƒç´ ã€‚")]),n("p",null,[Ja,s("è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨æ˜å½“å‰äº‹ä»¶æ˜¯å¦è°ƒç”¨äº† "),n("a",Ga,[Xa,a(t)]),s("æ–¹æ³•ã€‚")]),n("p",null,[Ya,s("æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆ"),n("a",$a,[Qa,a(t)]),s("ï¼‰ã€‚å½“äº‹ä»¶æ˜¯ç”±ç”¨æˆ·è¡Œä¸ºç”Ÿæˆçš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§çš„å€¼ä¸º "),Za,s(" ï¼Œè€Œå½“äº‹ä»¶æ˜¯ç”±è„šæœ¬åˆ›å»ºã€ä¿®æ”¹ã€é€šè¿‡ "),n("a",nt,[st,a(t)]),s(" æ´¾å‘çš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§çš„å€¼ä¸º "),at,s(" ã€‚")]),n("p",null,[tt,s("è¡¨ç¤ºäº‹ä»¶æµå½“å‰å¤„äºå“ªä¸€ä¸ªé˜¶æ®µ,"),n("a",et,[s("äº‹ä»¶é˜¶æ®µå¸¸é‡"),a(t)]),s(".åˆ—å‡ºäº†ä¸åŒçš„æ‰§è¡Œé˜¶æ®µ")]),pt,ot,n("p",null,[ct,s(" æ˜¯åªè¯»çš„ï¼Œæä¾›ä¸€ä¸ª "),n("a",lt,[it,a(t)]),s(" å¯¹è±¡æ¥è·å–è®¾å¤‡çš„ç½‘ç»œè¿æ¥ä¿¡æ¯ã€‚ä¾‹å¦‚ç”¨æˆ·è®¾å¤‡çš„å½“å‰å¸¦å®½æˆ–è¿æ¥æ˜¯å¦è¢«è®¡é‡ï¼Œè¿™å¯ä»¥ç”¨äºåŸºäºç”¨æˆ·çš„è¿æ¥æ¥é€‰æ‹©é«˜æ¸…æ™°åº¦å†…å®¹æˆ–ä½æ¸…æ™°åº¦å†…å®¹ã€‚")]),ut,n("p",null,[n("a",rt,[s("æ–‡æ¡£åœ°å€"),a(t)])]),dt,n("p",null,[s('è¿™ä¸ªå±æ€§åŒ…å«äº†è¿”å›çŠ¶æ€å¯¹åº”çš„æ–‡æœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚"OK"æˆ–æ˜¯"Not Found"ã€‚å¦‚æœè¯·æ±‚çš„çŠ¶æ€'),n("a",kt,[vt,a(t)]),s('çš„å€¼ä¸º"UNSENT"æˆ–è€…"OPENED"ï¼Œåˆ™è¿™ä¸ªå±æ€§çš„å€¼å°†ä¼šæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚å¦‚æœæœåŠ¡å™¨æœªæ˜ç¡®æŒ‡å®šä¸€ä¸ªçŠ¶æ€æ–‡æœ¬ä¿¡æ¯ï¼Œåˆ™'),mt,s('çš„å€¼å°†ä¼šè¢«è‡ªåŠ¨èµ‹å€¼ä¸º"OK"ã€‚')]),bt,n("ul",null,[n("li",null,[gt,s("å½“ç¨‹åºå¼€å§‹åŠ è½½æ—¶ï¼Œloadstart äº‹ä»¶å°†è¢«è§¦å‘ã€‚è¿™ä¸ªäº‹ä»¶å¯ä»¥è¢« "),n("a",ht,[ft,a(t)]),s(" è°ƒç”¨")]),_t]),yt,n("p",null,[s("å®ƒè¿”å›ä¸€ä¸ª promiseï¼Œè¿™ä¸ª promise ä¼šåœ¨è¯·æ±‚å“åº”åè¢« resolveï¼Œå¹¶ä¼ å› "),n("a",wt,[qt,a(t)]),s(" å¯¹è±¡ã€‚")]),xt,n("ul",null,[n("li",null,[s("ä¸€ä¸ª "),n("a",jt,[St,a(t)]),s(" å­—ç¬¦ä¸²ï¼ŒåŒ…å«è¦è·å–èµ„æºçš„ URLã€‚ä¸€äº›æµè§ˆå™¨ä¼šæ¥å— "),It,s(" å’Œ "),Pt,s(" ä½œä¸º schemes.")]),n("li",null,[s("ä¸€ä¸ª "),n("a",Ct,[zt,a(t)]),s(" å¯¹è±¡ã€‚")])]),At,n("ul",null,[Wt,n("li",null,[Nt,s(": è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼Œå½¢å¼ä¸º "),n("a",Dt,[Et,a(t)]),s(" çš„å¯¹è±¡æˆ–åŒ…å« "),n("a",Ot,[Rt,a(t)]),s(" å€¼çš„å¯¹è±¡å­—é¢é‡ã€‚")]),n("li",null,[Bt,s(": è¯·æ±‚çš„ body ä¿¡æ¯ï¼šå¯èƒ½æ˜¯ä¸€ä¸ª "),n("a",Mt,[Tt,a(t)]),s("ã€"),Lt,s("ã€"),n("a",Ut,[Ft,a(t)]),s("ã€"),n("a",Ht,[Kt,a(t)]),s(" æˆ–è€… "),n("a",Vt,[Jt,a(t)]),s(" å¯¹è±¡ã€‚æ³¨æ„ GET æˆ– HEAD æ–¹æ³•çš„è¯·æ±‚ä¸èƒ½åŒ…å« body ä¿¡æ¯ã€‚")]),Gt,n("li",null,[Xt,s(": ä¸€ä¸ª "),n("a",Yt,[$t,a(t)]),s(" å¯ä»¥æ˜¯ "),Qt,s("ã€"),Zt,s(" æˆ–ä¸€ä¸ª URLã€‚é»˜è®¤æ˜¯ "),ne,s("ã€‚")]),se]),ae,n("p",null,[s("å‘é€æ•°æ®æ—¶ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ª URL å’Œä¸€ä¸ªåŒ…å«æ•°æ®çš„ Blob æˆ– ArrayBuffer å¯¹è±¡ã€‚å¦‚æœä¼ å…¥çš„æ•°æ®å¤ªå¤§ï¼Œå¯èƒ½ä¼šè¢«æµè§ˆå™¨æˆªæ–­æˆ–è¢«æœåŠ¡å™¨æ‹’ç»ï¼Œå› æ­¤å»ºè®®åªä¼ è¾“ä¸€äº›ç®€å•çš„æ•°æ®ã€‚"),te,s(" å‚æ•°æ˜¯å°†è¦å‘é€çš„ "),n("a",ee,[pe,a(t)]),s("ã€"),n("a",oe,[ce,a(t)]),s("ã€"),n("a",le,[ie,a(t)]),s("ã€"),n("a",ue,[re,a(t)]),s("ã€"),n("a",de,[ke,a(t)]),s(" æˆ– "),n("a",ve,[me,a(t)]),s(" ç±»å‹çš„æ•°æ®ã€‚")]),be,a(o)])}const ye=c(v,[["render",ge],["__file","å¿…ä¼šAPIs.html.vue"]]);export{ye as default};
