import{_ as n,M as a,p as t,q as e,N as p,a1 as o}from"./framework-5866ffd3.js";const i="/Vite/plugin.png",l={},c=o(`<h1 id="vite插件开发" tabindex="-1"><a class="header-anchor" href="#vite插件开发" aria-hidden="true">#</a> Vite插件开发</h1><h2 id="dns预解析插件" tabindex="-1"><a class="header-anchor" href="#dns预解析插件" aria-hidden="true">#</a> DNS预解析插件</h2><h3 id="_1-初始化项目" tabindex="-1"><a class="header-anchor" href="#_1-初始化项目" aria-hidden="true">#</a> 1.初始化项目</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">add</span> vite typescript @mistjs/tsconfig-vue eslint @mistjs/eslint-config-vue tsup vitest @vitejs/plugin-vue vue vite-plugin-inspect <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>vite核心包，用于开发vite插件</li><li>@types/node：node的类型声明</li><li>typescript：ts类型声明</li><li>@mistjs/tsconfig-vue:ts配置文件</li><li>eslint:代码检查</li><li>@mistjs/eslint-config-vue：eslint配置文件</li><li>vite-plugin-inspect:插件调试</li><li>@vitejs/plugin-vue:vite的vue插件</li><li>tsup：基于rooup的构建工具，构建插件包</li></ul><p>定义script脚本</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite-plugin-dns-prefetch&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1.1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a plugin of dns-prefetch&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/main.mjs&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/main.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/main.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev:eg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite dev vite-project&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:eg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build vite-project&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;preview:eg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite preview vite-project&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsup&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;release&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bumpp&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;changelog&quot;</span><span class="token operator">:</span><span class="token string">&quot;changelogen --output CHANGELOG.md&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;dist&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;vite-plugin-dns-prefetch&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dns-prefetch&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;prefetch&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fancy_fish&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@mistjs/eslint-config-vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@mistjs/tsconfig-vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.1.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^20.1.7&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@vitejs/plugin-vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.2.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;changelogen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.5.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.40.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;node-html-parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.1.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tsup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.7.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url-regex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vite&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.3.7&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vite-plugin-inspect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.7.26&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vitest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.31.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.2&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tsup的配置</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;tsup&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;src/main.ts&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 入口</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  dts<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 生成dist</span>
  clean<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  format<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;cjs&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;esm&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tsconfig.json</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@mistjs/tsconfig-vue&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;isolatedModules&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>eslintrc</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@mistjs/eslint-config-vue&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>文件目录</p><p><img src="`+i+'" alt=""></p><h3 id="_2-思路" tabindex="-1"><a class="header-anchor" href="#_2-思路" aria-hidden="true">#</a> 2.思路</h3><ol><li>dns预解析只需要在生产环境中使用，因此插件配置<code>apply:’build’</code></li><li>解析用户文件中包含https的url</li><li>在transformIndexHtml钩子的head里添加<code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;${url}&quot;/&gt;</code>即可</li></ol><h3 id="_3-用户自定义扩展" tabindex="-1"><a class="header-anchor" href="#_3-用户自定义扩展" aria-hidden="true">#</a> 3.用户自定义扩展</h3><ol><li><code>limit</code>:限制最多添加多少个dns预解析，太多对网络也是负担，这里默认是10个</li><li><code>parseFile</code>：解析哪些文件，数组类型，例如指定<code>’.ts’|’.js’</code></li><li><code>excludeDnsPrefetchUrl</code>:对于哪些url不采用预解析（一些大家可能经常访问的url本身就在缓存里了就没必要预解析了）</li><li><code>addDnsUrl</code>：用户也可以直接添加一些URL进行预解析。</li></ol>',19);function u(r,d){const s=a("CommentService");return t(),e("div",null,[c,p(s)])}const v=n(l,[["render",u],["__file","Vite插件开发.html.vue"]]);export{v as default};
