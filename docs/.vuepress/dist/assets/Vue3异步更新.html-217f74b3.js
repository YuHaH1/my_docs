import{_ as s,M as a,p as e,q as t,N as p,a1 as o}from"./framework-f7ec573f.js";const c={},l=o(`<h1 id="vue3" tabindex="-1"><a class="header-anchor" href="#vue3" aria-hidden="true">#</a> Vue3</h1><p>Vue3的异步更新由<code>scheduler</code>调度程序执行具体任务，以保证生命周期和组件渲染的正确性。</p><p>Vue3中scheduler维护三个队列<code>pre/queue/ post</code></p><table><thead><tr><th></th><th>Pre队列</th><th>queue队列</th><th>Post队列</th></tr></thead><tbody><tr><td>队列作用</td><td>执行组件更新之前的任务</td><td>执行组件更新时的任务</td><td>执行组件更新之后的任务</td></tr><tr><td>出队方式</td><td>先进先出</td><td>允许插队，按任务id从小大排列执行</td><td>按任务id从小大排列执行</td></tr></tbody></table><h2 id="pre队列任务" tabindex="-1"><a class="header-anchor" href="#pre队列任务" aria-hidden="true">#</a> pre队列任务</h2><p>这个队列的任务只有<code>watch</code>和<code>watchEffect</code>，当它两没有指定<code>{post}</code>时默认就是pre</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">doWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">let</span> scheduler<span class="token operator">:</span> EffectScheduler
  <span class="token keyword">if</span> <span class="token punctuation">(</span>flush <span class="token operator">===</span> <span class="token string">&#39;sync&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scheduler <span class="token operator">=</span> job <span class="token keyword">as</span> <span class="token builtin">any</span> <span class="token comment">// the scheduler function gets called directly</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>flush <span class="token operator">===</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">scheduler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">queuePostRenderEffect</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> instance <span class="token operator">&amp;&amp;</span> instance<span class="token punctuation">.</span>suspense<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// default: &#39;pre&#39;</span>
    # watch和watchEffect的回调默认是pre任务
    job<span class="token punctuation">.</span>pre <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> job<span class="token punctuation">.</span>id <span class="token operator">=</span> instance<span class="token punctuation">.</span>uid
    <span class="token function-variable function">scheduler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">queueJob</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7);function i(u,d){const n=a("CommentService");return e(),t("div",null,[l,p(n)])}const k=s(c,[["render",i],["__file","Vue3异步更新.html.vue"]]);export{k as default};
