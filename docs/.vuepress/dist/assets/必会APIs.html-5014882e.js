import{_ as c,M as p,p as i,q as l,R as n,t as s,N as a,a1 as e}from"./framework-5866ffd3.js";const u="/javaScript/notification.png",r={},d=n("h1",{id:"å¿…ä¼šapis",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#å¿…ä¼šapis","aria-hidden":"true"},"#"),s(" å¿…ä¼šAPIs")],-1),k=n("h2",{id:"_1-intersectionobserverè§†å£äº¤å‰çŠ¶æ€æ£€æµ‹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-intersectionobserverè§†å£äº¤å‰çŠ¶æ€æ£€æµ‹","aria-hidden":"true"},"#"),s(" 1.IntersectionObserverè§†å£äº¤å‰çŠ¶æ€æ£€æµ‹")],-1),v=n("code",null,"IntersectionObserver",-1),m={href:"https://developer.mozilla.org/zh-CN/docs/Glossary/Viewport",target:"_blank",rel:"noopener noreferrer"},b=n("p",null,[s("å½“ä¸€ä¸ª "),n("code",null,"IntersectionObserver"),s(" å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œå…¶è¢«é…ç½®ä¸ºç›‘å¬æ ¹ä¸­ä¸€æ®µç»™å®šæ¯”ä¾‹çš„å¯è§åŒºåŸŸã€‚ä¸€æ—¦ "),n("code",null,"IntersectionObserver"),s(" è¢«åˆ›å»ºï¼Œåˆ™æ— æ³•æ›´æ”¹å…¶é…ç½®ï¼Œæ‰€ä»¥ä¸€ä¸ªç»™å®šçš„è§‚å¯Ÿè€…å¯¹è±¡åªèƒ½ç”¨æ¥ç›‘å¬å¯è§åŒºåŸŸçš„ç‰¹å®šå˜åŒ–å€¼ï¼›ç„¶è€Œï¼Œä½ å¯ä»¥åœ¨åŒä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡ä¸­é…ç½®ç›‘å¬å¤šä¸ªç›®æ ‡å…ƒç´ ã€‚")],-1),h=n("p",null,"å®ä¾‹èº«ä¸Šçš„å±æ€§",-1),g={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Element",target:"_blank",rel:"noopener noreferrer"},f={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Document",target:"_blank",rel:"noopener noreferrer"},_=n("code",null,"root",-1),y=n("code",null,"null",-1),w={href:"https://developer.mozilla.org/en-US/docs/Glossary/Bounding_box",target:"_blank",rel:"noopener noreferrer"},q=n("strong",null,"åƒç´ ",-1),x=n("code",null,"px",-1),I=n("strong",null,"ç™¾åˆ†æ¯”",-1),C=n("code",null,"%",-1),W=n("li",null,"thresholdsï¼šä¸€ä¸ªåŒ…å«é˜ˆå€¼çš„åˆ—è¡¨ï¼ŒæŒ‰å‡åºæ’åˆ—ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªé˜ˆå€¼éƒ½æ˜¯ç›‘å¬å¯¹è±¡çš„äº¤å‰åŒºåŸŸä¸è¾¹ç•ŒåŒºåŸŸçš„æ¯”ç‡ã€‚å½“ç›‘å¬å¯¹è±¡çš„ä»»ä½•é˜ˆå€¼è¢«è¶Šè¿‡æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªé€šçŸ¥ï¼ˆNotificationï¼‰ã€‚å¦‚æœæ„é€ å™¨æœªä¼ å…¥å€¼ï¼Œåˆ™é»˜è®¤å€¼ä¸º 0ã€‚",-1),j=n("p",null,"å®ä¾‹æ–¹æ³•",-1),P={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/disconnect",target:"_blank",rel:"noopener noreferrer"},A=n("code",null,"IntersectionObserver.disconnect()",-1),S=n("code",null,"IntersectionObserver",-1),z={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/observe",target:"_blank",rel:"noopener noreferrer"},N=n("code",null,"IntersectionObserver.observe()",-1),O=n("code",null,"IntersectionObserver",-1),M={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/takeRecords",target:"_blank",rel:"noopener noreferrer"},E=n("code",null,"IntersectionObserver.takeRecords()",-1),R={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserverEntry",target:"_blank",rel:"noopener noreferrer"},D=n("code",null,"IntersectionObserverEntry",-1),B={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/unobserve",target:"_blank",rel:"noopener noreferrer"},L=n("code",null,"IntersectionObserver.unobserve()",-1),T=n("code",null,"IntersectionObserver",-1),V=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Intersection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//thresholdï¼šå±æ€§å†³å®šç›¸äº¤æ¯”ä¾‹ä¸ºå¤šå°‘æ—¶ï¼Œè§¦å‘å›è°ƒå‡½æ•°ã€‚å–å€¼ä¸º 0 ~ 1ï¼Œæˆ–è€… 0 ~ 1çš„æ•°ç»„ã€‚</span>
        <span class="token literal-property property">rootMargin</span><span class="token operator">:</span> <span class="token string">&quot;0px&quot;</span><span class="token punctuation">,</span><span class="token comment">//rootMarginï¼š ç±»ä¼¼äº CSS çš„ margin å±æ€§ã€‚ç”¨æ¥ç¼©å°æˆ–æ‰©å¤§ rootBoundsï¼Œä»è€Œå½±å“ç›¸äº¤çš„è§¦å‘ </span>
        <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">//rootï¼šè®¾ç½®ç›‘è§†å™¨çš„æ ¹èŠ‚ç‚¹ï¼Œä¸ä¼ åˆ™é»˜è®¤ä¸ºè§†å£ã€‚</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*
        entriesçš„å±æ€§
        timeï¼šå‘ç”Ÿç›¸äº¤åˆ°ç›¸åº”çš„æ—¶é—´ï¼Œæ¯«ç§’ã€‚
        rootBoundsï¼šæ ¹å…ƒç´ çŸ©å½¢åŒºåŸŸçš„ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ ¹å…ƒç´ åˆ™è¿”å›nullï¼Œå›¾ä¸­è“è‰²éƒ¨åˆ†åŒºåŸŸã€‚
        boundingClientRectï¼šç›®æ ‡å…ƒç´ çš„çŸ©å½¢åŒºåŸŸçš„ä¿¡æ¯ï¼Œå›¾ä¸­é»‘è‰²è¾¹æ¡†çš„åŒºåŸŸã€‚
        intersectionRectï¼šç›®æ ‡å…ƒç´ ä¸è§†å£ï¼ˆæˆ–æ ¹å…ƒç´ ï¼‰çš„äº¤å‰åŒºåŸŸçš„ä¿¡æ¯ï¼Œå›¾ä¸­è“è‰²æ–¹å—å’Œç²‰çº¢è‰²æ–¹å—ç›¸äº¤çš„åŒºåŸŸã€‚
        isIntersectingï¼šç›®æ ‡å…ƒç´ ä¸æ ¹å…ƒç´ æ˜¯å¦ç›¸äº¤
        intersectionRatioï¼šç›®æ ‡å…ƒç´ ä¸è§†å£ï¼ˆæˆ–æ ¹å…ƒç´ ï¼‰çš„ç›¸äº¤æ¯”ä¾‹ã€‚
        targetï¼šç›®æ ‡å…ƒç´ ã€‚
    */</span>
    <span class="token keyword">const</span> iso <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
        entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                index<span class="token operator">++</span>
                v<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./image/image</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
                iso<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>

    <span class="token comment">// å¼€å¯è§‚å¯Ÿ</span>
    img<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        iso<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-å‰ªè´´æ¿clipboard" tabindex="-1"><a class="header-anchor" href="#_2-å‰ªè´´æ¿clipboard" aria-hidden="true">#</a> 2.å‰ªè´´æ¿Clipboard</h2>`,2),U={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand",target:"_blank",rel:"noopener noreferrer"},G=n("code",null,"document.execCommand()",-1),F=e(`<p>1.<code>document.execCommand()</code>å®ç°</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token comment">// å¤åˆ¶æ–‡æœ¬</span>
<span class="token keyword">function</span> <span class="token function">copyText</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–‡æœ¬è¾“å…¥æ¡†</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ‰§è¡Œå¤åˆ¶å‘½ä»¤</span>
  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;copy&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åˆ é™¤ä¸´æ—¶æ–‡æœ¬è¾“å…¥æ¡†</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç²˜è´´æ–‡æœ¬</span>
<span class="token keyword">function</span> <span class="token function">pasteText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–‡æœ¬è¾“å…¥æ¡†</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ‰§è¡Œç²˜è´´å‘½ä»¤</span>
  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;paste&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token comment">// åˆ é™¤ä¸´æ—¶æ–‡æœ¬è¾“å…¥æ¡†</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> text<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.clipboardå®ç°</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>ä½¿ç”¨å‰å¿…é¡»focusèšç„¦åœ¨æ–‡æ¡£å†…ï¼Œå¦åˆ™æŠ¥é”™Uncaught (in promise) DOMException: Document is not focusedã€‚æ§åˆ¶å°è§¦å‘å°±ä¸è¡Œ</p></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>å¤åˆ¶
navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
ç²˜è´´
<span class="token keyword">const</span> clipboardData <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-requestanimationframe" tabindex="-1"><a class="header-anchor" href="#_3-requestanimationframe" aria-hidden="true">#</a> 3.requestAnimationFrame</h2><p><strong><code>window.requestAnimationFrame()</code></strong> å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œ<strong>è¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œã€‚</strong></p><p>å½“ <code>requestAnimationFrame()</code> è¿è¡Œåœ¨åå°æ ‡ç­¾é¡µæˆ–è€…éšè—çš„ iframe é‡Œæ—¶ï¼Œ<code>requestAnimationFrame()</code> ä¼šè¢«æš‚åœè°ƒç”¨ä»¥æå‡æ€§èƒ½å’Œç”µæ± å¯¿å‘½ã€‚</p>`,8),H={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelAnimationFrame",target:"_blank",rel:"noopener noreferrer"},J=n("code",null,"window.cancelAnimationFrame()",-1),K=e(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DOMHighResTimeStamp<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> id<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">{</span>
            <span class="token comment">// å®ƒè¡¨ç¤º requestAnimationFrame() å¼€å§‹æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ—¶åˆ»ã€‚</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>DOMHighResTimeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-requestidlecallback" tabindex="-1"><a class="header-anchor" href="#_4-requestidlecallback" aria-hidden="true">#</a> 4.requestIdleCallback</h2><p>æ–¹æ³•æ’å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨ã€‚è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚å‡½æ•°ä¸€èˆ¬ä¼šæŒ‰å…ˆè¿›å…ˆè°ƒç”¨çš„é¡ºåºæ‰§è¡Œï¼Œç„¶è€Œï¼Œå¦‚æœå›è°ƒå‡½æ•°æŒ‡å®šäº†æ‰§è¡Œè¶…æ—¶æ—¶é—´<code>timeout</code>ï¼Œåˆ™æœ‰å¯èƒ½ä¸ºäº†åœ¨è¶…æ—¶å‰æ‰§è¡Œå‡½æ•°è€Œæ‰“ä¹±æ‰§è¡Œé¡ºåºã€‚</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>å¦‚æœè¯¥å›è°ƒä»»åŠ¡å¿…é¡»æ‰§è¡Œï¼Œéœ€è¦è®¾ç½®timeouté˜²æ­¢è¶…æ—¶ï¼Œå› æ­¤è¯¥å‡½æ•°ä¸€èˆ¬ç”¨äºæ‰§è¡Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡</p></div>`,4),Y={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelIdleCallback",target:"_blank",rel:"noopener noreferrer"},X=n("code",null,"Window.cancelIdleCallback()",-1),$=e(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>IdleDeadline<span class="token operator">:</span><span class="token punctuation">{</span>didTimeout<span class="token operator">:</span><span class="token builtin">boolean</span><span class="token punctuation">,</span><span class="token function-variable function">timeRemaining</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>IdleDeadline<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            timeout<span class="token operator">:</span> <span class="token number">2000</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å›è°ƒæ¥æ”¶ä¸€ä¸ªIdleDeadlineå‚æ•°å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„timeRemainingè¡¨ç¤ºå‰©ä½™å¤šå°‘é—²ç½®æ—¶é—´ï¼Œå¦‚æœ idle period å·²ç»ç»“æŸï¼Œåˆ™å®ƒçš„å€¼æ˜¯ 0ã€‚ä½ çš„å›è°ƒå‡½æ•° (ä¼ ç»™ requestIdleCallback çš„å‡½æ•°) å¯ä»¥é‡å¤çš„è®¿é—®è¿™ä¸ªå±æ€§ç”¨æ¥åˆ¤æ–­å½“å‰çº¿ç¨‹çš„é—²ç½®æ—¶é—´æ˜¯å¦å¯ä»¥åœ¨ç»“æŸå‰æ‰§è¡Œæ›´å¤šçš„ä»»åŠ¡ã€‚</p><h2 id="_5-web-workers" tabindex="-1"><a class="header-anchor" href="#_5-web-workers" aria-hidden="true">#</a> 5.Web Workers</h2>`,3),Q={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest",target:"_blank",rel:"noopener noreferrer"},Z=n("code",null,"XMLHttpRequest",-1),nn=n("code",null,"responseXML",-1),sn=n("code",null,"channel",-1),an=n("h3",{id:"è§„åˆ™",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#è§„åˆ™","aria-hidden":"true"},"#"),s(" è§„åˆ™ï¼š")],-1),tn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/Worker",target:"_blank",rel:"noopener noreferrer"},en=n("code",null,"Worker('xxx.js')",-1),pn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window",target:"_blank",rel:"noopener noreferrer"},on=n("code",null,"window",-1),cn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Worker",target:"_blank",rel:"noopener noreferrer"},ln=n("code",null,"Worker",-1),un={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window",target:"_blank",rel:"noopener noreferrer"},rn=n("code",null,"window",-1),dn=n("u",null,"æƒ³è¦è®¿é—®å…¨å±€ä¸Šä¸‹æ–‡ç”¨",-1),kn=n("code",null,"self",-1),vn=e("<li><p>workerå†…æ— æ³•ç›´æ¥æ“çºµDOM</p></li><li><p>workerså’Œä¸»çº¿ç¨‹æ•°æ®ä½¿ç”¨postMessageæ–¹æ³•å‘é€æ¶ˆæ¯</p></li><li><p>ç»ˆæ­¢è§„åˆ™ä¸¤ç§æ–¹æ³• 1.<code>workerå®ä¾‹.terminate()</code> 2.workersè°ƒç”¨è‡ªå·±çš„<code>close()</code>å…³é—­</p></li><li><p>ç›‘å¬æ¶ˆæ¯<code>onmessage</code></p></li><li><p><u>åœ¨ä¸»é¡µé¢ä¸ worker ä¹‹é—´ä¼ é€’çš„æ•°æ®æ˜¯é€šè¿‡<strong>æ‹·è´</strong>ï¼Œè€Œä¸æ˜¯å…±äº«æ¥å®Œæˆçš„ã€‚ä¼ é€’ç»™ <code>worker</code> çš„å¯¹è±¡éœ€è¦ç»è¿‡åºåˆ—åŒ–ï¼Œæ¥ä¸‹æ¥åœ¨å¦ä¸€ç«¯è¿˜éœ€è¦ååºåˆ—åŒ–ã€‚é¡µé¢ä¸ <code>worker</code> <strong>ä¸ä¼šå…±äº«åŒä¸€ä¸ªå®ä¾‹</strong>ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯åœ¨æ¯æ¬¡é€šä¿¡ç»“æŸæ—¶ç”Ÿæˆäº†æ•°æ®çš„<strong>ä¸€ä¸ªå‰¯æœ¬</strong>ã€‚</u></p></li><li><p>é”™è¯¯å¤„ç†å½“ worker å‡ºç°è¿è¡Œä¸­é”™è¯¯æ—¶ï¼Œå®ƒçš„ <code>onerror</code> äº‹ä»¶å¤„ç†å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚å®ƒä¼šæ”¶åˆ°ä¸€ä¸ªæ‰©å±•äº† <code>ErrorEvent</code> æ¥å£çš„åä¸º <code>error</code>çš„äº‹ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹é”™è¯¯ä¿¡æ¯æ‰¾åˆ°é”™è¯¯åŸå› ï¼š</p><ol><li><p><code>message</code>å¯è¯»æ€§è‰¯å¥½çš„é”™è¯¯æ¶ˆæ¯ã€‚</p></li><li><p><code>filename</code>å‘ç”Ÿé”™è¯¯çš„è„šæœ¬æ–‡ä»¶åã€‚</p></li><li><p><code>lineno</code>å‘ç”Ÿé”™è¯¯æ—¶æ‰€åœ¨è„šæœ¬æ–‡ä»¶çš„è¡Œå·ã€‚</p></li></ol></li>",6),mn=e(`<h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> ä½¿ç”¨åœºæ™¯</h3><ol><li>ã€‚ç”±äº Worker ä¸èƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªè„šæœ¬å¿…é¡»æ¥è‡ªç½‘ç»œã€‚å¦‚æœä¸‹è½½æ²¡æœ‰æˆåŠŸï¼ˆæ¯”å¦‚404é”™è¯¯ï¼‰ï¼ŒWorker å°±ä¼šé»˜é»˜åœ°å¤±è´¥ã€‚</li><li>åŠ å¯†æ•°æ® æœ‰äº›åŠ è§£å¯†çš„ç®—æ³•æ¯”è¾ƒå¤æ‚ï¼Œæˆ–è€…åœ¨åŠ è§£å¯†å¾ˆå¤šæ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¼šéå¸¸è€—è´¹è®¡ç®—èµ„æºï¼Œå¯¼è‡´UIçº¿ç¨‹æ— å“åº”ï¼Œå› æ­¤è¿™æ˜¯ä½¿ç”¨Web Workerçš„å¥½æ—¶æœºï¼Œä½¿ç”¨Workerçº¿ç¨‹å¯ä»¥è®©ç”¨æˆ·æ›´åŠ æ— ç¼çš„æ“ä½œUIã€‚ é¢„å–æ•°æ®</li><li>æœ‰æ—¶å€™ä¸ºäº†æå‡æ•°æ®åŠ è½½é€Ÿåº¦ï¼Œå¯ä»¥æå‰ä½¿ç”¨Workerçº¿ç¨‹è·å–æ•°æ®ï¼Œå› ä¸ºWorkerçº¿ç¨‹æ˜¯å¯ä»¥æ˜¯ç”¨ XMLHttpRequest çš„ã€‚ é¢„æ¸²æŸ“åœ¨æŸäº›æ¸²æŸ“åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚æ¸²æŸ“å¤æ‚çš„canvasçš„æ—¶å€™éœ€è¦è®¡ç®—çš„æ•ˆæœæ¯”å¦‚åå°„ã€æŠ˜å°„ã€å…‰å½±ã€ææ–™ç­‰ï¼Œè¿™äº›è®¡ç®—çš„é€»è¾‘å¯ä»¥ä½¿ç”¨Workerçº¿ç¨‹æ¥æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªWorkerçº¿ç¨‹ã€‚</li><li>å¤æ‚æ•°æ®å¤„ç†åœºæ™¯æŸäº›æ£€ç´¢ã€æ’åºã€è¿‡æ»¤ã€åˆ†æä¼šéå¸¸è€—è´¹æ—¶é—´ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨Web Workeræ¥è¿›è¡Œï¼Œä¸å ç”¨ä¸»çº¿ç¨‹ã€‚</li><li>é¢„åŠ è½½å›¾ç‰‡æœ‰æ—¶å€™ä¸€ä¸ªé¡µé¢æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œæˆ–è€…æœ‰å‡ ä¸ªå¾ˆå¤§çš„å›¾ç‰‡çš„æ—¶å€™ï¼Œå¦‚æœä¸šåŠ¡é™åˆ¶ä¸è€ƒè™‘æ‡’åŠ è½½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Web Workeræ¥åŠ è½½å›¾ç‰‡ã€‚</li></ol><p>::: warning:</p><p>è™½ç„¶ä½¿ç”¨workerçº¿ç¨‹ä¸ä¼šå ç”¨ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯å¯åŠ¨workerä¼šæ¯”è¾ƒè€—è´¹èµ„æºã€‚æ­¤å¤– ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨XMLHttpRequeståœ¨è¯·æ±‚è¿‡ç¨‹ä¸­æµè§ˆå™¨å¦å¼€äº†ä¸€ä¸ªå¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹ï¼Œä½†æ˜¯äº¤äº’è¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æ¶ˆè€—ä¸»çº¿ç¨‹èµ„æº</p><p>:::</p><h3 id="ä»£ç å±•ç¤º" tabindex="-1"><a class="header-anchor" href="#ä»£ç å±•ç¤º" aria-hidden="true">#</a> ä»£ç å±•ç¤º</h3><p><strong>ä¸»è¿›ç¨‹ä»£ç ç¤ºä¾‹</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js&quot;</span><span class="token punctuation">)</span>

worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ä¸»è¿›ç¨‹ç›‘å¬æ¶ˆæ¯&#39;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>

<span class="token punctuation">}</span>

worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">è¿™æ˜¯ä¸€æ¡ä¸»è¿›ç¨‹ç»™workerçš„æ¶ˆæ¯</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>document<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>workersä»£ç ç¤ºä¾‹</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>\\<span class="token operator">*</span> Worker å†…éƒ¨å¦‚æœè¦åŠ è½½å…¶ä»–è„šæœ¬ï¼Œ

\\<span class="token operator">*</span> <span class="token function">æœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•importScripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ã€‚ <span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">&#39;script1.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

\\<span class="token operator">*</span> <span class="token function">è¯¥æ–¹æ³•å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªè„šæœ¬importScripts</span><span class="token punctuation">(</span><span class="token string">&#39;script1.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;script2.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">*</span><span class="token operator">/</span>
<span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">&#39;./other_script.js&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> worker_data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">123</span>
<span class="token punctuation">}</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;workerç›‘å¬æ¶ˆæ¯&#39;</span><span class="token punctuation">,</span> ev<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>worker_data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…±äº«worker" tabindex="-1"><a class="header-anchor" href="#å…±äº«worker" aria-hidden="true">#</a> å…±äº«worker</h3><p>ä¸€ä¸ªå…±äº« worker å¯ä»¥è¢«å¤šä¸ªè„šæœ¬ä½¿ç”¨â€”â€”å³ä½¿è¿™äº›è„šæœ¬æ­£åœ¨è¢«ä¸åŒçš„ windowã€iframe æˆ–è€… worker è®¿é—®ã€‚</p><div class="custom-container danger"><p class="custom-container-title">DANGER</p><ol><li>å¦‚æœå…±äº« worker å¯ä»¥è¢«å¤šä¸ªæµè§ˆä¸Šä¸‹æ–‡è°ƒç”¨ï¼Œæ‰€æœ‰è¿™äº›æµè§ˆä¸Šä¸‹æ–‡å¿…é¡»å±äºåŒæºï¼ˆç›¸åŒçš„åè®®ï¼Œä¸»æœºå’Œç«¯å£å·ï¼‰ã€‚</li></ol></div><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„å…±äº« worker ä¸ç”Ÿæˆä¸€ä¸ªä¸“ç”¨ worker éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯æ„é€ å™¨çš„åå­—ä¸åŒindex.html å’Œ index2.htmlâ€”â€”ç”Ÿæˆå…±äº« worker çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const shareWorker = new SharedWorker(&#39;worker.js&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><u></u></p><h4 id="è§„åˆ™-1" tabindex="-1"><a class="header-anchor" href="#è§„åˆ™-1" aria-hidden="true">#</a> è§„åˆ™</h4><ol><li>ä¸€ä¸ªéå¸¸å¤§çš„åŒºåˆ«åœ¨äºï¼Œä¸ä¸€ä¸ªå…±äº« worker é€šä¿¡å¿…é¡»é€šè¿‡ç«¯å£å¯¹è±¡â€”â€”ã€‹ä¸€ä¸ªç¡®åˆ‡çš„æ‰“å¼€çš„ç«¯å£ä¾›è„šæœ¬ä¸ worker é€šä¿¡ï¼ˆåœ¨ä¸“ç”¨ worker ä¸­è¿™ä¸€éƒ¨åˆ†æ˜¯éšå¼è¿›è¡Œçš„ï¼‰ã€‚</li><li>åœ¨ä¼ é€’æ¶ˆæ¯ä¹‹å‰ï¼Œç«¯å£è¿æ¥å¿…é¡»è¢«æ˜¾å¼çš„æ‰“å¼€ï¼Œæ‰“å¼€æ–¹å¼æ˜¯ä½¿ç”¨ onmessage äº‹ä»¶å¤„ç†å‡½æ•°æˆ–è€… start() æ–¹æ³•ã€‚start() æ–¹æ³•çš„è°ƒç”¨åªåœ¨ä¸€ç§æƒ…å†µä¸‹éœ€è¦ï¼Œé‚£å°±æ˜¯æ¶ˆæ¯äº‹ä»¶addEventListener() æ–¹æ³•è¢«ä½¿ç”¨ã€‚</li><li>workerè¿›ç¨‹ä¸­ä½¿ç”¨ <code>onconnect</code> äº‹ä»¶å¤„ç†å‡½æ•°æ¥æ‰§è¡Œä»£ç ã€‚</li></ol><h4 id="ä»£ç å±•ç¤º-1" tabindex="-1"><a class="header-anchor" href="#ä»£ç å±•ç¤º-1" aria-hidden="true">#</a> ä»£ç å±•ç¤º</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>index<span class="token punctuation">.</span>html <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token comment">/*
        * Worker å†…éƒ¨å¦‚æœè¦åŠ è½½å…¶ä»–è„šæœ¬ï¼Œ
        * æœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•importScripts()ã€‚ importScripts(&#39;script1.js&#39;);
        * è¯¥æ–¹æ³•å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªè„šæœ¬importScripts(&#39;script1.js&#39;, &#39;script2.js&#39;);
        */</span>

        <span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js&quot;</span><span class="token punctuation">)</span>
        worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ä¸»è¿›ç¨‹1ç›‘å¬æ¶ˆæ¯&#39;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">è¿™æ˜¯ä¸€æ¡ä¸»è¿›ç¨‹1ç»™workerçš„æ¶ˆæ¯</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>index<span class="token punctuation">.</span>html <span class="token operator">-</span> <span class="token number">2</span>

    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token comment">/*
        * Worker å†…éƒ¨å¦‚æœè¦åŠ è½½å…¶ä»–è„šæœ¬ï¼Œ
        * æœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•importScripts()ã€‚ importScripts(&#39;script1.js&#39;);
        * è¯¥æ–¹æ³•å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªè„šæœ¬importScripts(&#39;script1.js&#39;, &#39;script2.js&#39;);
        */</span>

        <span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js&quot;</span><span class="token punctuation">)</span>
        worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ä¸»è¿›ç¨‹2ç›‘å¬æ¶ˆæ¯&#39;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">è¿™æ˜¯ä¸€æ¡ä¸»è¿›ç¨‹2ç»™workerçš„æ¶ˆæ¯</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>worker

<span class="token function-variable function">onconnect</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä½¿ç”¨äº‹ä»¶çš„ ports å±æ€§æ¥è·å–ç«¯å£å¹¶å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚</span>
    <span class="token keyword">var</span> port <span class="token operator">=</span> e<span class="token punctuation">.</span>ports<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> workerResult <span class="token operator">=</span> <span class="token string">&#39;Result: &#39;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>workerResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-pwa-æ¸è¿›å¼-web-åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_6-pwa-æ¸è¿›å¼-web-åº”ç”¨" aria-hidden="true">#</a> 6.PWA-æ¸è¿›å¼ Web åº”ç”¨</h2><p>**ä¼˜ç‚¹ï¼š**PWA æ˜¯å¯è¢«å‘ç°ã€æ˜“å®‰è£…ã€å¯é“¾æ¥ã€ç‹¬ç«‹äºç½‘ç»œã€æ¸è¿›å¼ã€å¯é‡ç”¨ã€å“åº”æ€§å’Œå®‰å…¨çš„ã€‚å…³äºè¿™äº›å«ä¹‰çš„ç»†èŠ‚</p><p>**PWAèƒ½å®ç°å“ªäº›åŠŸèƒ½ï¼Ÿ**1.æ·»åŠ ä¸»å±å¹• 2.æ¨é€æ¶ˆæ¯é€šçŸ¥ 3.ç¦»çº¿ä½¿ç”¨åº”ç”¨ 4.å¯å…±äº«URLåˆ†äº«ç»™ä»–äºº</p><h3 id="pwaçš„æ¶æ„" tabindex="-1"><a class="header-anchor" href="#pwaçš„æ¶æ„" aria-hidden="true">#</a> PWAçš„æ¶æ„</h3><p>æ¸²æŸ“ç½‘ç«™ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³• - åœ¨æœåŠ¡å™¨ä¸Šæˆ–åœ¨å®¢æˆ·ç«¯ä¸Šã€‚å®ƒä»¬éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œä½ å¯ä»¥é€‚å½“åœ°æ··åˆä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•</p><ul><li>æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„æ„æ€æ˜¯åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“ç½‘é¡µï¼Œå› æ­¤é¦–æ¬¡åŠ è½½ä¼šæ›´å¿«ï¼Œä½†æ˜¯åœ¨ä¸åŒé¡µé¢ä¹‹é—´å¯¼èˆªéƒ½éœ€è¦ä¸‹è½½æ–°çš„ HTML å†…å®¹ã€‚å®ƒçš„è·¨æµè§ˆå™¨å…¼å®¹æ€§è‰¯å¥½ï¼Œä½†ä»£ä»·æ˜¯é¡µé—´åŠ è½½æ—¶é—´å»¶é•¿ï¼Œä¹Ÿå°±æ˜¯æ€»ä½“æ„ŸçŸ¥ä¸Šçš„æ€§èƒ½é™ä½ï¼šæ¯åŠ è½½ä¸€ä¸ªé¡µé¢ï¼Œéƒ½éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨è¯·æ±‚å¾€è¿”çš„æ—¶é—´ã€‚</li><li>å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰å…è®¸åœ¨å¯¼èˆªåˆ°ä¸åŒé¡µé¢æ—¶å‡ ä¹ç«‹å³åœ¨æµè§ˆå™¨ä¸­æ›´æ–°ç½‘ç«™ï¼Œä½†åœ¨å¼€å§‹æ—¶éœ€è¦æ›´å¤šçš„åˆå§‹ä¸‹è½½å’Œå®¢æˆ·ç«¯ä¸Šçš„é¢å¤–æ¸²æŸ“ã€‚é¦–æ¬¡è®¿é—®æ—¶ç½‘ç«™é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†åç»­è®¿é—®é€Ÿåº¦è¦å¿«å¾—å¤šã€‚</li></ul>`,28),bn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Streams_API",target:"_blank",rel:"noopener noreferrer"},hn=e(`<h3 id="æ·»åŠ ä¸»å±å¹•" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ ä¸»å±å¹•" aria-hidden="true">#</a> æ·»åŠ ä¸»å±å¹•</h3><p><strong>è§„åˆ™ï¼š</strong></p><ol><li>åº”ç”¨é€šè¿‡ HTTPS æä¾›æœåŠ¡â€”â€”Web æ­£æœç€æ›´åŠ å®‰å…¨çš„æ–¹å‘å‘å±•ï¼ŒåŒ…æ‹¬ A2HS åœ¨å†…çš„è®¸å¤šç°ä»£ Web æŠ€æœ¯éƒ½å°†ä»…å·¥ä½œåœ¨å®‰å…¨çš„ç¯å¢ƒä¸­ã€‚</li><li>ä» HTML å¤´é“¾æ¥å…·æœ‰æ­£ç¡®å­—æ®µçš„ manifest æ–‡ä»¶ã€‚</li><li>æœ‰åˆé€‚çš„å›¾æ ‡å¯æ˜¾ç¤ºåœ¨ä¸»å±å¹•ä¸Šã€‚(uiéœ€è¦å®šåˆ¶å°ºå¯¸)</li><li>Chrome æµè§ˆå™¨è¿˜è¦æ±‚è¯¥åº”ç”¨ç¨‹åºæ³¨å†Œä¸€ä¸ª Service Workerï¼ˆè¿™æ ·åœ¨ç¦»çº¿çŠ¶æ€ä¸‹å°±ä¹Ÿå¯ä»¥è¿è¡Œï¼‰ã€‚</li></ol><div class="custom-container tip"><p class="custom-container-title">TIP</p><h4 id="manifestæ–‡ä»¶é…ç½®" tabindex="-1"><a class="header-anchor" href="#manifestæ–‡ä»¶é…ç½®" aria-hidden="true">#</a> manifestæ–‡ä»¶é…ç½®</h4><p><strong>manifest</strong>:Web manifest ä»¥æ ‡å‡† JSON æ ¼å¼ç¼–å†™ï¼Œåº”æ”¾ç½®åœ¨åº”ç”¨ç¨‹åºç›®å½•ä¸­çš„æŸä¸ªä½ç½®ï¼ˆæœ€å¥½æ˜¯åœ¨æ ¹ç›®å½•ä¸­ï¼‰</p><p>htmlä¸­éœ€è¦å¼•å…¥è¯¥æ–‡ä»¶ğŸ‰</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manifest.webmanifest<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li><code>background_color</code>ï¼šæŒ‡å®šåœ¨æŸäº›åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„èƒŒæ™¯è‰²ã€‚ä¸ A2HS æœ€ç›¸å…³çš„ä¸€ä¸ªæ˜¯åœ¨ç‚¹å‡»ä¸»å±å¹•ä¸Šçš„åº”ç”¨ç¨‹åºå›¾æ ‡å¹¶é¦–æ¬¡å¼€å§‹åŠ è½½æ—¶æ˜¾ç¤ºçš„åˆå§‹å±å¹•ï¼ˆç›®å‰ä»…åœ¨é€šè¿‡ Chrome å°†åº”ç”¨æ·»åŠ åˆ°ä¸»å±å¹•æ—¶æ˜¾ç¤ºï¼‰ã€‚</li><li><code>display</code>ï¼šæŒ‡å®šåº”å¦‚ä½•æ˜¾ç¤ºåº”ç”¨ã€‚ä¸ºäº†ä½¿å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªåº”ç”¨ç¨‹åºè€Œéç½‘é¡µï¼Œè¿™é‡Œåº”è¯¥å¡«å†™åƒæ˜¯ <code>fullscreen</code> ï¼ˆæ ¹æœ¬ä¸æ˜¾ç¤ºä»»ä½• UIï¼‰æˆ– <code>standalone</code>ï¼ˆä¸å‰è€…éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯çŠ¶æ€æ è¿™æ ·çš„ç³»ç»Ÿçº§ UI å…ƒç´ å¯èƒ½æ˜¯å¯è§çš„ï¼‰çš„å€¼ã€‚</li><li><code>icons</code>ï¼šæŒ‡å®šåœ¨ä¸åŒä½ç½®ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä»»åŠ¡åˆ‡æ¢å™¨ä¸Šæˆ–æ›´é‡è¦çš„æ˜¯åœ¨ä¸»å±å¹•ä¸Šï¼‰è¡¨ç¤ºåº”ç”¨ç¨‹åºæ—¶æµè§ˆå™¨ä½¿ç”¨çš„å›¾æ ‡ã€‚æˆ‘ä»¬çš„æ¼”ç¤ºä¸­ä»…åŒ…å«ä¸€ä¸ªã€‚(<u>è¯·æ³¨æ„ï¼Œæ¯ä¸ªå›¾æ ‡å¯¹è±¡ä¸­çš„ <code>type</code> æˆå‘˜éƒ½æŒ‡å®šäº†è¯¥å›¾æ ‡çš„ MIME ç±»å‹ï¼Œå› æ­¤æµè§ˆå™¨å¯ä»¥å¿«é€Ÿè¯»å–è¯¥å›¾æ ‡çš„ç±»å‹ï¼Œå¹¶åœ¨ä¸æ”¯æŒæ­¤ç±»å‹æ—¶å°†å…¶å¿½ç•¥å¹¶é‡‡ç”¨å…¶ä»–å›¾æ ‡ã€‚</u>)</li><li><code>name</code>/<code>short_name</code>ï¼šè¿™äº›å­—æ®µæä¾›äº†åœ¨ä¸åŒä½ç½®è¡¨ç¤ºåº”ç”¨ç¨‹åºæ—¶è¦æ˜¾ç¤ºçš„åº”ç”¨ç¨‹åºåç§°ã€‚<code>name</code> æä¾›å®Œæ•´çš„åº”ç”¨åç§°ã€‚<code>short_name</code> åˆ™æ˜¯å½“æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ˜¾ç¤ºå…¨åæ—¶ï¼Œæä¾›çš„ç¼©å†™åç§°ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºåç§°ç‰¹åˆ«é•¿ï¼Œå»ºè®®æ‚¨åŒæ—¶æä¾›ä¸¤è€…ã€‚</li><li><code>start_url</code>ï¼šæä¾›å¯åŠ¨æ·»åŠ åˆ°ä¸»å±å¹•åº”ç”¨ç¨‹åºæ—¶åº”åŠ è½½çš„èµ„æºçš„è·¯å¾„ã€‚è¯·æ³¨æ„ï¼Œè¿™å¿…é¡»æ˜¯ä¸€ä¸ªç›¸å¯¹ manifest æŒ‡å‘ç½‘ç«™ä¸»é¡µçš„ç›¸å¯¹è·¯å¾„ã€‚å¦è¯·æ³¨æ„ï¼ŒChrome éœ€è¦è¿™æ¡å­—æ®µæ‰èƒ½æ˜¾ç¤ºå®‰è£…æ ‡è¯­ï¼Œè€Œ Firefox å³ä½¿æ²¡æœ‰è¿™æ¡å­—æ®µä¹Ÿä¼šæ˜¾ç¤ºç”¨äºæ·»åŠ åˆ°ä¸»å±çš„å«åŠ å·çš„ä¸»é¡µå›¾æ ‡ã€‚</li></ul><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;js13kGames Progressive Web App&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;js13kPWA&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Progressive Web App that lists games submitted to the A-Frame category in the js13kGames 2017 competition.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-32.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;32x32&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-64.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;64x64&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-96.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;96x96&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-128.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;128x128&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-168.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;168x168&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-192.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192x192&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-256.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;256x256&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icons/icon-512.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;512x512&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;display&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fullscreen&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#B12A34&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#B12A34&quot;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),gn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"},fn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API",target:"_blank",rel:"noopener noreferrer"},_n={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API",target:"_blank",rel:"noopener noreferrer"},yn=e(`<h4 id="jsè§¦å‘æ—¶é—´æ·»åŠ åˆ°ä¸»å±å¹•" tabindex="-1"><a class="header-anchor" href="#jsè§¦å‘æ—¶é—´æ·»åŠ åˆ°ä¸»å±å¹•" aria-hidden="true">#</a> JSè§¦å‘æ—¶é—´æ·»åŠ åˆ°ä¸»å±å¹•</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>æ·»åŠ ä¸»å±å¹•<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;btn&#39;</span><span class="token punctuation">)</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;beforeinstallprompt&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// é˜²æ­¢ Chrome 67 åŠæ›´æ—©ç‰ˆæœ¬è‡ªåŠ¨æ˜¾ç¤ºå®‰è£…æç¤º</span>
            e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç¨åå†è§¦å‘æ­¤äº‹ä»¶ å°†äº‹ä»¶å¯¹è±¡å­˜å‚¨åœ¨ deferredPrompt å˜é‡ä¸­ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥ç”¨äºæ‰§è¡Œå®é™…å®‰è£…ã€‚ä¹‹åä½¿ç”¨ beforeinstallprompt äº‹ä»¶å¯¹è±¡ï¼ˆå­˜å‚¨åœ¨ deferredPrompt ä¸­ï¼‰ä¸Šå¯ç”¨çš„ prompt() æ–¹æ³•è§¦å‘æ˜¾ç¤ºå®‰è£…æç¤ºã€‚</span>
            deferredPrompt <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token comment">// æ›´æ–° UI ä»¥æé†’ç”¨æˆ·å¯ä»¥å°† App å®‰è£…åˆ°æ¡Œé¢</span>
            btn<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;block&#39;</span><span class="token punctuation">;</span>

            btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// éšè—æ˜¾ç¤º A2HS æŒ‰é’®çš„ç•Œé¢</span>
                btn<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span>
                <span class="token comment">// æ˜¾ç¤ºå®‰è£…æç¤º</span>
                deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ç­‰å¾…ç”¨æˆ·åé¦ˆ</span>
                deferredPrompt<span class="token punctuation">.</span>userChoice<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">choiceResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>choiceResult<span class="token punctuation">.</span>outcome <span class="token operator">===</span> <span class="token string">&#39;accepted&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;User accepted the A2HS prompt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;User dismissed the A2HS prompt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                     <span class="token comment">//å°† deferredPrompt è®¾ç½®ä¸º nullï¼Œå› ä¸ºä¸å†éœ€è¦å®ƒã€‚</span>
                    deferredPrompt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-pwaç¦»çº¿å·¥ä½œ-service-worker" tabindex="-1"><a class="header-anchor" href="#_7-pwaç¦»çº¿å·¥ä½œ-service-worker" aria-hidden="true">#</a> 7.PWAç¦»çº¿å·¥ä½œ-Service Worker</h2><p>Service Worker æ˜¯æµè§ˆå™¨å’Œç½‘ç»œä¹‹é—´çš„è™šæ‹Ÿä»£ç†ã€‚å®ƒä»¬ç»ˆäºè§£å†³äº†å‰ç«¯å¼€å‘äººå‘˜å¤šå¹´æ¥ä¸€ç›´åœ¨åŠªåŠ›è§£å†³çš„ä¸€äº›é—®é¢˜ï¼Œå…¶ä¸­æœ€å€¼å¾—å…³æ³¨çš„æ˜¯ï¼Œ<u>è§£å†³äº†å¦‚ä½•æ­£ç¡®ç¼“å­˜ç½‘ç«™èµ„æºå¹¶ä½¿å…¶åœ¨ç¦»çº¿æ—¶å¯ç”¨çš„é—®é¢˜ã€‚</u></p><p>Service workers éå¸¸å¼ºå¤§ï¼Œ<u>å› ä¸ºä»–ä»¬å¯ä»¥æ§åˆ¶ç½‘ç»œè¯·æ±‚ã€ä¿®æ”¹ç½‘ç»œè¯·æ±‚ã€è¿”å›ç¼“å­˜çš„è‡ªå®šä¹‰å“åº”ï¼Œæˆ–è€…åˆæˆå“åº”ã€‚</u></p><h3 id="service-workerç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#service-workerç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> Service Workerç”Ÿå‘½å‘¨æœŸ</h3><p>https://github.com/mdn/pwa-examples/tree/main/js13kpwaç¼“å­˜å±•ç¤º</p><ol><li><p>æ³¨å†Œ:ä¸»è¿›ç¨‹ä¸­æ³¨å†Œï¼Œæ³¨å†Œå®Œæˆåï¼Œsw.js æ–‡ä»¶ä¼šè‡ªåŠ¨ä¸‹è½½ã€å®‰è£…ï¼Œç„¶åæ¿€æ´»ã€‚</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&#39;serviceWorker&#39;</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&#39;/pwa-examples/js13kpwa/sw.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>å®‰è£…:åœ¨ <code>install</code> çš„ç›‘å¬å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–ç¼“å­˜å¹¶æ·»åŠ ç¦»çº¿åº”ç”¨æ—¶æ‰€éœ€çš„æ–‡ä»¶</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;install&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[Service Worker] Install&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ExtendableEvent.waitUntil() æ–¹æ³•å‘Šè¯‰äº‹ä»¶åˆ†å‘å™¨è¯¥äº‹ä»¶ä»åœ¨è¿›è¡Œã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥ç”¨äºæ£€æµ‹è¿›è¡Œçš„ä»»åŠ¡æ˜¯å¦æˆåŠŸã€‚åœ¨æœåŠ¡å·¥ä½œçº¿ç¨‹ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å‘Šè¯‰æµè§ˆå™¨äº‹ä»¶ä¸€ç›´è¿›è¡Œï¼Œç›´è‡³ promise è§£å†³ï¼Œæµè§ˆå™¨ä¸åº”è¯¥åœ¨äº‹ä»¶ä¸­çš„å¼‚æ­¥æ“ä½œå®Œæˆä¹‹å‰ç»ˆæ­¢æœåŠ¡å·¥ä½œçº¿ç¨‹ã€‚è¿™é‡Œå°±æ˜¯åœ¨ç¼“å­˜æ“ä½œå®Œæˆåæ‰èƒ½ç»ˆæ­¢æœåŠ¡å·¥ä½œçº¿ç¨‹åœ¨æ­¤ä¹‹å‰å°†æœåŠ¡å·¥ä½œçº¿ç¨‹ä¿æŒåœ¨ installingé˜¶æ®µ</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
      <span class="token operator">-</span>ã€‹ç¼“å­˜æ“ä½œ
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[Service Worker] Caching all: app shell and content&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contentToCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç¼“å­˜æ“ä½œ-ã€‹é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå­˜å‚¨ç¼“å­˜åå­—çš„å˜é‡ï¼ŒApp Shell æ‰€éœ€çš„æ–‡ä»¶è®°å½•</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> cacheName <span class="token operator">=</span> <span class="token string">&#39;ç¼“å­˜åå­—xxx&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> appShellFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token comment">//éœ€è¦ç¼“å­˜çš„æ–‡ä»¶</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/index.html&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/app.js&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/style.css&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/fonts/graduate.eot&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/fonts/graduate.ttf&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/fonts/graduate.woff&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/favicon.ico&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/img/js13kgames.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/img/bg.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-32.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-64.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-96.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-128.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-168.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-192.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-256.png&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-512.png&#39;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>æ¿€æ´»ï¼š<code>activate</code> äº‹ä»¶ï¼Œå®ƒçš„ç”¨æ³•è·Ÿ <code>install</code> äº‹ä»¶ç›¸åŒã€‚è¿™ä¸ªäº‹ä»¶é€šå¸¸ç”¨æ¥åˆ é™¤é‚£äº›æˆ‘ä»¬å·²ç»ä¸éœ€è¦çš„æ–‡ä»¶æˆ–è€…åšä¸€äº›æ¸…ç†å·¥ä½œã€‚</p><ol><li><p>æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;activate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">keyList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keyList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>å“åº”è¯·æ±‚ï¼š<code>fetch</code> äº‹ä»¶å¯¹æˆ‘ä»¬å¾ˆæœ‰ç”¨ï¼Œå®ƒåœ¨æ¯æ¬¡åº”ç”¨å‘èµ· HTTP è¯·æ±‚çš„æ—¶å€™è¢«è§¦å‘ã€‚è¿™ä¸ªäº‹ä»¶å¯¹æˆ‘ä»¬æ¥è¯´éå¸¸æœ‰ç”¨ï¼Œå®ƒå…è®¸æˆ‘ä»¬æ‹¦æˆªè¯·æ±‚å¹¶å¯¹è¯·æ±‚ä½œå‡ºè‡ªå®šä¹‰çš„å“åº”ã€‚</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;service worker è¯·æ±‚çš„url-ã€‹&#39;</span><span class="token operator">+</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å®é™…ä½¿ç”¨â€”â€”ã€‹å½“ç¼“å­˜å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¼“å­˜æ¥æä¾›æœåŠ¡ï¼Œè€Œä¸é‡æ–°è¯·æ±‚æ•°æ®ã€‚ä¸ç®¡å½“å‰åº”ç”¨æ˜¯åœ¨çº¿è¿˜æ˜¯ç¦»çº¿ï¼Œæˆ‘ä»¬éƒ½è¿™ä¹ˆåšã€‚å½“è¯·æ±‚çš„æ–‡ä»¶ä¸åœ¨ç¼“å­˜ä¸­æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨å“åº”ä¹‹å‰å°†æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//e.respondWith æ–¹æ³•å°†ä¼šæ¥ç®¡å“åº”æ§åˆ¶ï¼Œå®ƒä¼šä½œä¸ºæœåŠ¡å™¨å’Œåº”ç”¨ä¹‹é—´çš„ä»£ç†æœåŠ¡ã€‚å®ƒå…è®¸æˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªè¯·æ±‚ä½œå‡ºæˆ‘ä»¬æƒ³è¦çš„ä»»ä½•å“åº”ï¼šService Worker ä¼šå¤„ç†è¿™ä¸€åˆ‡ï¼Œä»ç¼“å­˜ä¸­è·å–è¿™äº›æ•°æ®ï¼Œå¹¶åœ¨éœ€è¦çš„æƒ…å†µä¸‹å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹ã€‚</span>
  e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
      <span class="token comment">//æ£€æŸ¥ç»™å®šçš„ Request æ˜¯å¦æ˜¯ CacheStorage å¯¹è±¡è·Ÿè¸ªçš„ä»»ä½• Cache å¯¹è±¡çš„é”®ï¼Œå¹¶è¿”å›ä¸€ä¸ª resolve ä¸ºè¯¥åŒ¹é…çš„ Promise .</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[Service Worker] Fetching resource: &#39;</span><span class="token operator">+</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å°±å‘è¯·æ±‚ç„¶åç¼“å­˜</span>
      <span class="token keyword">return</span> r <span class="token operator">||</span> <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li></ol><h4 id="cacheså¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#cacheså¯¹è±¡" aria-hidden="true">#</a> cacheså¯¹è±¡</h4>`,9),wn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API",target:"_blank",rel:"noopener noreferrer"},qn=n("strong",null,[n("code",null,"caches")],-1),xn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage",target:"_blank",rel:"noopener noreferrer"},In=n("code",null,"CacheStorage",-1),Cn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/open",target:"_blank",rel:"noopener noreferrer"},Wn=n("code",null,"CacheStorage.open()",-1),jn={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},Pn=n("code",null,"Promise",-1),An=n("code",null,"cacheName",-1),Sn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},zn=n("code",null,"Cache",-1),Nn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/delete",target:"_blank",rel:"noopener noreferrer"},On=n("code",null,"CacheStorage.delete()",-1),Mn=n("code",null,"cacheName",-1),En={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},Rn=n("code",null,"Cache",-1),Dn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},Bn=n("code",null,"Cache",-1),Ln={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},Tn=n("code",null,"Promise",-1),Vn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},Un=n("code",null,"Cache",-1),Gn=n("code",null,"false",-1),Fn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/keys",target:"_blank",rel:"noopener noreferrer"},Hn=n("code",null,"CacheStorage.keys()",-1),Jn={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},Kn=n("code",null,"Promise",-1),Yn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage",target:"_blank",rel:"noopener noreferrer"},Xn=n("code",null,"CacheStorage",-1),$n={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},Qn=n("code",null,"Cache",-1),Zn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},ns=n("code",null,"Cache",-1),ss={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/match",target:"_blank",rel:"noopener noreferrer"},as=n("code",null,"CacheStorage.match()",-1),ts={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request",target:"_blank",rel:"noopener noreferrer"},es=n("code",null,"Request",-1),ps={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage",target:"_blank",rel:"noopener noreferrer"},os=n("code",null,"CacheStorage",-1),cs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},is=n("code",null,"Cache",-1),ls={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},us=n("code",null,"Promise",-1),rs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage/has",target:"_blank",rel:"noopener noreferrer"},ds=n("code",null,"CacheStorage.has()",-1),ks=n("code",null,"cacheName",-1),vs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"},ms=n("code",null,"Cache",-1),bs={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"},hs=n("code",null,"Promise",-1),gs=e(`<h3 id="æ›´æ–°service-worker" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°service-worker" aria-hidden="true">#</a> æ›´æ–°service worker</h3><p>æˆ‘ä»¬å­˜æ”¾åœ¨ç¼“å­˜åç§°ä¸­çš„ç‰ˆæœ¬å·æ˜¯è¿™ä¸ªé—®é¢˜çš„å…³é”®</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> cacheName <span class="token operator">=</span> <span class="token string">&#39;js13kPWA-v1&#39;</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬æŠŠç‰ˆæœ¬å·æ›´æ–°åˆ° v2ï¼ŒService Worker ä¼šå°†æˆ‘ä»¬æ‰€æœ‰çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬é‚£äº›æ–°çš„æ–‡ä»¶ï¼‰æ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„ç¼“å­˜ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>contentToCache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/pwa-examples/js13kpwa/icons/icon-32.png&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;install&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;js13kPWA-v2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contentToCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ—¶å€™ä¸€ä¸ªæ–°çš„ Service Worker ä¼šåœ¨åå°è¢«å®‰è£…ï¼Œè€Œæ—§çš„ Service Worker ä»ç„¶ä¼šæ­£å¸¸è¿è¡Œï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•é¡µé¢ä½¿ç”¨åˆ°å®ƒä¸ºæ­¢ï¼Œè¿™æ—¶å€™æ–°çš„ Service Worker å°†ä¼šè¢«æ¿€æ´»ï¼Œç„¶åæ¥ç®¡æ‰€æœ‰çš„é¡µé¢ã€‚</p><h2 id="_8-pwa-æ¶ˆæ¯æ¨é€å’Œé€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#_8-pwa-æ¶ˆæ¯æ¨é€å’Œé€šçŸ¥" aria-hidden="true">#</a> 8.PWA-æ¶ˆæ¯æ¨é€å’Œé€šçŸ¥</h2><p>https://developer.mozilla.org/zh-CN/docs/Web/API/Push_APIæ¨é€API</p><p>https://developer.mozilla.org/zh-CN/docs/Web/API/Notifications_APIé€šçŸ¥API</p><h3 id="_1-è¯·æ±‚æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_1-è¯·æ±‚æˆæƒ" aria-hidden="true">#</a> 1.è¯·æ±‚æˆæƒ</h3><p>æœ€å¥½é€šè¿‡ä¸€äº›å¼•å¯¼ç”¨æˆ·çš„äº‹ä»¶å»è§¦å‘</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">&#39;granted&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">randomNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨æˆ·çš„æˆæƒçš„ç»“æœæœ‰ä¸‰ç§ï¼Œdefaultï¼ˆé»˜è®¤ï¼‰ã€grantedï¼ˆå…è®¸ï¼‰æˆ–è€… deniedï¼ˆæ‹’ç»ï¼‰ï¼Œå½“ç”¨æˆ·æ²¡æœ‰åšå‡ºé€‰æ‹©çš„æ—¶å€™ï¼Œæˆæƒç»“æœä¼šè¿”å› defaultï¼Œ å¦å¤–ä¸¤ç§ç»“æœåˆ†åˆ«åœ¨ç”¨æˆ·é€‰æ‹©äº†å…è®¸æˆ–è€…æ‹’ç»çš„æ—¶å€™è¿”å›ã€‚ä¸€æ—¦ç”¨æˆ·é€‰æ‹©æˆæƒï¼Œè¿™ä¸ªæˆæƒç»“æœå¯¹é€šçŸ¥ API å’Œæ¨é€ API ä¸¤è€…éƒ½æœ‰æ•ˆã€‚</p><h3 id="_2-åˆ›å»ºé€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#_2-åˆ›å»ºé€šçŸ¥" aria-hidden="true">#</a> 2.åˆ›å»ºé€šçŸ¥</h3><p>åœ¨æˆæƒä¹‹åå¯ä»¥åˆ›å»ºé€šçŸ¥æ¶ˆæ¯</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token keyword">function</span> <span class="token function">noti</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">&#39;granted&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">randomNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">&#39;denied&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">noti</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">noti</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">function</span> <span class="token function">randomNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> notifTitle <span class="token operator">=</span> <span class="token string">&#39;è¿™æ˜¯é€šçŸ¥æ ‡é¢˜&#39;</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> notifBody <span class="token operator">=</span> <span class="token string">&#39;é€šçŸ¥å†…å®¹&#39;</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> notifImg <span class="token operator">=</span> <span class="token string">&#39;./bgc.png&#39;</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">body</span><span class="token operator">:</span> notifBody<span class="token punctuation">,</span>
                <span class="token literal-property property">icon</span><span class="token operator">:</span> notifImg
            <span class="token punctuation">}</span>
            <span class="token keyword">var</span> notif <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span>notifTitle<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span>randomNotification<span class="token punctuation">,</span> <span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+u+`" alt="image-20230508185124595"></p><h3 id="_3-æ¶ˆæ¯æ¨é€" tabindex="-1"><a class="header-anchor" href="#_3-æ¶ˆæ¯æ¨é€" aria-hidden="true">#</a> 3.æ¶ˆæ¯æ¨é€</h3><p>åœ¨ Service Worker å†…éƒ¨ï¼Œå­˜åœ¨ä¸€ä¸ªæ¶ˆæ¯æ¨é€æœåŠ¡è®¢é˜…æœºåˆ¶ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>registration<span class="token punctuation">.</span>pushManager<span class="token punctuation">.</span><span class="token function">getSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token comment">/* ... */</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,20),fs={href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/push_event",target:"_blank",rel:"noopener noreferrer"},_s=n("code",null,"push",-1),ys=e(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>self.addEventListener(&#39;push&#39;, function(e) { /* ... */ });
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>demo:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Register a Service Worker.</span>
navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&#39;service-worker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>ready
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">registration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç”¨PushManagerè·å–ç”¨æˆ·å¯¹æœåŠ¡ç«¯æ¨é€æœåŠ¡çš„è®¢é˜… </span>
  <span class="token keyword">return</span> registration<span class="token punctuation">.</span>pushManager<span class="token punctuation">.</span><span class="token function">getSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">subscription</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//å¦‚æœç”¨æˆ·å·²ç»å®Œæˆè®¢é˜…ï¼Œæˆ‘ä»¬ç›´æ¥è¿”å› subscription å¯¹è±¡å¹¶ä¸”è·³è½¬åˆ°è®¢é˜…éƒ¨åˆ†ã€‚å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ subscription å¯¹è±¡ï¼š</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subscription<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> subscription<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">//App ä¼šä»æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªå…¬é’¥å¹¶ä¸”æŠŠå“åº”ç»“æœè½¬åŒ–æˆæ–‡æœ¬ï¼Œæœ€åå®ƒè¿˜éœ€è¦è½¬åŒ–æˆä¸€ä¸ª Uint8Arrayï¼ˆä¸ºäº†å…¼å®¹ Chromeï¼‰ã€‚</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;./vapidPublicKey&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vapidPublicKey <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> convertedVapidKey <span class="token operator">=</span> <span class="token function">urlBase64ToUint8Array</span><span class="token punctuation">(</span>vapidPublicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//App ç°åœ¨å¯ä»¥ä½¿ç”¨ PushManager æ¥è®¢é˜…æ–°ç”¨æˆ·ã€‚è¿™ä¸ªæ–¹æ³•æ”¯æŒä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ userVisibleOnly: trueï¼Œæ„æ€æ˜¯å‘é€ç»™ç”¨æˆ·çš„æ‰€æœ‰é€šçŸ¥å¯¹ä»–ä»¬éƒ½æ˜¯å¯è§çš„ï¼Œç¬¬äºŒä¸ªæ˜¯ applicationServerKeyï¼Œè¿™ä¸ªå‚æ•°åŒ…å«æˆ‘ä»¬ä¹‹å‰ä»æœåŠ¡ç«¯å–å¾—å¹¶è½¬åŒ–çš„ VAPID keyã€‚</span>
    <span class="token keyword">return</span> registration<span class="token punctuation">.</span>pushManager<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">userVisibleOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">applicationServerKey</span><span class="token operator">:</span> convertedVapidKey
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">subscription</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// é¦–å…ˆä½¿ç”¨ fetch å°† subscription ä»¥ JSON çš„æ–¹å¼å‘é€ç»™æœåŠ¡å™¨ã€‚</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;./register&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;Content-type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">subscription</span><span class="token operator">:</span> subscription
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;doIt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> payload <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;notification-payload&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">const</span> delay <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;notification-delay&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ttl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;notification-ttl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>

<span class="token comment">//å½“æŒ‰é’®è¢«ç‚¹å‡»çš„æ—¶å€™ï¼Œfetch ä¼šè¯·æ±‚æœåŠ¡å™¨æ ¹æ®ç»™å®šçš„å‚æ•°å‘é€é€šçŸ¥ï¼Œpayload å‚æ•°åŒ…å«é€šçŸ¥é‡Œé¢è¦æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œdelay å‚æ•°å®šä¹‰äº†é€šçŸ¥å°†ä¼šå»¶è¿Ÿå±•ç¤ºçš„ç§’æ•°ï¼Œttl æ˜¯ time-to-live çš„ç¼©å†™ï¼Œç”¨æ¥è®¾ç½®é€šçŸ¥åœ¨æœåŠ¡å™¨ä¸Šçš„å­˜æ´»æ—¶é—´ï¼Œä¾ç„¶æ˜¯ä»¥ç§’ä¸ºå•ä½ã€‚</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;./sendNotification&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#39;Content-type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">subscription</span><span class="token operator">:</span> subscription<span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> payload<span class="token punctuation">,</span>
        <span class="token literal-property property">delay</span><span class="token operator">:</span> delay<span class="token punctuation">,</span>
        <span class="token literal-property property">ttl</span><span class="token operator">:</span> ttl<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœåŠ¡ç«¯</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Use the web-push library to hide the implementation details of the communication</span>
<span class="token comment">// between the application server and the push service.</span>
<span class="token comment">// For details, see https://tools.ietf.org/html/draft-ietf-webpush-protocol and</span>
<span class="token comment">// https://tools.ietf.org/html/draft-ietf-webpush-encryption.</span>
<span class="token keyword">const</span> webPush <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;web-push&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//web-push æ¨¡å—è¢«ç”¨æ¥é…ç½® VAPID å¯†é’¥ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œè¿˜å¯ä»¥ç”Ÿæˆä¸€ä¸ªã€‚</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PUBLIC_KEY</span> <span class="token operator">||</span> <span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PRIVATE_KEY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token string">&quot;You must set the VAPID_PUBLIC_KEY and VAPID_PRIVATE_KEY &quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;environment variables. You can use the following ones:&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>webPush<span class="token punctuation">.</span><span class="token function">generateVAPIDKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Set the keys used for encrypting the push messages.</span>
webPush<span class="token punctuation">.</span><span class="token function">setVapidDetails</span><span class="token punctuation">(</span>
  <span class="token string">&quot;https://example.com/&quot;</span><span class="token punctuation">,</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PUBLIC_KEY</span><span class="token punctuation">,</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PRIVATE_KEY</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¸€ä¸ªæ¨¡å—å®šä¹‰å¹¶å¯¼å‡ºäº†æ‰€æœ‰åº”ç”¨éœ€è¦å¤„ç†çš„è·¯ç”±ï¼šè·å– VAPID å…¬é’¥ã€æ³¨å†Œã€å‘é€é€šçŸ¥ç­‰ç­‰ã€‚ä½ å¯ä»¥çœ‹åˆ°æ¥è‡ª index.js çš„ payload, delay å’Œttl å˜é‡åœ¨è¿™é‡Œè¢«ç”¨åˆ°äº†ã€‚</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>route <span class="token operator">+</span> <span class="token string">&quot;vapidPublicKey&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VAPID_PUBLIC_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>route <span class="token operator">+</span> <span class="token string">&quot;register&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// A real world application would store the subscription info.</span>
    res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>route <span class="token operator">+</span> <span class="token string">&quot;sendNotification&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subscription <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>subscription<span class="token punctuation">;</span>
    <span class="token keyword">const</span> payload <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token constant">TTL</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>ttl<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      webPush
        <span class="token punctuation">.</span><span class="token function">sendNotification</span><span class="token punctuation">(</span>subscription<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>delay <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>serviceâ€”â€”worker</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//å®ƒåšçš„å°±åªæ˜¯ç›‘å¬ push (en-US) äº‹ä»¶ï¼Œåˆ›å»º payload å˜é‡ï¼Œè¿™ä¸ªå˜é‡åŒ…å«äº†æ¥è‡ª event.data çš„æ–‡æœ¬ï¼ˆå¦‚æœ data æ˜¯ç©ºçš„ï¼Œå°±è®¾ç½®æˆ &quot;no payload&quot; å­—ç¬¦ä¸²ï¼‰ï¼Œç„¶åä¸€ç›´ç­‰åˆ°é€šçŸ¥æ¨é€ç»™ç”¨æˆ·ä¸ºæ­¢ã€‚</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;push&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Retrieve the textual payload from event.data (a PushMessageData object).</span>
  <span class="token comment">// æ”¯æŒArrayBuffer, Blob, JSON è¿™äº›æ•°æ®</span>
  <span class="token keyword">const</span> payload <span class="token operator">=</span> event<span class="token punctuation">.</span>data <span class="token operator">?</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;no data&#39;</span><span class="token punctuation">;</span>
  <span class="token comment">// ä¿æŒæ¨é€çŠ¶æ€ç›´åˆ°æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„æ¨é€</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    <span class="token comment">// Show a notification with title &#39;ServiceWorker Cookbook&#39; and use the payload</span>
    <span class="token comment">// as the body.</span>
    self<span class="token punctuation">.</span>registration<span class="token punctuation">.</span><span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">&#39;ServiceWorker Cookbook&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> payload<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-mutationoberver" tabindex="-1"><a class="header-anchor" href="#_9-mutationoberver" aria-hidden="true">#</a> 9.MutationOberver</h2>`,8),ws={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver",target:"_blank",rel:"noopener noreferrer"},qs=n("code",null,"MutationObserver",-1),xs=n("p",null,"è¯­æ³•ï¼š",-1),Is=e(`<li><p>è¯¥æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> mo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li>`,1),Cs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationRecord",target:"_blank",rel:"noopener noreferrer"},Ws=n("code",null,"MutationRecord",-1),js=n("code",null,"MutationObserver",-1),Ps=n("p",null,"è¯¥å®ä¾‹èº«ä¸Šæœ‰ä¸‰ä¸ªæ–¹æ³•",-1),As={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/disconnect",target:"_blank",rel:"noopener noreferrer"},Ss=n("code",null,"disconnect()",-1),zs=n("code",null,"MutationObserver",-1),Ns={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/observe",target:"_blank",rel:"noopener noreferrer"},Os=n("code",null,"observe()",-1),Ms={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/observe",target:"_blank",rel:"noopener noreferrer"},Es=n("code",null,"observe()",-1),Rs=n("code",null,"MutationObserver",-1),Ds={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/takeRecords",target:"_blank",rel:"noopener noreferrer"},Bs=n("code",null,"takeRecords()",-1),Ls={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MutationRecord",target:"_blank",rel:"noopener noreferrer"},Ts=n("code",null,"MutationRecord",-1),Vs={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array",target:"_blank",rel:"noopener noreferrer"},Us=n("code",null,"Array",-1),Gs=e(`<li><p>observeå¿…é¡»è¦æŒ‡å®šé…ç½®è§‚å¯Ÿä»€ä¹ˆå˜åŠ¨ï¼Œæ¯å½“è§‚å¯Ÿå¸¦çš„é…ç½®å˜åŠ¨å°±ä¼šè§¦å‘å›è°ƒçš„æ‰§è¡Œ</p><ol><li><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// è§‚å¯Ÿå™¨çš„é…ç½®ï¼ˆéœ€è¦è§‚å¯Ÿä»€ä¹ˆå˜åŠ¨ï¼‰</span>
<span class="token keyword">interface</span> <span class="token class-name">IObserverConfig</span> <span class="token punctuation">{</span>
    subtree<span class="token operator">:</span> <span class="token builtin">boolean</span>  <span class="token comment">//ç›‘å¬ä»¥targetä¸ºæ ¹èŠ‚ç‚¹çš„æ•´ä¸ªå­æ ‘åŠå…¶å­æ ‘çš„å±æ€§ï¼Œ</span>
    childList<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">//ç›‘å¬targetèŠ‚ç‚¹å‘ç”Ÿçš„èŠ‚ç‚¹æ–°å¢æˆ–åˆ é™¤ï¼ˆå¦‚æœsubtreeä¸ºtrueæ•´ä¸ªå­æ ‘éƒ½ç”Ÿæ•ˆï¼‰</span>
    attributes<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">//ç›‘å¬èŠ‚ç‚¹å±æ€§å€¼çš„å˜åŒ–  é»˜è®¤ä¸ºtrue ä½†ä¸€æ—¦å£°æ˜characterDataOldValue|attributeFilteré»˜è®¤å€¼å°±å˜ä¸ºfalse</span>
    attributeFilter<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token comment">// å£°æ˜ä¸€ä¸ªå±æ€§åæ•°ç»„ç”¨äºç›‘å¬ã€‚ä¸è¿‡ä¸å£°æ˜é»˜è®¤ä»»ä½•å±æ€§å˜åŒ–éƒ½è§¦å‘å›è°ƒ</span>
    attributeOldValue<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// è®°å½•ä¸Šä¸€æ¬¡è¢«ç›‘å¬èŠ‚ç‚¹çš„å±æ€§å˜åŒ–</span>
    characterData<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// ç›‘å¬targetèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å­—ç¬¦å˜åŒ– é»˜è®¤å€¼true  å¦‚æœå£°æ˜äº†characterDataOldValueé»˜è®¤å€¼false</span>
    characterDataOldValue<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// è®°å½•ä¸Šä¸€ä¸ªè¢«ç›‘å¬èŠ‚ç‚¹ä¸­å‘ç”Ÿçš„æ–‡æœ¬å˜åŒ– é»˜è®¤false</span>
<span class="token punctuation">}</span>
MutationObserver <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span>

MutationObserver
disconnect

Æ’ <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
observe

Æ’ <span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
takeRecords

Æ’ <span class="token function">takeRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>ä»£ç å±•ç¤º</p><ol><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ul id<span class="token operator">=</span><span class="token string">&quot;ul&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">4</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>aaa<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>

        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;btn&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;ul&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">MutationRecord<span class="token punctuation">,</span> MutationObserver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            MutationRecord<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mutation<span class="token punctuation">,</span> MutationObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> mo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        <span class="token keyword">const</span> observeConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        mo<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>ul<span class="token punctuation">,</span> observeConfig<span class="token punctuation">)</span>
        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> iterator <span class="token keyword">of</span> ul<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            ul<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">?</span> ul<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token operator">...</span>ul<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token operator">:</span> ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token operator">...</span>children<span class="token punctuation">)</span>
            Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> mo<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li>`,2),Fs=n("h2",{id:"_10-å­˜å‚¨ç›¸å…³indexeddb",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_10-å­˜å‚¨ç›¸å…³indexeddb","aria-hidden":"true"},"#"),s(" 10.å­˜å‚¨ç›¸å…³IndexedDB")],-1),Hs=n("p",null,"æ¥å£æ˜¯å¼‚æ­¥çš„ä¸”æ”¯æŒäº‹åŠ¡ï¼ˆè¦ä¹ˆå…¨éƒ¨æˆåŠŸ è¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼‰",-1),Js=n("p",null,"å‰é¢å·²ç»è¯´äº†service worker äº† è¿™é‡Œå†è¯´ä¸€ä¸ªIndexedDB storegeç»å¸¸ç”¨å°±ä¸€ç¬”å¸¦è¿‡äº†ã€‚",-1),Ks={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API",target:"_blank",rel:"noopener noreferrer"},Ys=e(`<p>ä»€ä¹ˆæ˜¯IndexedDBï¼ŸIndexedDB æ˜¯ä¸€ä¸ªåŸºäº JavaScript çš„é¢å‘å¯¹è±¡æ•°æ®åº“ã€‚</p><p>ä½¿ç”¨IndexedDBæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›å‰ç½®çŸ¥è¯†ï¼š</p><ol><li><p>å­˜å‚¨é™åˆ¶ï¼š</p></li><li><p>æµè§ˆå™¨çš„æœ€å¤§å­˜å‚¨ç©ºé—´æ˜¯åŠ¨æ€çš„â€”â€”å®ƒå–å†³äºæ‚¨çš„ç¡¬ç›˜å¤§å°ã€‚ <strong>å…¨å±€é™åˆ¶</strong>ä¸ºå¯ç”¨ç£ç›˜ç©ºé—´çš„ 50ï¼…ã€‚åœ¨ Firefox ä¸­ï¼Œä¸€ä¸ªåä¸º Quota Manager çš„å†…éƒ¨æµè§ˆå™¨å·¥å…·ä¼šè·Ÿè¸ªæ¯ä¸ªæºç”¨å°½çš„ç£ç›˜ç©ºé—´ï¼Œå¹¶åœ¨å¿…è¦æ—¶åˆ é™¤æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœæ‚¨çš„ç¡¬ç›˜é©±åŠ¨å™¨æ˜¯ 500GBï¼Œé‚£ä¹ˆæµè§ˆå™¨çš„æ€»å­˜å‚¨å®¹é‡ä¸º 250GBã€‚å¦‚æœè¶…è¿‡æ­¤èŒƒå›´ï¼Œåˆ™ä¼šå‘èµ·ç§°ä¸º<strong>æºå›æ”¶</strong>çš„è¿‡ç¨‹ï¼Œåˆ é™¤æ•´ä¸ªæºçš„æ•°æ®ï¼Œç›´åˆ°å­˜å‚¨é‡å†æ¬¡ä½äºé™åˆ¶ã€‚åˆ é™¤æºæ•°æ®æ²¡æœ‰åªåˆ ä¸€éƒ¨åˆ†çš„è¯´æ³•â€”â€”å› ä¸ºè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>è¿˜æœ‰å¦ä¸€ä¸ªé™åˆ¶ç§°ä¸º<strong>ç»„é™åˆ¶</strong>â€”â€”è¿™è¢«å®šä¹‰ä¸ºå…¨å±€é™åˆ¶çš„ 20ï¼…ï¼Œä½†å®ƒè‡³å°‘æœ‰ 10 MBï¼Œæœ€å¤§ä¸º 2GBã€‚æ¯ä¸ªæºéƒ½æ˜¯ä¸€ç»„ï¼ˆæºç»„ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚æ¯ä¸ª eTLD+1 åŸŸéƒ½æœ‰ä¸€ä¸ªç»„ã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>mozilla.org</code>â€”â€”ç»„ 1ï¼Œæº 1</li><li><code>www.mozilla.org</code>â€”â€”ç»„ 1ï¼Œæº 2</li><li><code>joe.blogs.mozilla.org</code>â€”â€”ç»„ 1ï¼Œæº 3</li><li><code>firefox.com</code> â€”â€”ç»„ 2ï¼Œæº 4</li></ul><p>åœ¨è¿™ä¸ªç»„ä¸­ï¼Œ<code>mozilla.org</code>ã€<code>www.mozilla.org</code>å’Œ<code>joe.blogs.mozilla.org</code>å¯ä»¥èšåˆä½¿ç”¨æœ€å¤š 20ï¼…çš„å…¨å±€é™åˆ¶ã€‚firefox.com å•ç‹¬æœ€å¤šä½¿ç”¨ 20ï¼…ã€‚</p></li></ol><h2 id="â€”æ ·å¼ç›¸å…³apisâ€”" tabindex="-1"><a class="header-anchor" href="#â€”æ ·å¼ç›¸å…³apisâ€”" aria-hidden="true">#</a> â€”æ ·å¼ç›¸å…³APIsâ€”</h2><h3 id="_1-getcomputedstyle" tabindex="-1"><a class="header-anchor" href="#_1-getcomputedstyle" aria-hidden="true">#</a> 1.getComputedStyle</h3><p><code>Window.getComputedStyle()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨åº”ç”¨æ´»åŠ¨æ ·å¼è¡¨å¹¶è§£æè¿™äº›å€¼å¯èƒ½åŒ…å«çš„ä»»ä½•åŸºæœ¬è®¡ç®—åæŠ¥å‘Šå…ƒç´ çš„æ‰€æœ‰ CSS å±æ€§çš„å€¼ã€‚ç§æœ‰çš„ CSS å±æ€§å€¼å¯ä»¥é€šè¿‡å¯¹è±¡æä¾›çš„ API æˆ–é€šè¿‡ç®€å•åœ°ä½¿ç”¨ CSS å±æ€§åç§°è¿›è¡Œç´¢å¼•æ¥è®¿é—®ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>element
ç”¨äºè·å–è®¡ç®—æ ·å¼çš„Elementã€‚

pseudoElt å¯é€‰
æŒ‡å®šä¸€ä¸ªè¦åŒ¹é…çš„ä¼ªå…ƒç´ çš„å­—ç¬¦ä¸²ã€‚å¿…é¡»å¯¹æ™®é€šå…ƒç´ çœç•¥ï¼ˆæˆ–<span class="token keyword">null</span>ï¼‰ã€‚
<span class="token keyword">let</span> style <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">[</span>pseudoElt<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
è¿”å›çš„styleæ˜¯ä¸€ä¸ªå®æ—¶çš„ CSSStyleDeclaration å¯¹è±¡ï¼Œå½“å…ƒç´ çš„æ ·å¼æ›´æ”¹æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ›´æ–°æœ¬èº«ã€‚

 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>h3<span class="token punctuation">,</span> <span class="token string">&#39;::after&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),Xs={class:"custom-container tip"},$s=n("p",{class:"custom-container-title"},"TIP",-1),Qs={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/style",target:"_blank",rel:"noopener noreferrer"},Zs=n("code",null,"style",-1),na=n("code",null,"getComputedStyle",-1),sa=n("code",null,"<style>",-1),aa=n("code",null,"elt.style",-1);function ta(ea,pa){const t=p("ExternalLinkIcon"),o=p("CommentService");return i(),l("div",null,[d,k,n("p",null,[v,s("æä¾›äº†ä¸€ç§å¼‚æ­¥è§‚å¯Ÿç›®æ ‡å…ƒç´ ä¸å…¶ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£"),n("a",m,[s("è§†å£"),a(t)]),s("ï¼ˆviewportï¼‰äº¤å‰çŠ¶æ€çš„æ–¹æ³•ã€‚å…¶ç¥–å…ˆå…ƒç´ æˆ–è§†å£è¢«ç§°ä¸ºæ ¹ï¼ˆrootï¼‰ã€‚")]),b,n("ol",null,[n("li",null,[h,n("ol",null,[n("li",null,[s("rootï¼šæµ‹è¯•äº¤å‰æ—¶ï¼Œç”¨ä½œè¾¹ç•Œç›’çš„"),n("a",g,[s("å…ƒç´ "),a(t)]),s("æˆ–"),n("a",f,[s("æ–‡æ¡£"),a(t)]),s("ã€‚å¦‚æœæ„é€ å‡½æ•°æœªä¼ å…¥ "),_,s(" æˆ–å…¶å€¼ä¸º"),y,s("ï¼Œåˆ™é»˜è®¤ä½¿ç”¨é¡¶çº§æ–‡æ¡£çš„è§†å£ã€‚")]),n("li",null,[s("rootMarginï¼šè®¡ç®—äº¤å‰æ—¶æ·»åŠ åˆ°æ ¹"),n("a",w,[s("è¾¹ç•Œç›’ (en-US)"),a(t)]),s("çš„çŸ©å½¢åç§»é‡ï¼Œå¯ä»¥æœ‰æ•ˆçš„ç¼©å°æˆ–æ‰©å¤§æ ¹çš„åˆ¤å®šèŒƒå›´ä»è€Œæ»¡è¶³è®¡ç®—éœ€è¦ã€‚æ­¤å±æ€§è¿”å›çš„å€¼å¯èƒ½ä¸è°ƒç”¨æ„é€ å‡½æ•°æ—¶æŒ‡å®šçš„å€¼ä¸åŒï¼Œå› æ­¤å¯èƒ½éœ€è¦æ›´æ”¹è¯¥å€¼ï¼Œä»¥åŒ¹é…å†…éƒ¨è¦æ±‚ã€‚æ‰€æœ‰çš„åç§»é‡å‡å¯ç”¨"),q,s("ï¼ˆ"),x,s("ï¼‰æˆ–"),I,s("ï¼ˆ"),C,s("ï¼‰æ¥è¡¨è¾¾ï¼Œé»˜è®¤å€¼ä¸º â€œ0px 0px 0px 0pxâ€ã€‚")]),W])]),n("li",null,[j,n("ol",null,[n("li",null,[n("p",null,[n("a",P,[A,a(t)]),s("ä½¿ "),S,s(" å¯¹è±¡åœæ­¢ç›‘å¬ç›®æ ‡ã€‚")])]),n("li",null,[n("p",null,[n("a",z,[N,a(t)]),s("ä½¿ "),O,s(" å¼€å§‹ç›‘å¬ä¸€ä¸ªç›®æ ‡å…ƒç´ ã€‚")])]),n("li",null,[n("p",null,[n("a",M,[E,a(t)]),s("è¿”å›æ‰€æœ‰è§‚å¯Ÿç›®æ ‡çš„ "),n("a",R,[D,a(t)]),s(" å¯¹è±¡æ•°ç»„ã€‚")])]),n("li",null,[n("p",null,[n("a",B,[L,a(t)]),s("ä½¿ "),T,s(" åœæ­¢ç›‘å¬ç‰¹å®šç›®æ ‡å…ƒç´ ã€‚")])])])])]),V,n("p",null,[s("è¯¥ API è¢«è®¾è®¡ç”¨æ¥å–ä»£ä½¿ç”¨ "),n("a",U,[G,a(t)]),s(" çš„å‰ªè´´æ¿è®¿é—®æ–¹å¼ã€‚")]),F,n("p",null,[s("è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªidå¯ä»¥ç”¨äº"),n("a",H,[J,a(t)]),s("å–æ¶ˆ")]),K,n("p",null,[s("è¯¥å‡½æ•°è¿”å›ä¸€ä¸ª IDï¼Œå¯ä»¥æŠŠå®ƒä¼ å…¥ "),n("a",Y,[X,a(t)]),s(" æ–¹æ³•æ¥ç»“æŸå›è°ƒã€‚")]),$,n("p",null,[s("Web Worker ä¸º Web å†…å®¹åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œè„šæœ¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ã€‚çº¿ç¨‹å¯ä»¥æ‰§è¡Œä»»åŠ¡è€Œä¸å¹²æ‰°ç”¨æˆ·ç•Œé¢ã€‚æ­¤å¤–ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨"),n("a",Q,[Z,a(t)]),s("æ‰§è¡Œ I/O (å°½ç®¡"),nn,s("å’Œ"),sn,s("å±æ€§æ€»æ˜¯ä¸ºç©º)ã€‚ä¸€æ—¦åˆ›å»ºï¼Œä¸€ä¸ª worker å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°åˆ›å»ºå®ƒçš„ JavaScript ä»£ç ï¼Œé€šè¿‡å°†æ¶ˆæ¯å‘å¸ƒåˆ°è¯¥ä»£ç æŒ‡å®šçš„äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚æœ¬æ–‡æä¾›äº†æœ‰å…³ä½¿ç”¨ Web Worker çš„è¯¦ç»†ä»‹ç»ã€‚")]),an,n("ol",null,[n("li",null,[n("p",null,[s("ä¸€ä¸ª worker æ˜¯ä½¿ç”¨ä¸€ä¸ªæ„é€ å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ (e.g. "),n("a",tn,[en,a(t)]),s(") è¿è¡Œä¸€ä¸ªå‘½åçš„ JavaScript æ–‡ä»¶ - è¿™ä¸ªæ–‡ä»¶åŒ…å«å°†åœ¨å·¥ä½œçº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç ; workers è¿è¡Œåœ¨å¦ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸åŒäºå½“å‰çš„"),n("a",pn,[on,a(t)]),s(". å› æ­¤ï¼Œåœ¨ "),n("a",cn,[ln,a(t)]),s(" å†…é€šè¿‡ "),n("a",un,[rn,a(t)]),s("è·å–å…¨å±€ä½œç”¨åŸŸ å°†è¿”å›é”™è¯¯ã€‚"),dn,kn,s("å…³é”®å­—")])]),vn]),mn,n("p",null,[s("æœ€æµè¡Œçš„æ˜¯â€œApp Shellâ€æ¦‚å¿µï¼Œå®ƒå®Œå…¨æŒ‰ç…§ä¸Šè¿°æ–¹å¼æ··ç”¨ SSR å’Œ CSRï¼›æ­¤å¤–è¿˜éµå¾ªâ€œç¦»çº¿ä¼˜å…ˆâ€æ–¹æ³•ï¼Œè¿™ä¸ªæˆ‘ä»¬å°†åœ¨åç»­æ–‡ç« ä¸­è¯¦ç»†è§£é‡Šï¼Œä¹Ÿä¼šåœ¨ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬è¿˜ä¼šç®€è¦æåŠå¦ä¸€ç§æ¶‰åŠ"),n("a",bn,[s("Streams API"),a(t)]),s("çš„æ–°æ–¹æ³•")]),hn,n("p",null,[s("ä¸ºäº†ä½¿åº”ç”¨ç¦»çº¿è¿è¡Œï¼Œä½ å¿…é¡»ä½¿ç”¨ "),n("a",gn,[s("Service Worker API"),a(t)]),s(" æ¥ç¦»çº¿å­˜å‚¨èµ„æºï¼Œå¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ "),n("a",fn,[s("Web Storage"),a(t)]),s(" æˆ– "),n("a",_n,[s("IndexedDB"),a(t)]),s(" æ¥å­˜å‚¨å…¶æ•°æ®ã€‚")]),yn,n("p",null,[n("u",null,[s("åœ¨ Service Worker ä¸­ä½¿ç”¨ "),n("a",wn,[s("Web Storage"),a(t)]),s(" å°†ä¸ä¼šæœ‰æ•ˆæœï¼Œæ‰€ä»¥ä½¿ç”¨ Cache API ä½œä¸ºæ›¿ä»£ã€‚")])]),n("p",null,[s("å…¨å±€çš„ "),qn,s(" åªè¯»å±æ€§è¿”å›ä¸å½“å‰ä¸Šä¸‹æ–‡ç´§å¯†ç›¸å…³çš„ "),n("a",xn,[In,a(t)]),s(" å¯¹è±¡ã€‚æ­¤å¯¹è±¡æ¿€æ´»äº†è¯¸å¦‚å­˜å‚¨ç”¨äºç¦»çº¿ä½¿ç”¨çš„èµ„æºï¼Œå¹¶ç”Ÿæˆå¯¹è¯·æ±‚çš„è‡ªå®šä¹‰å“åº”ç­‰åŠŸèƒ½ã€‚")]),n("p",null,[n("a",Cn,[Wn,a(t)])]),n("p",null,[s("è¿”å›ä¸€ä¸ª "),n("a",jn,[Pn,a(t)]),s(" ï¼Œresolve ä¸ºåŒ¹é… "),An,s(" ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ cacheï¼‰çš„ "),n("a",Sn,[zn,a(t)]),s(" å¯¹è±¡")]),n("p",null,[n("a",Nn,[On,a(t)])]),n("p",null,[s("æŸ¥æ‰¾åŒ¹é… "),Mn,s(" çš„ "),n("a",En,[Rn,a(t)]),s(" å¯¹è±¡ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™åˆ é™¤ "),n("a",Dn,[Bn,a(t)]),s(" å¯¹è±¡å¹¶è¿”å›ä¸€ä¸ª resolve ä¸º true çš„ "),n("a",Ln,[Tn,a(t)]),s(" ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ° "),n("a",Vn,[Un,a(t)]),s(" å¯¹è±¡ï¼Œåˆ™è¿”å› "),Gn,s(".")]),n("p",null,[n("a",Fn,[Hn,a(t)])]),n("p",null,[s("è¿”å›ä¸€ä¸ª "),n("a",Jn,[Kn,a(t)]),s(" ï¼Œå®ƒå°†ä½¿ç”¨ä¸€ä¸ªåŒ…å«ä¸ "),n("a",Yn,[Xn,a(t)]),s(" è¿½è¸ªçš„æ‰€æœ‰å‘½å "),n("a",$n,[Qn,a(t)]),s(" å¯¹è±¡å¯¹åº”å­—ç¬¦ä¸²çš„æ•°ç»„æ¥ resolve. ä½¿ç”¨è¯¥æ–¹æ³•è¿­ä»£æ‰€æœ‰ "),n("a",Zn,[ns,a(t)]),s(" å¯¹è±¡çš„åˆ—è¡¨ã€‚")]),n("p",null,[n("a",ss,[as,a(t)])]),n("p",null,[s("æ£€æŸ¥ç»™å®šçš„ "),n("a",ts,[es,a(t)]),s(" æ˜¯å¦æ˜¯ "),n("a",ps,[os,a(t)]),s(" å¯¹è±¡è·Ÿè¸ªçš„ä»»ä½• "),n("a",cs,[is,a(t)]),s(" å¯¹è±¡çš„é”®ï¼Œå¹¶è¿”å›ä¸€ä¸ª resolve ä¸ºè¯¥åŒ¹é…çš„ "),n("a",ls,[us,a(t)]),s(" .")]),n("p",null,[n("a",rs,[ds,a(t)])]),n("p",null,[s("å¦‚æœå­˜åœ¨ä¸ "),ks,s(" åŒ¹é…çš„ "),n("a",vs,[ms,a(t)]),s(" å¯¹è±¡ï¼Œåˆ™è¿”å›ä¸€ä¸ª resolve ä¸º true çš„ "),n("a",bs,[hs,a(t)]),s(" .")]),gs,n("p",null,[s("ä¸ºäº†èƒ½å¤Ÿæ¥æ”¶åˆ°æ¨é€çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Service Worker æ–‡ä»¶é‡Œé¢ç›‘å¬ "),n("a",fs,[_s,s(" (en-US)"),a(t)]),s(" äº‹ä»¶ï¼šè¿™äº›æ•°æ®è¢«æ¥æ”¶åï¼Œå°†ä¼šä»¥é€šçŸ¥çš„æ–¹å¼ç«‹åˆ»å±•ç°ç»™ç”¨æˆ·ï¼Œä¾‹å¦‚æé†’ç”¨æˆ·ä¸€äº›å¾…åŠäº‹é¡¹ï¼Œæˆ–è€…è®©ç”¨æˆ·çŸ¥é“ App æœ‰äº†æ–°å†…å®¹ã€‚")]),ys,n("p",null,[n("a",ws,[qs,a(t)]),s(" æ¥å£æä¾›äº†ç›‘è§†å¯¹ DOM æ ‘æ‰€åšæ›´æ”¹çš„èƒ½åŠ›ã€‚å®ƒè¢«è®¾è®¡ä¸ºæ—§çš„ Mutation Events åŠŸèƒ½çš„æ›¿ä»£å“ï¼Œè¯¥åŠŸèƒ½æ˜¯ DOM3 Events è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚")]),xs,n("ol",null,[Is,n("li",null,[n("p",null,[s("å›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯æè¿°æ‰€æœ‰è¢«è§¦å‘æ”¹åŠ¨çš„ "),n("a",Cs,[Ws,a(t)]),s(" å¯¹è±¡æ•°ç»„ï¼Œå¦ä¸€ä¸ªæ˜¯è°ƒç”¨è¯¥å‡½æ•°çš„ "),js,s(" å¯¹è±¡ã€‚")])]),n("li",null,[Ps,n("ol",null,[n("li",null,[n("a",As,[Ss,a(t)]),s("é˜»æ­¢ "),zs,s(" å®ä¾‹ç»§ç»­æ¥æ”¶çš„é€šçŸ¥ï¼Œç›´åˆ°å†æ¬¡è°ƒç”¨å…¶ "),n("a",Ns,[Os,a(t)]),s(" æ–¹æ³•ï¼Œè¯¥è§‚å¯Ÿè€…å¯¹è±¡åŒ…å«çš„å›è°ƒå‡½æ•°éƒ½ä¸ä¼šå†è¢«è°ƒç”¨ã€‚")]),n("li",null,[n("a",Ms,[Es,a(t)]),s("é…ç½® "),Rs,s(" åœ¨ DOM æ›´æ”¹åŒ¹é…ç»™å®šé€‰é¡¹æ—¶ï¼Œé€šè¿‡å…¶å›è°ƒå‡½æ•°å¼€å§‹æ¥æ”¶é€šçŸ¥ã€‚")]),n("li",null,[n("a",Ds,[Bs,a(t)]),s("ä» MutationObserver çš„é€šçŸ¥é˜Ÿåˆ—ä¸­åˆ é™¤æ‰€æœ‰å¾…å¤„ç†çš„é€šçŸ¥ï¼Œå¹¶å°†å®ƒä»¬è¿”å›åˆ° "),n("a",Ls,[Ts,a(t)]),s(" å¯¹è±¡çš„æ–° "),n("a",Vs,[Us,a(t)]),s(" ä¸­ã€‚")])])]),Gs]),Fs,Hs,Js,n("p",null,[s("ç”¨äºåœ¨å®¢æˆ·ç«¯å­˜å‚¨å¤§é‡çš„ç»“æ„åŒ–æ•°æ®ï¼ˆä¹ŸåŒ…æ‹¬æ–‡ä»¶/äºŒè¿›åˆ¶å¤§å‹å¯¹è±¡ï¼ˆblobsï¼‰ï¼‰ã€‚è¯¥ API ä½¿ç”¨ç´¢å¼•å®ç°å¯¹æ•°æ®çš„é«˜æ€§èƒ½æœç´¢ã€‚è™½ç„¶ "),n("a",Ks,[s("Web Storage"),a(t)]),s(" åœ¨å­˜å‚¨è¾ƒå°‘é‡çš„æ•°æ®å¾ˆæœ‰ç”¨ï¼Œä½†å¯¹äºå­˜å‚¨æ›´å¤§é‡çš„ç»“æ„åŒ–æ•°æ®æ¥è¯´åŠ›ä¸ä»å¿ƒã€‚")]),Ys,n("div",Xs,[$s,n("p",null,[n("strong",null,[s("è¿”å›çš„å¯¹è±¡ä¸ä»å…ƒç´ çš„ "),n("a",Qs,[Zs,a(t)]),s(" å±æ€§è¿”å›çš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„ç±»å‹;ç„¶è€Œï¼Œä¸¤ä¸ªå¯¹è±¡å…·æœ‰ä¸åŒçš„ç›®çš„ã€‚ä»"),na,s("è¿”å›çš„å¯¹è±¡æ˜¯åªè¯»çš„ï¼Œå¯ä»¥ç”¨äºæ£€æŸ¥å…ƒç´ çš„æ ·å¼ï¼ˆåŒ…æ‹¬ç”±ä¸€ä¸ª"),sa,s("å…ƒç´ æˆ–ä¸€ä¸ªå¤–éƒ¨æ ·å¼è¡¨è®¾ç½®çš„é‚£äº›æ ·å¼ï¼‰ã€‚"),aa,s("å¯¹è±¡åº”ç”¨äºåœ¨ç‰¹å®šå…ƒç´ ä¸Šè®¾ç½®æ ·å¼ã€‚")])])]),a(o)])}const ca=c(r,[["render",ta],["__file","å¿…ä¼šAPIs.html.vue"]]);export{ca as default};
