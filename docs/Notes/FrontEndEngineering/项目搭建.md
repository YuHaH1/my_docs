---
lang: zh-CN
title: 项目初始化
description: 关键功能
collapsible: true
---
# 项目初始化

常用工程化工具

* eslint
* prettier
* husky
* lint-staged
* commitlint
* commitizen





## 前端项目基建

### 安装项目依赖

~~~shell
pnpm create vite [name] --template react-swc-ts
pnpm install 
# 安装eslint 
# 这个脚手架帮我们安装过了 pnpm add -D eslint @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-plugin-react-hooks eslint-plugin-react-refres
# 安装prettier onchange自动检测代码并格式化
pnpm add -D prettier onchange 
# 对改变的文件做eslint
pnpm add -D lint-staged
# eslint-config-prettier关闭可能干扰prettier的eslint规则 eslint-plugin-prettier将prettier规则转为eslint规则
pnpm add -D eslint-config-prettier eslint-plugin-prettier

# node类型库，vite.config.ts中需要用path模块
pnpm add -D @types/node 
# 状态管理库
pnpm install zustand
# 自动导包
pnpm add -D unplugin-auto-import
# 请求
pnpm add axios
# 路由
pnpm install react-router-dom 
# git提交规范
pnpm add -D husky @commitlint/cli @commitlint/config-conventional
# 统一包管理器的使用
pnpm add -D  only-allow

# UI组件
pnpm add antd --save
# 清除默认样式
pnpm add @unocss/reset
# unocss集成
pnpm add -D unocss  @unocss/preset-attributify  @unocss/eslint-config @unocss/preset-uno
# icon图标
pnpm add -D @iconify/json @unocss/preset-icons
~~~

### 清除默认样式

main.tsx

~~~tsx
import 'normalize.css/normalize.css';
~~~



### eslint和prettier配置

`.eslintrc.cjs`配置（pnpm脚手架帮我们创建好了）

~~~js
module.exports = {
  // 该配置项主要用于指示此.eslintrc文件是Eslint在项目内使用的根级别文件，并且 ESLint 不应在该目录之外搜索配置文件
  root: true,
  env: { browser: true, es2020: true },
  // eslint:recommended ：该配置集是 ESLint 内置的“推荐”，它打开一组小的、合理的规则，用于检查众所周知的最佳实践
  // @typescript-eslint/recommended：该配置集是typescript-eslint的推荐，它与eslint:recommended相似，但它启用了特定于ts的规则
  // @typescript-eslint/eslint-recommended ：该配置集禁用 eslint:recommended 配置集中已经由 typeScript 处理的规则，防止eslint和typescript之间的冲突。
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
    'prettier'
  ],
  ignorePatterns: ['dist', '.eslintrc.cjs'],
  // 默认情况下，Eslint使用其内置的 Espree 解析器，该解析器与标准 JavaScript 运行时和版本兼容，
  //而我们需要将ts代码解析为eslint兼容的AST，所以此处我们使用 @typescript-eslint / parser。
  parser: '@typescript-eslint/parser',
  plugins: [
    'react-refresh',
    'prettier'
  ],
  rules: {
    "prettier/prettier": "error", // 打开prettier插件提供的规则，该插件从 ESLint 内运行 Prettier
    // 关闭这两个 ESLint 核心规则，这两个规则和prettier插件一起使用会出现问题，具体可参阅
    // https://github.com/prettier/eslint-plugin-prettier/blob/master/README.md#arrow-body-style-and-prefer-arrow-callback-issue
    "arrow-body-style": "off",
    "prefer-arrow-callback": "off",
    "@typescript-eslint/no-explicit-any": "off",
    'react-refresh/only-export-components': [
      'warn',
      { allowConstantExport: true },
    ],
  },
}
~~~

`.prettierrc.cjs`:[参考文档](https://prettier.io/docs/en/option)

~~~js
module.exports = {
  // 一行最多 150 字符
  printWidth: 150,
  // 使用 4 个空格缩进
  tabWidth: 4,
  // 不使用缩进符，而使用空格
  useTabs: false,
  // 行尾需要有分号
  semi: true,
  // 使用单引号
  singleQuote: true,
  // 对象的 key 仅在必要时用引号
  quoteProps: 'as-needed',
  // jsx 不使用单引号，而使用双引号
  jsxSingleQuote: false,
  // 末尾是否需要逗号
  trailingComma: 'es5',
  // 大括号内的首尾需要空格
  bracketSpacing: true,
  // jsx 标签的反尖括号需要换行
  jsxBracketSameLine: false,
  // 箭头函数，只有一个参数的时候，也需要括号
  arrowParens: 'always',
  // 每个文件格式化的范围是文件的全部内容
  rangeStart: 0,
  rangeEnd: Infinity,
  // 不需要写文件开头的 @prettier
  requirePragma: false,
  // 不需要自动在文件开头插入 @prettier
  insertPragma: false,
  // 使用默认的折行标准
  proseWrap: 'preserve',
  // 换行符使用 lf
  endOfLine: 'lf',
};

~~~

`packge.json`

~~~json
"scripts": {
     "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0 --fix",
    "format": "prettier --config .prettierrc.cjs --write ./src",
    "format-watch": "onchange -d 1000 '**/*' -- prettier --config .prettierrc.cjs --write {{changed}}"
},
~~~



### husky-git提交规范

一. 启用git hook

在`package.json`的script中配置脚本

~~~json
 "scripts": {
    "prepare":"husky install",
  }
~~~

然后运行该脚本启用githook

二.创建git提交前的hooks命令

~~~shell
npx husky add .husky/pre-commit "pnpm lint"
~~~

三.创建`.commitlintrc.json`文件

~~~json
{
    "extends":["@commitlint/config-conventional"],
    "rules":{
        "scope-empty":[2,"never"]
    }
}
~~~

(自定义commitlint规则)

~~~js
module.exports = {
    extends: ['@commitlint/config-conventional'],
    rules: {
        'type-enum': [
            2,
            'always',
            [
                'feat',
                'fix',
                'docs',
                'style',
                'refactor',
                'perf',
                'test',
                'chore',
                'revert',
                'build'
            ]
        ],
        'type-case': [0],
        'type-empty': [0],
        'scope-empty': [0],
        'scope-case': [0],
        'subject-full-stop': [0, 'never'],
        'subject-case': [0, 'never'],
        'header-max-length': [0, 'always', 72],

    }
}
~~~



四.创建husky验证钩子

~~~shell
 npx husky add .husky/commit-msg 'npx --no -- commitlint --edit "$1"'
~~~





### 自动导包的配置

 `vite.config.ts`

~~~ts
// vite.config.ts
import { defineConfig } from 'vite'
import AutoImport from 'unplugin-auto-import/vite'
export default defineConfig({
  plugins: [
    AutoImport({
      include: [
        /\.[tj]sx?$/, // .ts, .tsx, .js, .jsx
      ],
      dirs: [
        './src/store/**'
      ],
      imports: [
        'react',
        {
          'axios': [
            // default imports
            ['default', 'axios'], // import { default as axios } from 'axios',
          ],
        },
      ],
      dts: './auto-imports.d.ts',
      eslintrc: {
        enabled: false, // Default `false`
        filepath: './.eslintrc-auto-import.json', // Default `./.eslintrc-auto-import.json`
        globalsPropValue: true, // Default `true`, (true | false | 'readonly' | 'readable' | 'writable' | 'writeable')
      },
    })
  ],
})
~~~

`tsconfig.json`

~~~json
{
    "include": ["src", "auto-imports.d.ts"],
}

~~~



### .vscode配置

1. 创建`.vscode`文件夹

2. 创建`extensions.json`文件，该文件为推荐插件安装

   ~~~json
   {
       "recommendations": ["esbenp.prettier-vscode", "dbaeumer.vscode-eslint"]
   }
   
   ~~~

   

3. 创建`settings.json`文件，该文件为推荐该项目的setting配置

   ~~~json
   {
       "typescript.tsdk": "node_modules/typescript/lib",
       "editor.formatOnSave": true,
       "editor.defaultFormatter": "esbenp.prettier-vscode",
       "editor.codeActionsOnSave": {
           "source.organizeImports": true,
           "source.fixAll.eslint": true
       },
       "editor.formatOnSaveMode": "file",
       "editor.formatOnType": true,
       "editor.formatOnPaste": false,
       "[typescript]": {
           "editor.formatOnSave": true,
           "editor.defaultFormatter": "esbenp.prettier-vscode",
           "editor.codeActionsOnSave": {
               "source.organizeImports": true,
               "source.fixAll.eslint": true
           },
           "editor.formatOnSaveMode": "file",
           "editor.formatOnType": true,
           "editor.formatOnPaste": false
       }
   }
   
   ~~~

   

### 配置路径别名

` vite.config.ts`

~~~ts
// vite.config.ts
import { defineConfig } from 'vite'
import { resolve } from 'path'
export default defineConfig({
  resolve: {
    alias: {
      '@': resolve(__dirname, './src')
    }
  },
})
~~~

`tsconfig.json`

~~~json
//tsconfig.json
{
    "compilerOptions": {
        "baseUrl": ".",
        "paths": {
            "@/*": ["src/*"]
        }
    },
}

~~~

### 统一包管理工具

写一个判断脚本

~~~js
if (!/pnpm/.test(process.env.npm_execpath || '')) {
    console.warn('you must use pnpm as the package manager')
    process.exit(1)
}
~~~

在package.json中配置install钩子执行该脚本

~~~json
"sciprt":{
    "preinstall": "node preinstall.js"
    //或者下面这样
    "preinstall": "npx only-allow pnpm",
}
~~~



### Unocss配置

uno.config.ts

~~~ts
// uno.config.ts
import presetAttributify from '@unocss/preset-attributify';
import presetUno from '@unocss/preset-uno';
import { defineConfig } from 'unocss';

export default defineConfig({
    presets: [presetAttributify(), presetUno()],
});

~~~

eslint.rc

~~~json
{
  "extends": [
    "@unocss"
  ]
}
~~~



~~~json
  "scripts": {
    "commitlint":"commitlint --config commitlint.config.cjs -e -V"
  },
~~~



### 生产环境优化



#### 代码分割和代码压缩

[代码压缩](https://github.com/nonzzz/vite-plugin-compression)

[代码分割](https://github.com/sanyuan0704/vite-plugin-chunk-split)

vite项目

~~~shell
pnpm install'vite-plugin-compression2'
~~~

~~~js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { chunkSplitPlugin } from 'vite-plugin-chunk-split'

import { compression } from 'vite-plugin-compression2'
// https://vitejs.dev/config/
export default defineConfig({

  plugins: [vue(),
  compression({ exclude: [/\.html$/] }),
  chunkSplitPlugin({
    strategy: 'single-vendor',
    customSplitting: {

      'vue-vendor': ['vue'],
      'vue-utils': ['pinia'],
      // Any file that includes `utils` in src dir will be bundled in the `utils` chunk
      'utils': [/src\/utils/]
    }
  })],
})

~~~



## Nest项目基建

### 1.安装项目依赖

~~~shell
nest new [project] -p pnpm
# 环境变量配置
pnpm install js-yaml @nestjs/config  cross-env
pnpm add -D @types/js-yaml
# 安装orm，数据库
pnpm install --save @nestjs/typeorm typeorm mysql2
~~~











## 问题

### 解决报Delete `␍`eslint(prettier/prettier)问题

~~~shell
 git config --global core.autocrlf false
 git config --global core.autocrlf input
~~~





<CommentService/>