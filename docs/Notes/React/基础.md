---
wlang: zh-CN
title: åŸºç¡€
description: å…³é”®åŠŸèƒ½
collapsible: true
---
# åŸºç¡€



## Reactå“²å­¦

èµ„æºåŠ è½½çš„ç“¶é¢ˆæ˜¯ä»€ä¹ˆï¼Ÿ

****

èµ„æºåŠ è½½æ–¹é¢

* ä¸€æ¬¡è¯·æ±‚å¤ªå¤šèµ„æº
* ç½‘ç»œè¯·æ±‚æ…¢
* èµ„æºåŠ è½½å¤±è´¥

è§£å†³æ–¹æ¡ˆ

* `React.lazy`
* `React.Suspense`
* `ErrorBoundary`

****

æµè§ˆå™¨çº¿ç¨‹æ‰§è¡Œæ–¹é¢

* jsæ‰§è¡Œï¼ˆå¦‚æœjsæ‰§è¡Œè¶…è¿‡16mså³è¶…è¿‡äº†æ¸²æŸ“å¸§ï¼Œå°±æ²¡æœ‰æ—¶é—´å¸ƒå±€å’Œæ ·å¼ç»˜åˆ¶ï¼‰
* æµè§ˆå™¨è®¡ç®—æ ·å¼å¸ƒå±€
* UIç»˜åˆ¶

è§£å†³æ–¹æ¡ˆ

* å¼‚æ­¥æ›´æ–°
* æ—¶é—´åˆ‡ç‰‡
* `React Fiber`

## Reactæ›´æ–°æµç¨‹

![](/React/react_update.png)

reactæ›´æ–°ä¾èµ–ä¸‰å¤§éƒ¨åˆ†

1. Schedulerè°ƒåº¦å™¨
   * ç»´æŠ¤æ—¶é—´åˆ‡ç‰‡-requestidleCallback
   * ä¼˜å…ˆçº§è°ƒåº¦
   * æµè§ˆå™¨ä»»åŠ¡è°ƒåº¦
2. Reconcileråè°ƒå™¨
   * jsxè½¬æˆFiber
   * Fiberæ ‘æ¯”å¯¹ï¼ˆåŒç¼“å­˜ï¼‰
   * ç¡®è®¤æœ¬æ¬¡æ›´æ–°Fiber
3. Rendereræ¸²æŸ“å™¨
   * æ¸²æŸ“ç”¨äºç®¡ç†ä¸€ä¸ªReactæ ‘
   * æ ¹æ®åº•å±‚å¹³å°è¿›è¡Œä¸åŒè°ƒç”¨



## Reactäº‹ä»¶

1.reactå¤„ç†äº‹ä»¶æ—¶å°†åŒ¹é…çš„`onXX`äº‹ä»¶ç»‘å®šåˆ°å…ƒç´ èº«ä¸Šï¼Œåœ¨æ ¹å…ƒç´ #rootèº«ä¸Šè¿›è¡Œäº‹ä»¶å§”æ‰˜

2.é€šè¿‡e.pathèƒ½è·å–äº‹ä»¶æ•è·ã€å†’æ³¡çš„è·¯å¾„

~~~js
root.addEventListener('click',(e)=>{
    const path = e.path
    [...path].resverse().forEach(e=>{
        const handler = ele.onXXX
        handler && handler()
    })
},true)// æ•è·
 
root.addEventListener('click',(e)=>{
    const path = e.path
    path.forEach(e=>{
        const handler = ele.onXXX
        handler && handler()
    })
},false)
~~~



## Hook

[æ–‡æ¡£åœ°å€](https://react.dev/reference/react)

å‡½æ•°ç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯å‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå…¨æ–°çš„ç§æœ‰ä¸Šä¸‹æ–‡

![](/React/hooks.png)

### useState

å‡½æ•°ç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯å‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå…¨æ–°çš„ç§æœ‰ä¸Šä¸‹æ–‡ï¼Œé‡æ–°æ‰§è¡Œå‡½æ•°é‚£ä¹ˆå¦‚ä½•èƒ½ä¿è¯useStateè·å–æœ€æ–°çš„çŠ¶æ€å€¼ï¼Ÿ

åˆ©ç”¨é—­åŒ…ï¼Œç”¨ä¸€ä¸ªå˜é‡ä¿å­˜æœ€æ–°ä¿®æ”¹çš„å€¼ï¼Œæ¯æ¬¡è°ƒç”¨setStateï¼Œéƒ½ä¼šæ›´æ–°è¿™ä¸ªå˜é‡

å®ç°æ–¹å¼ç±»ä¼¼äºä¸‹é¢

~~~js
let state ;
function useState(initialValue){
	if(typeof state === 'undefined')state = initialValue
    const setState = function setState(value){
        state = value
    }
    return [state,setState]
}
~~~

æ€è€ƒé—®é¢˜,ä¸‹é¢çš„numè¾“å‡ºæ˜¯0ï¼Œæ˜¯å› ä¸ºå®šæ—¶å™¨è®¿é—®çš„numçš„ä½œç”¨åŸŸä»æ˜¯å½“å‰æ‰€åœ¨ä½œç”¨åŸŸ

~~~jsx
function App() {
  const [state, setState] = useState(0)
  const handler = () => {
    setState(state+1)
    setTimeout(() => {
      console.log(state)
    }, 2000);
  }
  return (
    <div className="App">
      {state}
      <button onClick={handler}>12312312</button>
    </div>
  );
}
è¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œ
0
1
2
~~~

::: tip

å¦‚æœstateåˆå§‹å€¼éœ€è¦ä¸€äº›è®¡ç®—å¾—åˆ°ï¼Œé‚£ä¹ˆä¸è¦æ”¾åˆ°ç»„ä»¶å†…éƒ¨ï¼Œå› ä¸ºæ¯æ¬¡setStateéƒ½ä¼šé‡æ–°æ‰§è¡Œã€‚æˆ‘ä»¬è¿™æ ·ä½¿ç”¨å¯ä»¥é¿å…ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€`useState(()=>{return initState})`

:::

#### setstate

ä½¿ç”¨setstateå¦‚æœæ›´æ”¹çš„æ˜¯å¯¹è±¡è¦æ›´æ”¹çš„æ˜¯æ•´ä¸ªå¯¹è±¡

~~~js
// âœ… Replace state with a new object
setForm({
  ...form,
  firstName: 'Taylor'
});
~~~



å¯¹äºsetStateå‡½æ•°æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è®¿é—®ä¸Šä¸€æ¬¡ç»“æœä¸èƒ½ç›´æ¥ä½¿ç”¨stateï¼Œè¦ç”¨å‡½æ•°ã€‚è¿™æ˜¯å› ä¸ºè°ƒç”¨setå‡½æ•°ä¸ä¼šæ›´æ–°å·²ç»è¿è¡Œçš„ä»£ç ä¸­çš„ageçŠ¶æ€å˜é‡ã€‚

~~~js
function handleClick() {
  setAge(age + 1); // setAge(42 + 1)
  setAge(age + 1); // setAge(42 + 1)
  setAge(age + 1); // setAge(42 + 1)
}
function handleClick() {
  setAge(a => a + 1); // setAge(42 => 43)
  setAge(a => a + 1); // setAge(43 => 44)
  setAge(a => a + 1); // setAge(44 => 45)
}
~~~

**åŒæ­¥å¼‚æ­¥é—®é¢˜setState**

react16ä¸­åªæœ‰æ”¾åœ¨åˆæˆäº‹ä»¶/å‘¨æœŸå‡½æ•°ä¸­çš„æ˜¯å¼‚æ­¥å—ï¼Œå…¶ä»–çš„æ˜¯åŒæ­¥ï¼ˆå®šæ—¶å™¨ï¼‰ã€‚react18åé»˜è®¤å¼‚æ­¥æ–¹å¼å»æ›´æ–°æ•°æ®

~~~js
import {flushSync} from 'react-dom'
// ä¼šåŒæ­¥æ›´æ–°ä¼ å…¥çš„å›è°ƒ
const Test = ()=>{
    const [x,setX] = useState(10),
          [y,setY] = useState(10);
    const handler = ()=>{
        flushSync(()=>{
            setY(y+1)
        })
        setX(x+1)
    }
}
~~~



### useEffect

åŠŸèƒ½-ã€‹

* å‡½æ•°ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°
  * å¦‚æœç¬¬äºŒä¸ªä¾èµ–å‚æ•°ä¸ºundefinedï¼Œæ‰§è¡Œæ—¶æœºï¼Œåœ¨æ¯æ¬¡æ¸²æŸ“åä¼šæ‰§è¡Œ
  * å¦‚æœä¾èµ–å‚æ•°ä¸º[]ï¼Œæ‰§è¡Œæ—¶æœºåªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åæ›´æ–°
  * å¦‚æœä¾èµ–æŒ‡å®šäº†[xxx]ï¼Œé™¤äº†é¦–æ¬¡æ‰§è¡Œè¿˜ä¼šåœ¨ä¾èµ–çŠ¶æ€å€¼å‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œ
  * å¦‚æœuseEffecté‡Œçš„å›è°ƒè¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›çš„å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œï¼Œå¦‚æœç»„ä»¶æ›´æ–°ä¼šæŠŠä¸Šä¸€æ¬¡å‡½æ•°æ‰§è¡Œ
* ç›¸å½“äºvueçš„computedï¼Œå½“ä¾èµ–å˜åŒ–æ‰§è¡Œå‡½æ•°

~~~js
import { useEffect } from 'react';
useEffect(setup, dependencies?)
          
const [x,setX] = useState(10)  
useEffect(()=>{
          
})                 
useEffect(()=>{
          
},[])     
useEffect(()=>{
          
},[x])       
useEffect(()=>{
    return ()=>{
        console.log(x)//è¿™é‡Œçš„ä¸Šä¸‹æ–‡è¿˜æ˜¯ä¸æ˜¯æœ€æ–°çš„
    }
})
~~~

::: tip

â‘ useEffectæ˜¯ä¸€ä¸ªé’©å­ï¼Œæ‰€ä»¥ä½ åªèƒ½åœ¨ç»„ä»¶çš„é¡¶å±‚æˆ–è€…ä½ è‡ªå·±çš„é’©å­ä¸Šè°ƒç”¨å®ƒã€‚ä½ ä¸èƒ½åœ¨å¾ªç¯æˆ–æ¡ä»¶ä¸­è°ƒç”¨ã€‚å¦‚æœéœ€è¦ï¼Œæå–ä¸€ä¸ªæ–°ç»„ä»¶å¹¶å°†çŠ¶æ€ç§»åˆ°å…¶ä¸­ã€‚ï¼ˆå› ä¸ºuseEffectçš„å‡½æ•°æ˜¯æŒ‰é¡ºåºæ‰§è¡Œï¼Œ**é¡ºåºæ‰§è¡Œèƒ½å¤Ÿä¿è¯hookçŠ¶æ€çš„æ­£ç¡®**ã€‚ï¼‰

â‘¡å¦‚æœä½ çš„æ•ˆæœä¸æ˜¯ç”±äº¤äº’(æ¯”å¦‚ç‚¹å‡»)å¼•èµ·çš„ï¼ŒReactä¼šè®©æµè§ˆå™¨åœ¨è¿è¡Œä½ çš„æ•ˆæœä¹‹å‰å…ˆç»˜åˆ¶æ›´æ–°çš„å±å¹•ã€‚å¦‚æœä½ çš„æ•ˆæœæ˜¯åœ¨åšä¸€äº›è§†è§‰ä¸Šçš„äº‹æƒ…(ä¾‹å¦‚ï¼Œå®šä½å·¥å…·æç¤º)ï¼Œä¼šæœ‰æ˜æ˜¾çš„å»¶è¿Ÿ(ä¾‹å¦‚ï¼Œé—ªçƒ)æ­¤æ—¶å¯ä»¥ç”¨uselayouteeffectæ›¿æ¢useEffectã€‚å³ä½¿æ‚¨çš„Effectæ˜¯ç”±äº¤äº’(å¦‚ç‚¹å‡»)å¼•èµ·çš„ï¼Œæµè§ˆå™¨ä¹Ÿå¯èƒ½åœ¨å¤„ç†æ‚¨çš„Effectä¸­çš„çŠ¶æ€æ›´æ–°ä¹‹å‰é‡æ–°ç»˜åˆ¶å±å¹•ã€‚é€šå¸¸ï¼Œè¿™å°±æ˜¯ä½ æƒ³è¦çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¿…é¡»é˜»æ­¢æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ï¼Œåˆ™éœ€è¦å°†useEffectæ›¿æ¢ä¸ºuselayouteeffectã€‚

:::

### useLayout

::: warning

uselayouteeffectä¼šå½±å“æ€§èƒ½ã€‚å°½å¯èƒ½ä½¿ç”¨useEffectã€‚uselayouteeffectä¸­çš„ä»£ç å’Œå—å®ƒè°ƒåº¦çš„æ‰€æœ‰çŠ¶æ€æ›´æ–°ä¼šé˜»æ­¢æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ã€‚å½“è¿‡åº¦ä½¿ç”¨æ—¶ï¼Œè¿™ä¼šä½¿ä½ çš„åº”ç”¨å˜æ…¢ã€‚

:::

å½“æˆ‘ä»¬effecté¢‘ç¹æ›´æ”¹ä¸€äº›çŠ¶æ€ï¼Œè€Œè§†å›¾ä¾èµ–è¿™äº›çŠ¶æ€çš„å˜åŒ–ï¼Œé‚£ä¹ˆuseEffectä¼šæœ‰æ˜æ˜¾çš„é—ªçƒç°è±¡ã€‚uselayouteeffectæ˜¯useEffectçš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ä¹‹å‰è§¦å‘ã€‚

ä½¿ç”¨åœºæ™¯ï¼Œèœå•æ å’Œæç¤ºtip





### useRefå’ŒuseImperativeHandle

èƒ½ç”¨propsä¸ç”¨ref

â‘ useRef

**ä½œç”¨ï¼š**

* useRefæ˜¯ä¸€ä¸ªReact Hookï¼Œå®ƒå…è®¸ä½ å¼•ç”¨æ¸²æŸ“æ—¶ä¸éœ€è¦çš„å€¼ã€‚

  * ~~~js
    import { useRef } from 'react';
    
    export default function Counter() {
      let ref = useRef(0);
    
      function handleClick() {
        ref.current = ref.current + 1;
        alert('You clicked ' + ref.current + ' times!');
      }
    
      return (
        <button onClick={handleClick}>
          Click me!
        </button>
      );
    }
    ~~~

  * 

* å¾—åˆ°ç»„ä»¶å®ä¾‹æˆ–è€…å…ƒç´ ï¼Œåœ¨Reactåˆ›å»ºDOMèŠ‚ç‚¹å¹¶å°†å…¶æ”¾åœ¨å±å¹•ä¸Šä¹‹åï¼ŒReactå°†è®¾ç½®refçš„_currentå±æ€§å¯¹è±¡åˆ°è¯¥DOMèŠ‚ç‚¹æˆ–ç»„ä»¶å®ä¾‹ã€‚

  * ~~~js
    import { useRef } from 'react';
    
    export default function Form() {
      const inputRef = useRef(null);
    
      function handleClick() {
        inputRef.current.focus();
      }
      return (
        <>
          <input ref={inputRef} />
          <button onClick={handleClick}>
            Focus the input
          </button>
        </>
      );
    }
    ~~~

  * åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‹¿DOMå…ƒç´ 2ç§æ–¹å¼(è¿™ç§æ–¹å¼æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»ºrefå¯¹è±¡)ï¼ŒuseRefæ€§èƒ½æœ€å¥½

  * ~~~js
    export default function Form() {
      let ref1;
        let ref2 = React.createRef()
    	
      function handleClick() {
        inputRef.current.focus();
      }
      return (
        <>
          <input ref={(e)=>ref1 = e} />
        <input ref={ref2} />
          <button onClick={handleClick}>
            Focus the input
          </button>
        </>
      );
    }
    ~~~

â‘¡useImperativeHandle

ä½¿ç”¨`React.forwardRef`å¯ä»¥è½¬å‘refè®©çˆ¶ç»„ä»¶è·å–å­ç»„ä»¶çš„æŸä¸ªå…ƒç´ ç„¶åé€šè¿‡`useImperativeHandle`å¯ä»¥è·å–åˆ°æŒ‚è½½åˆ°å®ä¾‹ä¸Šçš„å±æ€§å’Œæ–¹æ³•

~~~js
export default function Deom() {
  let childRef = useRef
  function handleClick() {
    inputRef.current.focus();
  }
  return (
    <>
     	<Child ref={childRef}></Child>
    </>
  );
}
const Child = React.forwardRef((props,ref)=>{
    useImperativeHandle(ref,()=>{
        return {//è¿™é‡Œè¿”å›çš„å†…å®¹çˆ¶ç»„ä»¶çš„Reféƒ½èƒ½è®¿é—®åˆ°ï¼Œç±»ä¼¼äºvueå­ç»„ä»¶expose
            childMethod,
        }
    })
    const childMethod = (data)=>{
        console.log('çˆ¶ç»„ä»¶ä¼ å‚',)
    }
    return (
   		<div>
        	å­ç»„ä»¶çš„å…ƒç´ 
        	<p ref={ref}>çˆ¶ç»„ä»¶å¯ä»¥æ‹¿åˆ°å­ç»„ä»¶çš„å…ƒç´ æˆ–ç»„ä»¶</p>
        </div>
    )
})
~~~

ä¾‹å­

~~~js
import { useRef } from 'react';
import MyInput from './MyInput.js';

export default function Form() {
  const ref = useRef(null);

  function handleClick() {
    ref.current.focus();
    // This won't work because the DOM node isn't exposed:
    // ref.current.style.opacity = 0.5;
  }

  return (
    <form>
      <MyInput label="Enter your name:" ref={ref} />
      <button type="button" onClick={handleClick}>
        Edit
      </button>
    </form>
  );
}
// MyInput
import { forwardRef, useRef, useImperativeHandle } from 'react';

const MyInput = forwardRef(function MyInput(props, ref) {
  const inputRef = useRef(null);

  useImperativeHandle(ref, () => {
    return {
      focus() {
        inputRef.current.focus();
      },
      scrollIntoView() {
        inputRef.current.scrollIntoView();
      },
    };
  }, []);

  return <input {...props} ref={inputRef} />;
});

export default MyInput;

~~~



### useMemoå’ŒuseCallback

React.memoä¼šæ¯”è¾ƒä¼ å…¥çš„propsæ˜¯å¦å‘ç”Ÿå˜åŒ–å¦‚æœæ²¡æœ‰å˜åŒ–åˆ™ä¸ä¼šé‡æ–°æ¸²æŸ“å½“å‰ç»„ä»¶ã€‚å› æ­¤useMemoå’ŒuseCallbackç»å¸¸é…åˆmemoä½¿ç”¨æ¥é˜²æ­¢ä¸å¿…è¦çš„æ›´æ–°ã€‚

â‘ useMemo

ä½œç”¨ï¼š

* é¿å…é‡æ–°è®¡ç®—
* é¿å…ç»„ä»¶é‡æ–°æ¸²æŸ“åˆ©ç”¨useMemoå’Œmemo

useMemoæ˜¯ä¸€ä¸ªReact Hookï¼Œå®ƒå¯ä»¥ç¼“å­˜è®¡ç®—ç»“æœã€‚

å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä¾èµ–çŠ¶æ€æ²¡å‘ç”Ÿæ”¹å˜ï¼Œä¸é‡å¤æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨`useMemo`

ä¾‹å¦‚

~~~js
import { memo } from 'react';

const List = memo(function List({ items }) {
  // ...
});
// çˆ¶ç»„ä»¶
export default function TodoList({ todos, tab, theme }) {
  // Every time the theme changes, this will be a different array...
  const visibleTodos = filterTodos(todos, tab);
  return (
    <div className={theme}>
      {/* ç”±äºpropsæ¯æ¬¡éƒ½æ˜¯æ–°çš„visibleTodosæ•°ç»„ï¼Œå› æ­¤æ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°Listç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ */}
      <List items={visibleTodos} />
    </div>
  );
}
// ä¼˜åŒ–-ã€‹ã€‹
export default function TodoList({ todos, tab, theme }) {
  // Tell React to cache your calculation between re-renders...
  const visibleTodos = useMemo(
    () => filterTodos(todos, tab),
    [todos, tab] // ...so as long as these dependencies don't change...
  );
  return (
    <div className={theme}>
      {/* ...List will receive the same props and can skip re-rendering */}
      <List items={visibleTodos} />
    </div>
  );
}
~~~



â‘¡useCallback

ç”±äºæ¯æ¬¡æ¸²æŸ“å‡½æ•°ç»„ä»¶éƒ½ä¼šé‡æ–°æ‰§è¡Œï¼Œå› æ­¤å†…éƒ¨çš„å‡½æ•°ä¹Ÿä¼šé‡æ–°åˆ›å»ºï¼Œä½†æ˜¯å¤§å¤šæ—¶å€™æˆ‘ä»¬å†…éƒ¨å®šä¹‰çš„å‡½æ•°ä¸éœ€è¦é‡æ–°åˆ›å»ºï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°ã€‚

~~~js
import { useCallback } from 'react';

function ProductPage({ productId, referrer, theme }) {
  // Every time the theme changes, this will be a different function...
  function handleSubmit(orderDetails) {
    post('/product/' + productId + '/buy', {
      referrer,
      orderDetails,
    });
  }
  
  return (
    <div className={theme}>
      {/* æ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°éƒ½ä¼šé‡æ–°åˆ›å»ºhandleSubmitï¼Œå› æ­¤propsæ°¸è¿œéƒ½ä¸ä¼šä¸€æ ·ï¼Œå­ç»„ä»¶å°±ä¼šä¸€ç›´é‡æ–°åˆ›å»º*/}
      <ShippingForm onSubmit={handleSubmit} />
    </div>
  );
}

// ä¼˜åŒ–-ã€‹ã€‹
function ProductPage({ productId, referrer, theme }) {
  const handleSubmit = useCallback((orderDetails) => {
    post('/product/' + productId + '/buy', {
      referrer,
      orderDetails,
    });
  }, [productId, referrer]);
   return (
    <div className={theme}>
      {/* å½“productIdå’Œreferrerä¸å˜ï¼ŒhandleSubmitå°±ä¸å˜ï¼Œå­ç»„ä»¶æ”¶åˆ°ç›¸åŒçš„propså°±ä¸ä¼šé‡æ–°æ¸²æŸ“ */}
      <ShippingForm onSubmit={handleSubmit} />
    </div>
  );   
}    
~~~

::: tip

å¦‚æœæˆ‘ä»¬çš„ä¾èµ–é¡¹æ˜¯ä¹‹å‰çš„Stateçš„å€¼ï¼Œæˆ‘ä»¬ä¸å¿…æ”¶é›†çŠ¶æ€ä½œä¸ºä¾èµ–

~~~js
function TodoList() {
  const [todos, setTodos] = useState([]);

  const handleAddTodo = useCallback((text) => {
    const newTodo = { id: nextId++, text };
    setTodos(todos => [...todos, newTodo]);
  }, []); // âœ… No need for the todos dependency
// ...
}
~~~

:::

é¿å…effectä¸€ç›´æ‰§è¡Œ

~~~js
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  function createOptions() {
    return {
      serverUrl: 'https://localhost:1234',
      roomId: roomId
    };
  }

  useEffect(() => {
    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, [createOptions]); // ğŸ”´ Problem: This dependency changes on every render
    
    // åº”è¯¥ç¼“å­˜ä»¥ä¸‹createOptionså‡½æ•°
      const createOptions = useCallback(() => {
    return {
      serverUrl: 'https://localhost:1234',
      roomId: roomId
    };
  }, [roomId]); // âœ… Only changes when roomId changes

  useEffect(() => {
    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, [createOptions]); // âœ… Only changes when createOptions changes
    
    //æœ€å¥½çš„åšæ³•åº”è¯¥æ˜¯
      useEffect(() => {
    function createOptions() { // âœ… No need for useCallback or function dependencies!
      return {
        serverUrl: 'https://localhost:1234',
        roomId: roomId
      };
    }

    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // âœ… Only changes when roomId changes
~~~

### useReducer

è¯¥hookä¹Ÿæ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†hook

~~~js
const [state, dispatch] = useReducer(reducer, initialArg, init?)
~~~

â‘ reducer

useReducerä¸useStateéå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒå…è®¸å°†çŠ¶æ€æ›´æ–°é€»è¾‘ä»äº‹ä»¶å¤„ç†ç¨‹åºç§»åˆ°ç»„ä»¶å¤–éƒ¨çš„å•ä¸ªå‡½æ•°ä¸­ã€‚ç„¶åï¼ŒæŒ‰ç…§æƒ¯ä¾‹ï¼Œé€šå¸¸å°†å…¶å†™æˆswitchè¯­å¥ã€‚å¯¹äºå¼€å…³ä¸­çš„æ¯ç§æƒ…å†µï¼Œè®¡ç®—å¹¶è¿”å›ä¸€äº›ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚

~~~js
import { useReducer } from 'react';
function reducer(state, action) {
  if (action.type === 'incremented_age') {
    return {
      age: state.age + 1
    };
  }
  throw Error('Unknown action.');
}

export default function Counter() {
  const [state, dispatch] = useReducer(reducer, { age: 42 });

  return (
    <>
      <button onClick={() => {
        dispatch({ type: 'incremented_age' })
      }}>
        Increment age
      </button>
      <p>Hello! You are {state.age}.</p>
    </>
  );
}

~~~



â‘¡dispatchå‡½æ•°ç”±useReducerå‡½æ•°è¿”å›

è¯¥å‡½æ•°è§¦å‘æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦å°†åŠ¨ä½œä½œä¸ºå”¯ä¸€å‚æ•°ä¼ é€’ç»™åˆ†æ´¾å‡½æ•°

~~~js
const [state, dispatch] = useReducer(reducer, { age: 42 });
dispatch(action)
dispatch({ type: 'incremented_age' });
å‚æ•°action
action:ç”¨æˆ·æ‰§è¡Œçš„æ“ä½œã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å€¼ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œæ“ä½œé€šå¸¸æ˜¯ä¸€ä¸ªå¸¦æœ‰ç±»å‹å±æ€§æ ‡è¯†å®ƒçš„å¯¹è±¡ï¼Œè¿˜å¯ä»¥é€‰æ‹©å¸¦æœ‰é™„åŠ ä¿¡æ¯çš„å…¶ä»–å±æ€§ã€‚
~~~



::: danger

åœ¨reducerä¸­stateçŠ¶æ€æ˜¯åªè¯»çš„ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œæˆ‘ä»¬åº”è¯¥è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥ä¿®æ”¹å¹¶ä¸”å¦‚æœä¸‹ä¸€ä¸ªçŠ¶æ€ç­‰äºå‰ä¸€ä¸ªçŠ¶æ€(ç”±Object.isç¡®å®šæ˜¯å¦ç›¸åŒ)ï¼ŒReactå°†å¿½ç•¥ä½ çš„æ›´æ–°ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ä½ ç›´æ¥æ”¹å˜stateä¸­çš„å¯¹è±¡æˆ–æ•°ç»„æ—¶ï¼Œå› æ­¤æˆ‘ä»¬è¦æ¯æ¬¡è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡æˆ–æ•°ç»„ã€‚

~~~js
function reducer(state, action) {
  switch (action.type) {
    case 'incremented_age': {
      // ğŸš© Don't mutate an object in state like this:
      state.age = state.age + 1;
      return state;
    }
function reducer(state, action) {
  switch (action.type) {
    case 'incremented_age': {
      // âœ… Instead, return a new object
      return {
        ...state,
        age: state.age + 1
      };
    }
~~~



å·²ç»åˆ†æ´¾äº†ä¸€ä¸ªæ“ä½œï¼Œä½†æ˜¯æ—¥å¿—è®°å½•ç»™æˆ‘çš„æ˜¯æ—§çš„çŠ¶æ€å€¼ï¼Œå¯ä»¥æ‰‹åŠ¨æ›´æ”¹reducerå‡½æ•°è¿”å›æœ€æ–°çš„å€¼æ¥è§£å†³

~~~js
function handleClick() {
  console.log(state.age);  // 42

  dispatch({ type: 'incremented_age' }); // Request a re-render with 43
  console.log(state.age);  // Still 42!

  setTimeout(() => {
    console.log(state.age); // Also 42!
  }, 5000);
}
å¯ä»¥æ‰‹åŠ¨æ›´æ”¹reducerå‡½æ•°è¿”å›æœ€æ–°çš„å€¼
const action = { type: 'incremented_age' };
dispatch(action);

const nextState = reducer(state, action);
console.log(state);     // { age: 42 }
console.log(nextState); // { age: 43 }
~~~

:::





### Hooksè°ƒç”¨é¡ºåº

**ä¸è¦æŠŠhookså†™åœ¨æ¡ä»¶åˆ¤æ–­ä¸­**

Reactå¦‚ä½•çŸ¥é“é‚£ä¸ªstateå¯¹åº”å“ªä¸ªuseStateï¼Ÿè¿™é‡Œä¾é hooksè°ƒç”¨é¡ºåº

~~~react
function Form(){
    const [name,setName] = useState('jery') //1
    const firstRender = useRef(true)//2
    if(firstRender.current){âŒ
		firstRender.current = false
        useEffect(()=>{//3 åœ¨ç¬¬äºŒæ¬¡å°±ä¸ä¼šæ‰§è¡Œäº†
     localStorage.setItem('formData',name)
        })
    }
    const [surname,setSurname] = useState('Poppins')//4
    useEffect(()=>{//5
        document.title = name + '' +surname
    })
}
~~~



### Hooksé—­åŒ…è¿‡æœŸé—®é¢˜

![](/React/hooks_delay.png)

è§£å†³åŠæ³•ï¼ŒåŠ å…¥ä¾èµ–



## Reactå¸¸ç”¨API

![](/React/APIS.png)



## ç»„ä»¶é€šä¿¡

â‘ props

â‘¡ref

â‘¢ä¸Šä¸‹æ–‡ä¾èµ–æ³¨å…¥

~~~js
1.åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡
import React from 'react'
const ThemeContext = React.createContext()
export default ThemeContext

2.çˆ¶ç»„ä»¶å°†ä¸Šä¸‹æ–‡å¯¹è±¡æä¾›
import ThemeContext from 'xxx'
const Parent = ()=>{
    const [state,setState] = useState()
    const method = ()=>{}
    return(
        <ThemeContext.Provider value={{
        	state,
        	method
        }}>
        	<Child></Child>	
        </ThemeContext.Provider>
    )
}
3.å­ç»„ä»¶æ¶ˆè´¹
import ThemeContext from 'xxx'
const Child = ()=>{
    return (
        <ThemeContext.Consumer>
        	{context =>{
            	   const {state,method} = context
             	return <div></div>
            	}
            }
        </ThemeContext.Consumer>
    )
}


~~~



â‘£redux







## æ ·å¼ç§æœ‰åŒ–æ–¹æ¡ˆ

â‘ å†…è”æ ·å¼ 

**ç¼ºç‚¹**

* æƒé‡å¤ªé«˜
* æ— æ³•ä½¿ç”¨ä¼ªç±»
* ä¸èƒ½ä½¿ç”¨åª’ä½“æŸ¥è¯¢
* æ²¡æœ‰ä»£ç æç¤º

â‘¡CSS Module

åˆ›å»ºcssæ–‡ä»¶æ—¶åŠ ä¸Š.module

~~~scss
.id{
	width:100%;
}
~~~

ä½¿ç”¨çš„æ—¶å€™å½“å¯¹è±¡ç”¨

~~~js
import style from './xxx.module.css'
()=>{
    return <div className={style.id}></div>w
}
~~~

â‘¢CSS IN JS

~~~bash
pnpm add react-css
~~~

â‘£styled-components

[æ–‡æ¡£åœ°å€](https://styled-components.com/)

~~~bash
pnpm install styled-components
~~~



~~~js
import styled from 'styled-components'
åŸºäºstyleed.æ ‡ç­¾å

export const Continer = styled.div`
	backgroun-color:blue,
	width:100px;
	.title:{
		font-size:20px;
		&:hover{
			color:red;
		}
	}
`
~~~





## Reactå…ƒç´ æŒ‚è½½ä½ç½®

::: tip

ä¸€ä¸ªä» createPortalå†…è§¦å‘çš„äº‹ä»¶ï¼Œä¼šå†’æ³¡åˆ°åŒ…å«Reactæ ‘çš„ç¥–å…ˆï¼Œè€Œä¸æ˜¯DOMæ ‘.å½“ä½ ä½¿ç”¨createPortalåˆ›å»ºçš„ç»„ä»¶è§¦å‘ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œäº‹ä»¶å°†éµå¾ªReactçš„äº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œè€Œä¸æ˜¯DOMçš„äº‹ä»¶å†’æ³¡æœºåˆ¶,äº‹ä»¶ä¼šæ²¿ç€Reactç»„ä»¶æ ‘å‘ä¸Šå†’æ³¡ï¼Œç›´åˆ°åˆ°è¾¾åŒ…å«è¿™ä¸ªcreatePortalç»„ä»¶çš„ç¥–å…ˆç»„ä»¶ã€‚è¿™æ„å‘³ç€å³ä½¿ç»„ä»¶åœ¨DOMæ ‘ä¸­çš„ä¸åŒä½ç½®ï¼Œäº‹ä»¶ä»ç„¶å¯ä»¥å†’æ³¡åˆ°åŒ…å«Reactæ ‘çš„ç¥–å…ˆç»„ä»¶ã€‚

:::

![](/React/poratal.png)

~~~react
import { createPortal } from 'react-dom'

function Wrapper(){
    const  [visible ,setVisible] = useState(false)
    useEffect(()=>{
        setVisible(true)
    },[])
    const wrapperRef = useRef()
    return (
    	<div>
            <div style{{background:'red'}}>
            {visible && (<CustomDiv container={()=>wrapperRef.current} color='black'></CustomDiv> )}
            </div>
            <div ref={wrapperRef}>
                <CustomDiv color="green"></CustomDiv>
            </div>
        </div>
    )
}



function CustomDiv(props){
    const { container ,color } = props
    const MyButton = <Button>{color}-æŒ‰é’®</Button>;
    
    const containerElem = useMemo(()=>{
           return container?.()
    },[container])
    if(containerEle){
        return createPortal(MyButton,containerElem)
    }
    return MyButton
}



~~~



## react-router

### å®‰è£…

~~~shell
pnpm install react-router-dom 
~~~



### è·¯ç”±æ¨¡å¼

1. `createBrowserRouter`åˆ›å»ºhistoryè·¯ç”±
2. `createHashRouter`åˆ›å»ºhashè·¯ç”±





### åˆ›å»ºè·¯ç”±è¡¨

~~~tsx
//  router/index.router.tsx
import { createBrowserRouter, type RouteObject } from 'react-router-dom';
import Home from '@/views/home/index.views';
import Profile from '@/views/profile/index.views';

const routers: RouteObject[] = [
    {
        path: '/',
        element: <Home />,
    },
    {
        path: '/profile',
        element: <Profile />,
    },
];

const router = createBrowserRouter(routers);
export default router;

// main.tsx
import ReactDOM from 'react-dom/client';
import router from './router/index.router.tsx';
import { RouterProvider } from 'react-router-dom';

ReactDOM.createRoot(document.getElementById('root')!).render(<RouterProvider router={router} />);

~~~



### è·¯ç”±å¯¼èˆª

#### å£°æ˜å¼è·¯ç”±å¯¼èˆª

~~~tsx
<link to='/profile'>æˆ‘çš„</link>
~~~

#### ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª

~~~tsx
import * as React from "react";
import { useNavigate } from "react-router-dom";

const Login = ()=>{
    const navigate = useNavigate()
    return (
        <div onClick=()=>navigate('/profile')  >
        
        </div>
    )
}
~~~





### è·¯ç”±ä¼ å‚

#### useSearchParams

~~~tx
import * as React from "react";
import { useNavigate } from "react-router-dom";

const Login = ()=>{
    const navigate = useNavigate()
    return (
        <div onClick=()=>navigate('/profile?id=111&name=query')  >
        </div>
    )
}

// profile
const [params] = useSearchParams()
const id = params.get('id')
~~~



#### useParams

~~~tsx
// è·¯ç”±è¡¨é‡Œè·¯å¾„é…ç½®å ä½ç¬¦
const routers: RouteObject[] = [
    {
        path: '/:id',
        element: <Home />,
    },
    {
        path: '/profile/:id',
        element: <Profile />,
    },
];
//  Home
import { useNavigate } from 'react-router-dom';
function Home() {
    return (
        <>
            <div>Home</div>
            <button onClick={() => navgiate('/profile/123123213')}>Profile</button>
        </>
    );
}
export default Home;
// Profile
import { useNavigate, useParams } from 'react-router-dom';
function Profile() {
    const navgiate = useNavigate();
    const params = useParams();
	params.id
    return (
        <>
            <div>Profile</div>
            <button onClick={() => navgiate('/1231234')}>Home</button>
        </>
    );
}
export default Profile;
~~~

#### useLocation

è¿™ç§æ–¹å¼ä¼ å‚ä¸ä¼šæš´éœ²åœ¨url

~~~tsx
function Login(){
    const [state] = useState({
        name:'age',
        age:24
    })
    return(
        <div onClick=()=> navgiate('/profile',{state})>
        	
        </div>
    )
}
// Profile
function Profile(){
	const {state} = useLocation()
    return(
        <div >
        	profile-{state}
        </div>
    )
}
~~~











### åµŒå¥—è·¯ç”±é…ç½®

#### è·¯ç”±è¡¨é…ç½®

~~~tsx
//  router/index.router.tsx
import { createBrowserRouter, type RouteObject } from 'react-router-dom';
import Home from '@/views/home/index.views';
import Profile from '@/views/profile/index.views';
import Goods from '@/views/home/children/goods/index.views'
import Map from '@/views/home/children/map/index.views'
const routers: RouteObject[] = [
    {
        path: '/',
        element: <Home />,
        children:[
            {
                path:'goods',
                element:<Goods/>
            },
            {
                path:'map',
                element:<Map/>
            }
        ]
    },
    {
        path: '/profile',
        element: <Profile />,
    },
];

const router = createBrowserRouter(routers);
export default router;

// Homeä¸­
import { Outlet } from 'react-router-dom';
function Home() {

    return (
        <>
            <div>Home</div>
            <button onClick={() => navgiate('/profile')}>Profile</button>
        	{/*åµŒå¥—è·¯ç”±å‡ºå£*/}
			<Outlet/>
        </>
    );
}

export default Home;

~~~



#### é»˜è®¤äºŒçº§è·¯ç”±

åœ¨é»˜è®¤è·¯ç”±å±•ç¤ºçš„åœ°æ–¹å»æ‰`path`è®¾ç½®`index=true`

~~~tsx
//  router/index.router.tsx
import { createBrowserRouter, type RouteObject } from 'react-router-dom';
import Home from '@/views/home/index.views';
import Profile from '@/views/profile/index.views';
import Goods from '@/views/home/children/goods/index.views'
import Map from '@/views/home/children/map/index.views'
const routers: RouteObject[] = [
    {
        path: '/',
        element: <Home />,
        children:[
            {
                index:true,
                element:<Goods/>
            },
            {
                path:'map',
                element:<Map/>
            }
        ]
    },
    {
        path: '/profile',
        element: <Profile />,
    },
];
~~~

### 404è·¯ç”±

~~~tsx
// NotFound
const NotFound = ()=>{
    return <div>Not Found</div>
}
// router.index.tsx
//  router/index.router.tsx
import { createBrowserRouter, type RouteObject } from 'react-router-dom';
import Home from '@/views/home/index.views';
import Profile from '@/views/profile/index.views';
import Goods from '@/views/home/children/goods/index.views'
import Map from '@/views/home/children/map/index.views'
import NotFound from '@/compoents/notFound.c'
const routers: RouteObject[] = [
    {
        path: '/',
        element: <Home />,
        children:[
            {
                index:true,
                element:<Goods/>
            },
            {
                path:'map',
                element:<Map/>
            }
        ]
    },
    {
        path: '/profile',
        element: <Profile />,
    },
    {
        path:'*',
        element:<NotFound/>
    }
];
~~~











<CommentService/>